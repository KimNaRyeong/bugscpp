        -:    0:Source:/home/workspace/src/common/chewing-utf8-util.c
        -:    1:/**
        -:    2: * chewing-utf8-util.c
        -:    3: *
        -:    4: * Copyright (c) 2005, 2006, 2012-2014
        -:    5: *	libchewing Core Team. See ChangeLog for details.
        -:    6: *
        -:    7: * See the file "COPYING" for information on usage and redistribution
        -:    8: * of this file.
        -:    9: */
        -:   10:
        -:   11:#include <stdio.h>
        -:   12:#include <string.h>
        -:   13:#include "chewing-utf8-util.h"
        -:   14:
        -:   15:/* Table of UTF-8 length */
        -:   16:static const char utf8len_tab[256] = {
        -:   17:    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        -:   18:    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        -:   19:    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        -:   20:    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        -:   21:    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,     /*bogus */
        -:   22:    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,     /*bogus */
        -:   23:    2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
        -:   24:    3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 1, 1,
        -:   25:};
        -:   26:
        -:   27:/* Return length of UTF-8 string */
      983:   28:int ueStrLen(const char *str)
        -:   29:{
      983:   30:    int length = 0;
      983:   31:    const char *strptr = str;
        -:   32:
     7947:   33:    while (strptr[0] != '\0') {
     6964:   34:        strptr += ueBytesFromChar(strptr[0]);
     6964:   35:        ++length;
        -:   36:    }
      983:   37:    return length;
        -:   38:}
        -:   39:
        -:   40:/* Return bytes of a UTF-8 character */
    52155:   41:int ueBytesFromChar(unsigned char b)
        -:   42:{
    52155:   43:    return utf8len_tab[b];
        -:   44:}
        -:   45:
        -:   46:/* Return bytes of a UTF-8 string until n position */
    16208:   47:int ueStrNBytes(const char *str, int n)
        -:   48:{
    16208:   49:    int i = 0, len = 0;
    16208:   50:    const char *iter = str;
        -:   51:
    34792:   52:    for (i = 0; i < n; i++) {
    18584:   53:        len += ueBytesFromChar(iter[len]);
        -:   54:    }
    16208:   55:    return len;
        -:   56:}
        -:   57:
        -:   58:/* Return how many bytes was copied */
    16208:   59:int ueStrNCpy(char dest[], const char *src, size_t n, int end)
        -:   60:{
    16208:   61:    int len = 0;
        -:   62:
    16208:   63:    len = ueStrNBytes(src, n);
    16208:   64:    memcpy(dest, src, len);
    16208:   65:    if (end == STRNCPY_CLOSE)
    15576:   66:        dest[len] = '\0';
    16208:   67:    return len;
        -:   68:}
        -:   69:
      869:   70:const char *ueConstStrSeek(const char *src, size_t n)
        -:   71:{
      869:   72:    size_t i = 0;
      869:   73:    const char *iter = src;
        -:   74:
    21567:   75:    for (i = 0; i < n; i++) {
    20698:   76:        iter += ueBytesFromChar(iter[0]);
        -:   77:    }
      869:   78:    return iter;
        -:   79:}
        -:   80:
    10627:   81:char *ueStrSeek(char *src, size_t n)
        -:   82:{
    10627:   83:    size_t i = 0;
    10627:   84:    char *iter = src;
        -:   85:
    11262:   86:    for (i = 0; i < n; i++) {
      635:   87:        iter += ueBytesFromChar(iter[0]);
        -:   88:    }
    10627:   89:    return iter;
        -:   90:}
        -:   91:
        -:   92:/* Locate a UTF-8 substring from UTF-8 string */
    #####:   93:const char *ueStrStr(const char *str, size_t lstr, const char *substr, size_t lsub)
        -:   94:{
    #####:   95:    const char *p = str;
        -:   96:    size_t ub;
        -:   97:
    #####:   98:    if (lstr < lsub)
    #####:   99:        return NULL;
    #####:  100:    ub = lstr - lsub;
    #####:  101:    for (; (size_t) (p - str) <= ub; p++) {
    #####:  102:        if (!strncmp(p, substr, lsub))
    #####:  103:            return p;
        -:  104:    }
    #####:  105:    return NULL;
        -:  106:}
