        -:    0:Source:/home/workspace/tests/unit-core/test-backtrace.c
        -:    0:Programs:296
        -:    1:/* Copyright JS Foundation and other contributors, http://js.foundation
        -:    2: *
        -:    3: * Licensed under the Apache License, Version 2.0 (the "License");
        -:    4: * you may not use this file except in compliance with the License.
        -:    5: * You may obtain a copy of the License at
        -:    6: *
        -:    7: *     http://www.apache.org/licenses/LICENSE-2.0
        -:    8: *
        -:    9: * Unless required by applicable law or agreed to in writing, software
        -:   10: * distributed under the License is distributed on an "AS IS" BASIS
        -:   11: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        -:   12: * See the License for the specific language governing permissions and
        -:   13: * limitations under the License.
        -:   14: */
        -:   15:
        -:   16:#include "config.h"
        -:   17:#include "jerryscript.h"
        -:   18:#include "test-common.h"
        -:   19:
        -:   20:static jerry_value_t
    #####:   21:backtrace_handler (const jerry_call_info_t *call_info_p, /**< call information */
        -:   22:                   const jerry_value_t args_p[], /**< argument list */
        -:   23:                   const jerry_length_t args_count) /**< argument count */
        -:   24:{
        -:   25:  JERRY_UNUSED (call_info_p);
        -:   26:
    #####:   27:  uint32_t max_depth = 0;
        -:   28:
    #####:   29:  if (args_count >= 1 && jerry_value_is_number (args_p[0]))
        -:   30:  {
    #####:   31:    max_depth = (uint32_t) jerry_get_number_value (args_p[0]);
        -:   32:  }
        -:   33:
    #####:   34:  return jerry_get_backtrace (max_depth);
        -:   35:} /* backtrace_handler */
        -:   36:
        -:   37:static void
    #####:   38:compare_string (jerry_value_t left_value, /* string value */
        -:   39:                const char *right_p) /* string to compare */
        -:   40:{
        -:   41:  jerry_char_t buffer[64];
    #####:   42:  size_t length = strlen (right_p);
        -:   43:
    #####:   44:  TEST_ASSERT (length <= sizeof (buffer));
    #####:   45:  TEST_ASSERT (jerry_value_is_string (left_value));
    #####:   46:  TEST_ASSERT (jerry_get_string_size (left_value) == length);
        -:   47:
    #####:   48:  TEST_ASSERT (jerry_string_to_char_buffer (left_value, buffer, sizeof (buffer)) == length);
    #####:   49:  TEST_ASSERT (memcmp (buffer, right_p, length) == 0);
    #####:   50:} /* compare_string */
        -:   51:
        -:   52:static const jerry_value_t *handler_args_p;
        -:   53:static int frame_index;
        -:   54:
        -:   55:static bool
    #####:   56:backtrace_callback (jerry_backtrace_frame_t *frame_p, /* frame information */
        -:   57:                    void *user_p) /* user data */
        -:   58:{
    #####:   59:  TEST_ASSERT ((void *) handler_args_p == user_p);
    #####:   60:  TEST_ASSERT (jerry_backtrace_get_frame_type (frame_p) == JERRY_BACKTRACE_FRAME_JS);
        -:   61:
    #####:   62:  const jerry_backtrace_location_t *location_p = jerry_backtrace_get_location (frame_p);
    #####:   63:  const jerry_value_t *function_p = jerry_backtrace_get_function (frame_p);
    #####:   64:  const jerry_value_t *this_p = jerry_backtrace_get_this (frame_p);
        -:   65:
    #####:   66:  TEST_ASSERT (location_p != NULL);
    #####:   67:  TEST_ASSERT (function_p != NULL);
    #####:   68:  TEST_ASSERT (this_p != NULL);
        -:   69:
    #####:   70:  compare_string (location_p->resource_name, "capture_test.js");
        -:   71:
    #####:   72:  ++frame_index;
        -:   73:
    #####:   74:  if (frame_index == 1)
        -:   75:  {
    #####:   76:    TEST_ASSERT (!jerry_backtrace_is_strict (frame_p));
    #####:   77:    TEST_ASSERT (location_p->line == 2);
    #####:   78:    TEST_ASSERT (location_p->column == 3);
    #####:   79:    TEST_ASSERT (handler_args_p[0] == *function_p);
    #####:   80:    TEST_ASSERT (handler_args_p[1] == *this_p);
        -:   81:    return true;
        -:   82:  }
        -:   83:
    #####:   84:  if (frame_index == 2)
        -:   85:  {
    #####:   86:    TEST_ASSERT (jerry_backtrace_is_strict (frame_p));
    #####:   87:    TEST_ASSERT (location_p->line == 7);
    #####:   88:    TEST_ASSERT (location_p->column == 6);
    #####:   89:    TEST_ASSERT (handler_args_p[2] == *function_p);
    #####:   90:    TEST_ASSERT (jerry_value_is_undefined (*this_p));
        -:   91:    return true;
        -:   92:  }
        -:   93:
    #####:   94:  jerry_value_t global = jerry_get_global_object ();
        -:   95:
    #####:   96:  TEST_ASSERT (frame_index == 3);
    #####:   97:  TEST_ASSERT (!jerry_backtrace_is_strict (frame_p));
    #####:   98:  TEST_ASSERT (location_p->line == 11);
    #####:   99:  TEST_ASSERT (location_p->column == 3);
    #####:  100:  TEST_ASSERT (handler_args_p[3] == *function_p);
    #####:  101:  TEST_ASSERT (global == *this_p);
        -:  102:
    #####:  103:  jerry_release_value (global);
    #####:  104:  return false;
        -:  105:} /* backtrace_callback */
        -:  106:
        -:  107:static bool
    #####:  108:async_backtrace_callback (jerry_backtrace_frame_t *frame_p, /* frame information */
        -:  109:                          void *user_p) /* user data */
        -:  110:{
    #####:  111:  TEST_ASSERT ((void *) handler_args_p == user_p);
    #####:  112:  TEST_ASSERT (jerry_backtrace_get_frame_type (frame_p) == JERRY_BACKTRACE_FRAME_JS);
        -:  113:
    #####:  114:  const jerry_backtrace_location_t *location_p = jerry_backtrace_get_location (frame_p);
    #####:  115:  const jerry_value_t *function_p = jerry_backtrace_get_function (frame_p);
        -:  116:
    #####:  117:  TEST_ASSERT (location_p != NULL);
    #####:  118:  TEST_ASSERT (function_p != NULL);
        -:  119:
    #####:  120:  compare_string (location_p->resource_name, "async_capture_test.js");
        -:  121:
    #####:  122:  ++frame_index;
        -:  123:
    #####:  124:  if (frame_index == 1)
        -:  125:  {
    #####:  126:    TEST_ASSERT (jerry_backtrace_is_strict (frame_p));
    #####:  127:    TEST_ASSERT (location_p->line == 3);
    #####:  128:    TEST_ASSERT (location_p->column == 3);
    #####:  129:    TEST_ASSERT (handler_args_p[0] == *function_p);
        -:  130:    return true;
        -:  131:  }
        -:  132:
    #####:  133:  TEST_ASSERT (frame_index == 2);
    #####:  134:  TEST_ASSERT (!jerry_backtrace_is_strict (frame_p));
    #####:  135:  TEST_ASSERT (location_p->line == 8);
    #####:  136:  TEST_ASSERT (location_p->column == 3);
    #####:  137:  TEST_ASSERT (handler_args_p[1] == *function_p);
        -:  138:  return true;
        -:  139:} /* async_backtrace_callback */
        -:  140:
        -:  141:static bool
    #####:  142:class_backtrace_callback (jerry_backtrace_frame_t *frame_p, /* frame information */
        -:  143:                          void *user_p) /* user data */
        -:  144:{
    #####:  145:  TEST_ASSERT ((void *) handler_args_p == user_p);
    #####:  146:  TEST_ASSERT (jerry_backtrace_get_frame_type (frame_p) == JERRY_BACKTRACE_FRAME_JS);
        -:  147:
    #####:  148:  const jerry_backtrace_location_t *location_p = jerry_backtrace_get_location (frame_p);
    #####:  149:  const jerry_value_t *function_p = jerry_backtrace_get_function (frame_p);
        -:  150:
    #####:  151:  TEST_ASSERT (location_p != NULL);
    #####:  152:  TEST_ASSERT (function_p != NULL);
        -:  153:
    #####:  154:  compare_string (location_p->resource_name, "class_capture_test.js");
        -:  155:
    #####:  156:  ++frame_index;
        -:  157:
    #####:  158:  if (frame_index == 1)
        -:  159:  {
    #####:  160:    TEST_ASSERT (jerry_backtrace_is_strict (frame_p));
    #####:  161:    TEST_ASSERT (location_p->line == 3);
    #####:  162:    TEST_ASSERT (location_p->column == 14);
        -:  163:    return false;
        -:  164:  }
        -:  165:
    #####:  166:  TEST_ASSERT (frame_index == 2);
    #####:  167:  TEST_ASSERT (jerry_backtrace_is_strict (frame_p));
    #####:  168:  TEST_ASSERT (location_p->line == 2);
    #####:  169:  TEST_ASSERT (location_p->column == 7);
        -:  170:  return false;
        -:  171:} /* class_backtrace_callback */
        -:  172:
        -:  173:static jerry_value_t
    #####:  174:capture_handler (const jerry_call_info_t *call_info_p, /**< call information */
        -:  175:                 const jerry_value_t args_p[], /**< argument list */
        -:  176:                 const jerry_length_t args_count) /**< argument count */
        -:  177:{
        -:  178:  JERRY_UNUSED (call_info_p);
        -:  179:
    #####:  180:  TEST_ASSERT (args_count == 0 || args_count == 2 || args_count == 4);
    #####:  181:  TEST_ASSERT (args_count == 0 || frame_index == 0);
        -:  182:
    #####:  183:  jerry_backtrace_callback_t callback = backtrace_callback;
        -:  184:
    #####:  185:  if (args_count == 0)
        -:  186:  {
        -:  187:    callback = class_backtrace_callback;
        -:  188:  }
    #####:  189:  else if (args_count == 2)
        -:  190:  {
    #####:  191:    callback = async_backtrace_callback;
        -:  192:  }
        -:  193:
    #####:  194:  handler_args_p = args_p;
    #####:  195:  jerry_backtrace_capture (callback, (void *) args_p);
        -:  196:
    #####:  197:  TEST_ASSERT (args_count == 0 || frame_index == (args_count == 4 ? 3 : 2));
        -:  198:
    #####:  199:  return jerry_create_undefined ();
        -:  200:} /* capture_handler */
        -:  201:
        -:  202:static bool
    #####:  203:global_backtrace_callback (jerry_backtrace_frame_t *frame_p, /* frame information */
        -:  204:                           void *user_p) /* user data */
        -:  205:{
    #####:  206:  TEST_ASSERT (user_p != NULL && frame_index == 0);
    #####:  207:  frame_index++;
        -:  208:
    #####:  209:  const jerry_value_t *function_p = jerry_backtrace_get_function (frame_p);
    #####:  210:  jerry_value_t *result_p = ((jerry_value_t *) user_p);
        -:  211:
    #####:  212:  TEST_ASSERT (function_p != NULL);
    #####:  213:  jerry_release_value (*result_p);
    #####:  214:  *result_p = jerry_acquire_value (*function_p);
    #####:  215:  return true;
        -:  216:} /* global_backtrace_callback */
        -:  217:
        -:  218:static jerry_value_t
    #####:  219:global_capture_handler (const jerry_call_info_t *call_info_p, /**< call information */
        -:  220:                        const jerry_value_t args_p[], /**< argument list */
        -:  221:                        const jerry_length_t args_count) /**< argument count */
        -:  222:{
        -:  223:  JERRY_UNUSED (call_info_p);
        -:  224:  JERRY_UNUSED (args_p);
        -:  225:  JERRY_UNUSED (args_count);
        -:  226:
    #####:  227:  jerry_value_t result = jerry_create_undefined ();
    #####:  228:  jerry_backtrace_capture (global_backtrace_callback, &result);
        -:  229:
    #####:  230:  TEST_ASSERT (jerry_value_is_object (result));
    #####:  231:  return result;
        -:  232:} /* global_capture_handler */
        -:  233:
        -:  234:static void
    #####:  235:register_callback (jerry_external_handler_t handler_p, /**< callback function */
        -:  236:                   char *name_p) /**< name of the function */
        -:  237:{
    #####:  238:  jerry_value_t global = jerry_get_global_object ();
        -:  239:
    #####:  240:  jerry_value_t func = jerry_create_external_function (handler_p);
    #####:  241:  jerry_value_t name = jerry_create_string ((const jerry_char_t *) name_p);
    #####:  242:  jerry_value_t result = jerry_set_property (global, name, func);
    #####:  243:  TEST_ASSERT (!jerry_value_is_error (result));
        -:  244:
    #####:  245:  jerry_release_value (result);
    #####:  246:  jerry_release_value (name);
    #####:  247:  jerry_release_value (func);
        -:  248:
    #####:  249:  jerry_release_value (global);
    #####:  250:} /* register_callback */
        -:  251:
        -:  252:static jerry_value_t
    #####:  253:run (const char *resource_name_p, /**< resource name */
        -:  254:     const char *source_p) /**< source code */
        -:  255:{
        -:  256:  jerry_parse_options_t parse_options;
    #####:  257:  parse_options.options = JERRY_PARSE_HAS_RESOURCE;
    #####:  258:  parse_options.resource_name = jerry_create_string ((const jerry_char_t *) resource_name_p);
        -:  259:
    #####:  260:  jerry_value_t code = jerry_parse ((const jerry_char_t *) source_p,
        -:  261:                                    strlen (source_p),
        -:  262:                                    &parse_options);
    #####:  263:  jerry_release_value (parse_options.resource_name);
    #####:  264:  TEST_ASSERT (!jerry_value_is_error (code));
        -:  265:
    #####:  266:  jerry_value_t result = jerry_run (code);
    #####:  267:  jerry_release_value (code);
        -:  268:
    #####:  269:  return result;
        -:  270:} /* run */
        -:  271:
        -:  272:static void
    #####:  273:compare (jerry_value_t array, /**< array */
        -:  274:         uint32_t index, /**< item index */
        -:  275:         const char *str) /**< string to compare */
        -:  276:{
        -:  277:  jerry_char_t buf[64];
        -:  278:
    #####:  279:  size_t len = strlen (str);
        -:  280:
    #####:  281:  TEST_ASSERT (len < sizeof (buf));
        -:  282:
    #####:  283:  jerry_value_t value = jerry_get_property_by_index (array, index);
        -:  284:
    #####:  285:  TEST_ASSERT (!jerry_value_is_error (value)
        -:  286:               && jerry_value_is_string (value));
        -:  287:
    #####:  288:  TEST_ASSERT (jerry_get_string_size (value) == len);
        -:  289:
    #####:  290:  jerry_size_t str_len = jerry_string_to_char_buffer (value, buf, (jerry_size_t) len);
    #####:  291:  TEST_ASSERT (str_len == len);
        -:  292:
    #####:  293:  jerry_release_value (value);
        -:  294:
    #####:  295:  TEST_ASSERT (memcmp (buf, str, len) == 0);
    #####:  296:} /* compare */
        -:  297:
        -:  298:static void
    #####:  299:test_get_backtrace_api_call (void)
        -:  300:{
    #####:  301:  jerry_init (JERRY_INIT_EMPTY);
        -:  302:
    #####:  303:  register_callback (backtrace_handler, "backtrace");
    #####:  304:  register_callback (capture_handler, "capture");
        -:  305:
    #####:  306:  const char *source_p = ("function f() {\n"
        -:  307:                          "  return backtrace(0);\n"
        -:  308:                          "}\n"
        -:  309:                          "\n"
        -:  310:                          "function g() {\n"
        -:  311:                          "  return f();\n"
        -:  312:                          "}\n"
        -:  313:                          "\n"
        -:  314:                          "function h() {\n"
        -:  315:                          "  return g();\n"
        -:  316:                          "}\n"
        -:  317:                          "\n"
        -:  318:                          "h();\n");
        -:  319:
    #####:  320:  jerry_value_t backtrace = run ("something.js", source_p);
        -:  321:
    #####:  322:  TEST_ASSERT (!jerry_value_is_error (backtrace)
        -:  323:               && jerry_value_is_array (backtrace));
        -:  324:
    #####:  325:  TEST_ASSERT (jerry_get_array_length (backtrace) == 4);
        -:  326:
    #####:  327:  compare (backtrace, 0, "something.js:2:3");
    #####:  328:  compare (backtrace, 1, "something.js:6:3");
    #####:  329:  compare (backtrace, 2, "something.js:10:3");
    #####:  330:  compare (backtrace, 3, "something.js:13:1");
        -:  331:
    #####:  332:  jerry_release_value (backtrace);
        -:  333:
        -:  334:  /* Depth set to 2 this time. */
        -:  335:
    #####:  336:  source_p = ("function f() {\n"
        -:  337:              "  1; return backtrace(2);\n"
        -:  338:              "}\n"
        -:  339:              "\n"
        -:  340:              "function g() {\n"
        -:  341:              "  return f();\n"
        -:  342:              "}\n"
        -:  343:              "\n"
        -:  344:              "function h() {\n"
        -:  345:              "  return g();\n"
        -:  346:              "}\n"
        -:  347:              "\n"
        -:  348:              "h();\n");
        -:  349:
    #####:  350:  backtrace = run ("something_else.js", source_p);
        -:  351:
    #####:  352:  TEST_ASSERT (!jerry_value_is_error (backtrace)
        -:  353:               && jerry_value_is_array (backtrace));
        -:  354:
    #####:  355:  TEST_ASSERT (jerry_get_array_length (backtrace) == 2);
        -:  356:
    #####:  357:  compare (backtrace, 0, "something_else.js:2:6");
    #####:  358:  compare (backtrace, 1, "something_else.js:6:3");
        -:  359:
    #####:  360:  jerry_release_value (backtrace);
        -:  361:
        -:  362:  /* Test frame capturing. */
        -:  363:
    #####:  364:  frame_index = 0;
    #####:  365:  source_p = ("var o = { f:function() {\n"
        -:  366:              "  return capture(o.f, o, g, h);\n"
        -:  367:              "} }\n"
        -:  368:              "\n"
        -:  369:              "function g() {\n"
        -:  370:              "  'use strict';\n"
        -:  371:              "  1; return o.f();\n"
        -:  372:              "}\n"
        -:  373:              "\n"
        -:  374:              "function h() {\n"
        -:  375:              "  return g();\n"
        -:  376:              "}\n"
        -:  377:              "\n"
        -:  378:              "h();\n");
        -:  379:
    #####:  380:  jerry_value_t result = run ("capture_test.js", source_p);
        -:  381:
    #####:  382:  TEST_ASSERT (jerry_value_is_undefined (result));
    #####:  383:  jerry_release_value (result);
        -:  384:
    #####:  385:  TEST_ASSERT (frame_index == 3);
        -:  386:
        -:  387:  /* Test async frame capturing. */
    #####:  388:  source_p = "async function f() {}";
    #####:  389:  result = jerry_eval ((const jerry_char_t *) source_p, strlen (source_p), JERRY_PARSE_NO_OPTS);
        -:  390:
    #####:  391:  if (!jerry_value_is_error (result))
        -:  392:  {
    #####:  393:    jerry_release_value (result);
        -:  394:
    #####:  395:    frame_index = 0;
    #####:  396:    source_p = ("function f() {\n"
        -:  397:                "  'use strict';\n"
        -:  398:                "  return capture(f, g);\n"
        -:  399:                "}\n"
        -:  400:                "\n"
        -:  401:                "async function g() {\n"
        -:  402:                "  await 0;\n"
        -:  403:                "  return f();\n"
        -:  404:                "}\n"
        -:  405:                "\n"
        -:  406:                "g();\n");
        -:  407:
    #####:  408:    result = run ("async_capture_test.js", source_p);
        -:  409:
    #####:  410:    TEST_ASSERT (jerry_value_is_promise (result));
    #####:  411:    jerry_release_value (result);
        -:  412:
    #####:  413:    TEST_ASSERT (frame_index == 0);
        -:  414:
    #####:  415:    result = jerry_run_all_enqueued_jobs ();
    #####:  416:    TEST_ASSERT (!jerry_value_is_error (result));
        -:  417:
    #####:  418:    TEST_ASSERT (frame_index == 2);
        -:  419:  }
        -:  420:  else
        -:  421:  {
    #####:  422:    TEST_ASSERT (jerry_get_error_type (result) == JERRY_ERROR_SYNTAX);
        -:  423:  }
        -:  424:
    #####:  425:  jerry_release_value (result);
        -:  426:
        -:  427:  /* Test class initializer frame capturing. */
    #####:  428:  source_p = "class C {}";
    #####:  429:  result = jerry_eval ((const jerry_char_t *) source_p, strlen (source_p), JERRY_PARSE_NO_OPTS);
        -:  430:
    #####:  431:  if (!jerry_value_is_error (result))
        -:  432:  {
    #####:  433:    jerry_release_value (result);
        -:  434:
    #####:  435:    frame_index = 0;
    #####:  436:    source_p = ("class C {\n"
        -:  437:                "  a = capture();\n"
        -:  438:                "  static b = capture();\n"
        -:  439:                "}\n"
        -:  440:                "new C;\n");
        -:  441:
    #####:  442:    result = run ("class_capture_test.js", source_p);
        -:  443:
    #####:  444:    TEST_ASSERT (!jerry_value_is_error (result));
    #####:  445:    TEST_ASSERT (frame_index == 2);
        -:  446:  }
        -:  447:  else
        -:  448:  {
    #####:  449:    TEST_ASSERT (jerry_get_error_type (result) == JERRY_ERROR_SYNTAX);
        -:  450:  }
        -:  451:
    #####:  452:  jerry_release_value (result);
        -:  453:
    #####:  454:  register_callback (global_capture_handler, "global_capture");
        -:  455:
    #####:  456:  frame_index = 0;
        -:  457:
    #####:  458:  source_p = "global_capture()";
        -:  459:
    #####:  460:  jerry_value_t code = jerry_parse ((const jerry_char_t *) source_p, strlen (source_p), NULL);
    #####:  461:  TEST_ASSERT (!jerry_value_is_error (code));
        -:  462:
    #####:  463:  result = jerry_run (code);
        -:  464:
    #####:  465:  jerry_value_t compare_value = jerry_binary_operation (JERRY_BIN_OP_STRICT_EQUAL, result, code);
    #####:  466:  TEST_ASSERT (jerry_value_is_true (compare_value));
        -:  467:
    #####:  468:  jerry_release_value (compare_value);
    #####:  469:  jerry_release_value (result);
    #####:  470:  jerry_release_value (code);
        -:  471:
    #####:  472:  jerry_cleanup ();
    #####:  473:} /* test_get_backtrace_api_call */
        -:  474:
        -:  475:static void
    #####:  476:test_exception_backtrace (void)
        -:  477:{
    #####:  478:  jerry_init (JERRY_INIT_EMPTY);
        -:  479:
    #####:  480:  const char *source = ("function f() {\n"
        -:  481:                        "  undef_reference;\n"
        -:  482:                        "}\n"
        -:  483:                        "\n"
        -:  484:                        "function g() {\n"
        -:  485:                        "  return f();\n"
        -:  486:                        "}\n"
        -:  487:                        "\n"
        -:  488:                        "g();\n");
        -:  489:
    #####:  490:  jerry_value_t error = run ("bad.js", source);
        -:  491:
    #####:  492:  TEST_ASSERT (jerry_value_is_error (error));
        -:  493:
    #####:  494:  error = jerry_get_value_from_error (error, true);
        -:  495:
    #####:  496:  TEST_ASSERT (jerry_value_is_object (error));
        -:  497:
    #####:  498:  jerry_value_t name = jerry_create_string ((const jerry_char_t *) "stack");
    #####:  499:  jerry_value_t backtrace = jerry_get_property (error, name);
        -:  500:
    #####:  501:  jerry_release_value (name);
    #####:  502:  jerry_release_value (error);
        -:  503:
    #####:  504:  TEST_ASSERT (!jerry_value_is_error (backtrace)
        -:  505:               && jerry_value_is_array (backtrace));
        -:  506:
    #####:  507:  TEST_ASSERT (jerry_get_array_length (backtrace) == 3);
        -:  508:
    #####:  509:  compare (backtrace, 0, "bad.js:2:3");
    #####:  510:  compare (backtrace, 1, "bad.js:6:3");
    #####:  511:  compare (backtrace, 2, "bad.js:9:1");
        -:  512:
    #####:  513:  jerry_release_value (backtrace);
        -:  514:
    #####:  515:  jerry_cleanup ();
    #####:  516:} /* test_exception_backtrace */
        -:  517:
        -:  518:static void
    #####:  519:test_large_line_count (void)
        -:  520:{
    #####:  521:  jerry_init (JERRY_INIT_EMPTY);
        -:  522:
    #####:  523:  const char *source = ("\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  524:                        "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  525:                        "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  526:                        "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  527:                        "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  528:                        "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  529:                        "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  530:                        "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  531:                        "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  532:                        "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  533:                        "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  534:                        "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        -:  535:                        "g();\n");
        -:  536:
    #####:  537:  jerry_value_t error = run ("bad.js", source);
        -:  538:
    #####:  539:  TEST_ASSERT (jerry_value_is_error (error));
        -:  540:
    #####:  541:  error = jerry_get_value_from_error (error, true);
        -:  542:
    #####:  543:  TEST_ASSERT (jerry_value_is_object (error));
        -:  544:
    #####:  545:  jerry_value_t name = jerry_create_string ((const jerry_char_t *) "stack");
    #####:  546:  jerry_value_t backtrace = jerry_get_property (error, name);
        -:  547:
    #####:  548:  jerry_release_value (name);
    #####:  549:  jerry_release_value (error);
        -:  550:
    #####:  551:  TEST_ASSERT (!jerry_value_is_error (backtrace)
        -:  552:               && jerry_value_is_array (backtrace));
        -:  553:
    #####:  554:  TEST_ASSERT (jerry_get_array_length (backtrace) == 1);
        -:  555:
    #####:  556:  compare (backtrace, 0, "bad.js:385:1");
        -:  557:
    #####:  558:  jerry_release_value (backtrace);
        -:  559:
    #####:  560:  jerry_cleanup ();
    #####:  561:} /* test_large_line_count */
        -:  562:
        -:  563:int
    #####:  564:main (void)
        -:  565:{
    #####:  566:  TEST_INIT ();
        -:  567:
    #####:  568:  TEST_ASSERT (jerry_is_feature_enabled (JERRY_FEATURE_LINE_INFO));
        -:  569:
    #####:  570:  test_get_backtrace_api_call ();
    #####:  571:  test_exception_backtrace ();
    #####:  572:  test_large_line_count ();
        -:  573:
        -:  574:  return 0;
        -:  575:} /* main */
