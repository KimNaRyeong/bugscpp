        -:    0:Source:/home/workspace/docs/10.EXT-REFERENCE-HANDLER.md
        -:    0:Programs:297
        -:    1:# Common methods to handle properties
        -:    2:
        -:    3:The `jerryscript-ext/handler.h` header defines a set of convenience methods
        -:    4:which makes the property access a bit straightforward.
        -:    5:
        -:    6:## jerryx_set_property_str
        -:    7:
        -:    8:**Summary**
        -:    9:
        -:   10:Set a property on a target object with a given name.
        -:   11:
        -:   12:*Note*:
        -:   13:- The property name must be a zero terminated UTF-8 string.
        -:   14:- There should be no '\0' (NULL) character in the name excluding the string terminator.
        -:   15:- Returned value must be freed with [jerry_value_free](#jerry_value_free) when it
        -:   16:  is no longer needed.
        -:   17:
        -:   18:
        -:   19:**Prototype**
        -:   20:
        -:   21:```c
        -:   22:jerry_value_t
        -:   23:jerryx_set_property_str (const jerry_value_t target_object,
        -:   24:                         const char *name,
        -:   25:                         const jerry_value_t value);
        -:   26:```
        -:   27:
        -:   28:- `target_object` - the object where the property should be set
        -:   29:- `name` - name of the property
        -:   30:- `value` - property value to be set
        -:   31:- return value
        -:   32:  - JS true value, if success
        -:   33:  - thrown error, if there was a problem setting the property
        -:   34:
        -:   35:**Example**
        -:   36:
        -:   37:[doctest]: # ()
        -:   38:
        -:   39:```c
        -:   40:#include "jerryscript.h"
        -:   41:#include "jerryscript-ext/handler.h"
        -:   42:
        -:   43:int
    #####:   44:main (int argc, char **argv)
        -:   45:{
    #####:   46:  jerry_init (JERRY_INIT_EMPTY);
        -:   47:
    #####:   48:  jerry_value_t global = jerry_current_realm ();
        -:   49:
    #####:   50:  jerry_value_t value = jerry_number (3.3);
    #####:   51:  jerry_value_t result = jerryx_set_property_str (global, "value", value);
    #####:   52:  if (jerry_value_is_exception (result))
        -:   53:  {
        -:   54:    /* The error type/reason can be extracted via the `jerry_exception_value` method */
        -:   55:    printf ("Error during property configuration\r\n");
        -:   56:  }
        -:   57:
    #####:   58:  jerry_value_free (result);
    #####:   59:  jerry_value_free (value);
    #####:   60:  jerry_value_free (global);
    #####:   61:  jerry_cleanup();
        -:   62:
        -:   63:  return 0;
        -:   64:}
        -:   65:```
        -:   66:
        -:   67:## jerryx_get_property_str
        -:   68:
        -:   69:**Summary**
        -:   70:
        -:   71:Get the value of a property from the specified object with the given name.
        -:   72:
        -:   73:*Notes*:
        -:   74:- The property name must be a zero terminated UTF-8 string.
        -:   75:- There should be no '\0' (NULL) character in the name excluding the string terminator.
        -:   76:- Returned value must be freed with [jerry_value_free](#jerry_value_free) when it
        -:   77:  is no longer needed.
        -:   78:
        -:   79:
        -:   80:**Prototype**
        -:   81:
        -:   82:```
        -:   83:jerry_value_t
        -:   84:jerryx_get_property_str (const jerry_value_t target_object,
        -:   85:                         const char *name);
        -:   86:```
        -:   87:
        -:   88:- `target_object` - object on which the property name is accessed
        -:   89:- `name` - property name as an UTF-8 `char*`
        -:   90:- return value
        -:   91:  - value of property, if success
        -:   92:  - thrown error, if there was a problem accessing the property
        -:   93:
        -:   94:**Example**
        -:   95:
        -:   96:[doctest]: # ()
        -:   97:
        -:   98:```c
        -:   99:#include "jerryscript.h"
        -:  100:#include "jerryscript-ext/handler.h"
        -:  101:
        -:  102:int
    #####:  103:main (int argc, char **argv)
        -:  104:{
    #####:  105:  jerry_init (JERRY_INIT_EMPTY);
        -:  106:
    #####:  107:  jerry_value_t global = jerry_current_realm ();
        -:  108:
    #####:  109:  jerry_value_t math_object = jerryx_get_property_str (global, "Math");
        -:  110:
        -:  111:  /* use math_object */
        -:  112:
    #####:  113:  jerry_value_free (math_object);
    #####:  114:  jerry_value_free (global);
    #####:  115:  jerry_cleanup();
        -:  116:
        -:  117:  return 0;
        -:  118:}
        -:  119:```
        -:  120:
        -:  121:## jerryx_has_property_str
        -:  122:
        -:  123:**Summary**
        -:  124:
        -:  125:Check if a property exists on an object.
        -:  126:
        -:  127:*Notes*:
        -:  128:- The operation performed is the same as what the `jerry_object_has` method.
        -:  129:- The property name must be a zero terminated UTF-8 string.
        -:  130:- There should be no '\0' (NULL) character in the name excluding the string terminator.
        -:  131:
        -:  132:
        -:  133:**Prototype**
        -:  134:
        -:  135:```
        -:  136:bool
        -:  137:jerryx_has_property_str (const jerry_value_t target_object,
        -:  138:                         const char *name);
        -:  139:```
        -:  140:
        -:  141:- `target_object` - object on which the property name is accessed
        -:  142:- `name` - property name as an UTF-8 `char*`
        -:  143:- return value
        -:  144:  - true, if the given property name exists on the object
        -:  145:  - false, if there is no such property name or there was an error accessing the property
        -:  146:
        -:  147:**Example**
        -:  148:
        -:  149:[doctest]: # ()
        -:  150:
        -:  151:```c
        -:  152:#include "jerryscript.h"
        -:  153:#include "jerryscript-ext/handler.h"
        -:  154:
        -:  155:int
    #####:  156:main (int argc, char **argv)
        -:  157:{
    #####:  158:  jerry_init (JERRY_INIT_EMPTY);
        -:  159:
    #####:  160:  jerry_value_t global = jerry_current_realm ();
        -:  161:
    #####:  162:  bool have_math = jerryx_has_property_str (global, "Math");
        -:  163:
    #####:  164:  jerry_value_free (global);
    #####:  165:  jerry_cleanup();
        -:  166:
    #####:  167:  return have_math ? 0 : 1;
        -:  168:}
        -:  169:```
        -:  170:
        -:  171:# Utility to register multiple properties in bulk
        -:  172:
        -:  173:In some cases it is useful to register multiple properties for a given object
        -:  174:for this the following utility structures and methods are provided.
        -:  175:
        -:  176:## jerryx_property_entry
        -:  177:
        -:  178:**Summary**
        -:  179:
        -:  180:Structure to define an array of properties with `name` and `value` fields which
        -:  181:can be registered to a target object.
        -:  182:
        -:  183:The engine must be initialized before specifying the `jerry_value_t` in the struct.
        -:  184:
        -:  185:
        -:  186:**Prototype**
        -:  187:
        -:  188:```c
        -:  189:typedef struct {
        -:  190:  const char *name;
        -:  191:  jerry_value_t value;
        -:  192:} jerryx_function_list_entry;
        -:  193:```
        -:  194:
        -:  195:**See also**
        -:  196:
        -:  197:- [jerryx_set_properties](#jerryx_set_properties)
        -:  198:
        -:  199:
        -:  200:## jerryx_register_result
        -:  201:
        -:  202:**Summary**
        -:  203:
        -:  204:Structure returned as the result of the [jerryx_set_properties](#jerryx_set_properties) operation.
        -:  205:The `result` field will either be a JavaScript undefined value or an error object.
        -:  206:In every case the `registered` field is used to indicated the number of
        -:  207:successfully registered methods.
        -:  208:
        -:  209:This must be passed for the [jerryx_release_property_entry](#jerryx_release_property_entry) method
        -:  210:after the property registration.
        -:  211:
        -:  212:If any error occurred during the property registration the `result` field of the structure
        -:  213:must be manually released after processing the error value.
        -:  214:
        -:  215:**Prototype**
        -:  216:
        -:  217:```c
        -:  218:typedef struct {
        -:  219:  jerry_value_t result;
        -:  220:  uint32_t registered;
        -:  221:} jerryx_register_result;
        -:  222:```
        -:  223:
        -:  224:**See also**
        -:  225:
        -:  226:- [jerryx_set_properties](#jerryx_set_properties)
        -:  227:- [jerryx_release_property_entry](#jerryx_release_property_entry)
        -:  228:
        -:  229:
        -:  230:## jerryx_set_properties
        -:  231:
        -:  232:**Summary**
        -:  233:
        -:  234:Set multiple properties on a target object.
        -:  235:
        -:  236:The properties are an array of (name, jerry_value_t) pairs and
        -:  237:this list must end with a (NULL, 0) entry.
        -:  238:
        -:  239:Important notes:
        -:  240:* Each property value in the input array is released after a successful property registration.
        -:  241:* The method [jerryx_release_property_entry](#jerryx_release_property_entry) must be called if there is any failed registration
        -:  242:  to release the values in the entries array.
        -:  243:  It is safe to call this cleanup method in every case not just in case of failure.
        -:  244:* If the error value is reported via the result it must be freed manually.
        -:  245:
        -:  246:**Prototype**
        -:  247:
        -:  248:```c
        -:  249:jerryx_register_result
        -:  250:jerryx_set_properties (const jerry_value_t target_object,
        -:  251:                       const jerryx_property_entry entries[]);
        -:  252:```
        -:  253:
        -:  254:- `target_object` - object on which the entries will be set.
        -:  255:- `entries` - array of (name, jerry_value_t) pairs.
        -:  256:- return a [jerryx_register_result](#jerryx_register_result).
        -:  257:   - if everything is ok, the struct's `result` field is set to a JS undefined value.
        -:  258:   - otherwise the `result` field is an error object indicating the problem.
        -:  259:   - in every case the `registered` field contains the number of successfully registered properties.
        -:  260:
        -:  261:**Example**
        -:  262:
        -:  263:[doctest]: # ()
        -:  264:
        -:  265:```c
        -:  266:#include "jerryscript.h"
        -:  267:#include "jerryscript-ext/handler.h"
        -:  268:
        -:  269:static jerry_value_t
    #####:  270:handler (const jerry_call_info_t *call_info_p,
        -:  271:         const jerry_value_t args_p[],
        -:  272:         const jerry_length_t args_cnt)
        -:  273:{
    #####:  274:  printf ("native handler called!\n");
        -:  275:
    #####:  276:  return jerry_boolean (true);
        -:  277:}
        -:  278:
        -:  279:int
    #####:  280:main (int argc, char **argv)
        -:  281:{
    #####:  282:  jerry_init (JERRY_INIT_EMPTY);
        -:  283:
    #####:  284:  jerryx_property_entry methods[] =
        -:  285:  {
    #####:  286:    { "demo", jerry_function_external (handler) },
        -:  287:    { NULL, 0 },
        -:  288:  };
        -:  289:
    #####:  290:  jerry_value_t global = jerry_current_realm ();
    #####:  291:  jerryx_register_result reg = jerryx_set_properties (global, methods);
        -:  292:  /* if `reg.result` is undefined all methods are registered */
    #####:  293:  if (jerry_value_is_exception (reg.result))
        -:  294:  {
    #####:  295:    printf ("Only registered %d properties\r\n", reg.registered);
        -:  296:    /* clean up not registered property values */
    #####:  297:    jerryx_release_property_entry (methods, reg);
        -:  298:
        -:  299:    /* clean up the error */
    #####:  300:    jerry_value_free (reg.result);
        -:  301:  }
        -:  302:
    #####:  303:  jerry_value_free (global);
        -:  304:
    #####:  305:  jerry_cleanup();
        -:  306:
        -:  307:  return 0;
        -:  308:}
        -:  309:```
        -:  310:
        -:  311:**Convenience macros**
        -:  312:
        -:  313:To make property registration convenient, there are a set of macros to use
        -:  314:when setting a property entry:
        -:  315:
        -:  316:* `JERRYX_PROPERTY_NUMBER(NAME, NUMBER)` - creates a number entry.
        -:  317:* `JERRYX_PROPERTY_STRING(NAME, STR, SIZE)` - creates an UTF-8 string entry using `SIZE` bytes from the string.
        -:  318:* `JERRYX_PROPERTY_STRING_SZ(NAME, STR)` - creates an ASCII string entry. This string must be zero terminated.
        -:  319:* `JERRYX_PROPERTY_BOOLEAN(NAME, VALUE)` - creates a boolean entry.
        -:  320:* `JERRYX_PROPERTY_FUNCTION(NAME, NATIVE)` - creates a native C function entry.
        -:  321:* `JERRYX_PROPERTY_UNDEFINED(NAME)` - creates an undefined property entry.
        -:  322:* `JERRYX_PROPERTY_LIST_END()` - indicates the end of the property list.
        -:  323:
        -:  324:**Example usage of Convenience macros**
        -:  325:
        -:  326:[doctest]: # ()
        -:  327:
        -:  328:```c
        -:  329:#include "jerryscript.h"
        -:  330:#include "jerryscript-ext/handler.h"
        -:  331:
        -:  332:static jerry_value_t
    #####:  333:handler (const jerry_call_info_t *call_info_p,
        -:  334:         const jerry_value_t args_p[],
        -:  335:         const jerry_length_t args_cnt)
        -:  336:{
    #####:  337:  printf ("native handler called!\n");
        -:  338:
    #####:  339:  return jerry_boolean (true);
        -:  340:}
        -:  341:
        -:  342:int
    #####:  343:main (int argc, char **argv)
        -:  344:{
    #####:  345:  jerry_init (JERRY_INIT_EMPTY);
        -:  346:
        -:  347:  /**
        -:  348:   * Create a array of properties to be registered.
        -:  349:   * This must be done after initializing the engine as creating `jerry_value_t`
        -:  350:   * elements are invalid before `jerry_init`.
        -:  351:   */
    #####:  352:  jerryx_property_entry methods[] =
        -:  353:  {
    #####:  354:    JERRYX_PROPERTY_FUNCTION ("demo", handler),
    #####:  355:    JERRYX_PROPERTY_NUMBER ("test_num", 2.3),
    #####:  356:    JERRYX_PROPERTY_UNDEFINED ("this_is_undefined"),
        -:  357:    JERRYX_PROPERTY_LIST_END(),
        -:  358:  };
        -:  359:
    #####:  360:  jerry_value_t global = jerry_current_realm ();
    #####:  361:  jerryx_register_result reg = jerryx_set_properties (global, methods);
        -:  362:  /* if `reg.result` is undefined all methods are registered */
    #####:  363:  if (jerry_value_is_exception (reg.result))
        -:  364:  {
    #####:  365:    printf ("Only registered %d properties\r\n", reg.registered);
        -:  366:    /* clean up not registered property values */
    #####:  367:    jerryx_release_property_entry (methods, reg);
        -:  368:
        -:  369:    /* clean up the error */
    #####:  370:    jerry_value_free (reg.result);
        -:  371:  }
        -:  372:
    #####:  373:  jerry_value_free (global);
        -:  374:
    #####:  375:  jerry_cleanup();
        -:  376:
        -:  377:  return 0;
        -:  378:}
        -:  379:```
        -:  380:
        -:  381:
        -:  382:**See also**
        -:  383:
        -:  384:- [jerryx_property_entry](#jerryx_property_entry)
        -:  385:- [jerryx_release_property_entry](#jerryx_release_property_entry)
        -:  386:- [jerryx_register_result](#jerryx_register_result)
        -:  387:
        -:  388:## jerryx_release_property_entry
        -:  389:
        -:  390:**Summary**
        -:  391:
        -:  392:Release all `jerry_value_t` in a `jerryx_property_entry` array based on a previous [jerryx_set_properties](#jerryx_set_properties) call
        -:  393:and also the error value (if any) in the `jerryx_register_result` structure.
        -:  394:In case of a successful registration it is safe to call this method.
        -:  395:
        -:  396:After the method call the `entries` array should not be used as all values are released.
        -:  397:
        -:  398:**Prototype**
        -:  399:
        -:  400:```
        -:  401:void
        -:  402:jerryx_release_property_entry (const jerryx_property_entry entries[],
        -:  403:                               const jerryx_register_result register_result);
        -:  404:```
        -:  405:
        -:  406:- `entries` - array of [jerryx_property_entry](#jerryx_property_entry).
        -:  407:- `register_result` - result of a previous [jerryx_set_properties](#jerryx_set_properties) call.
        -:  408:
        -:  409:**Example**
        -:  410:
        -:  411:For example usage see [jerryx_set_properties](#jerryx_set_properties).
        -:  412:
        -:  413:
        -:  414:#  Common external function handlers
        -:  415:
        -:  416:## jerryx_handler_assert_fatal
        -:  417:
        -:  418:**Summary**
        -:  419:
        -:  420:Hard assert for scripts. The routine calls `jerry_port_fatal` on assertion failure.
        -:  421:
        -:  422:If the `JERRY_FEATURE_LINE_INFO` runtime feature is enabled (build option: `JERRY_LINE_INFO`)
        -:  423:a backtrace is also printed out.
        -:  424:
        -:  425:**Prototype**
        -:  426:
        -:  427:```c
        -:  428:jerry_value_t
        -:  429:jerryx_handler_assert_fatal (const jerry_value_t func_obj_val, const jerry_value_t this_p,
        -:  430:                             const jerry_value_t args_p[], const jerry_length_t args_cnt);
        -:  431:```
        -:  432:
        -:  433:- `func_obj_val` - the function object that was called (unused).
        -:  434:- `this_p` - the `this` value of the call (unused).
        -:  435:- `args_p` - the array of function arguments.
        -:  436:- `args_cnt` - the number of function arguments.
        -:  437:- return value - `jerry_value_t` representing boolean true, if only one argument
        -:  438:  was passed and that argument was a boolean true. Note that the function does
        -:  439:  not return otherwise.
        -:  440:
        -:  441:**See also**
        -:  442:
        -:  443:- [jerryx_handler_register_global](#jerryx_handler_register_global)
        -:  444:
        -:  445:
        -:  446:## jerryx_handler_assert_throw
        -:  447:
        -:  448:**Summary**
        -:  449:
        -:  450:Soft assert for scripts. The routine throws an error on assertion failure.
        -:  451:
        -:  452:**Prototype**
        -:  453:
        -:  454:```c
        -:  455:jerry_value_t
        -:  456:jerryx_handler_assert_throw (const jerry_value_t func_obj_val, const jerry_value_t this_p,
        -:  457:                             const jerry_value_t args_p[], const jerry_length_t args_cnt);
        -:  458:```
        -:  459:
        -:  460:- `func_obj_val` - the function object that was called (unused).
        -:  461:- `this_p` - the `this` value of the call (unused).
        -:  462:- `args_p` - the array of function arguments.
        -:  463:- `args_cnt` - the number of function arguments.
        -:  464:- return value - `jerry_value_t` representing boolean true, if only one argument
        -:  465:  was passed and that argument was a boolean true, an error otherwise.
        -:  466:
        -:  467:**See also**
        -:  468:
        -:  469:- [jerryx_handler_register_global](#jerryx_handler_register_global)
        -:  470:
        -:  471:
        -:  472:## jerryx_handler_assert
        -:  473:
        -:  474:**Summary**
        -:  475:
        -:  476:An alias to `jerryx_handler_assert_fatal`.
        -:  477:
        -:  478:**See also**
        -:  479:
        -:  480:- [jerryx_handler_assert_fatal](#jerryx_handler_assert_fatal)
        -:  481:
        -:  482:
        -:  483:## jerryx_handler_gc
        -:  484:
        -:  485:**Summary**
        -:  486:
        -:  487:Expose garbage collector to scripts. If the first argument of the function
        -:  488:is logical true, it performs a high pressure gc. Otherwise a low pressure
        -:  489:gc is performed, which is also the default if no parameters passed.
        -:  490:
        -:  491:**Prototype**
        -:  492:
        -:  493:```c
        -:  494:jerry_value_t
        -:  495:jerryx_handler_gc (const jerry_value_t func_obj_val, const jerry_value_t this_p,
        -:  496:                   const jerry_value_t args_p[], const jerry_length_t args_cnt);
        -:  497:```
        -:  498:
        -:  499:- `func_obj_val` - the function object that was called (unused).
        -:  500:- `this_p` - the `this` value of the call (unused).
        -:  501:- `args_p` - the array of function arguments (unused).
        -:  502:- `args_cnt` - the number of function arguments (unused).
        -:  503:- return value - `jerry_value_t` representing `undefined`.
        -:  504:
        -:  505:**See also**
        -:  506:
        -:  507:- [jerryx_handler_register_global](#jerryx_handler_register_global)
        -:  508:
        -:  509:
        -:  510:## jerryx_handler_print
        -:  511:
        -:  512:**Summary**
        -:  513:
        -:  514:Provide a `print` implementation for scripts. The routine converts all of its
        -:  515:arguments to strings and outputs them char-by-char using
        -:  516:`jerry_port_print_char`. The NULL character is output as "\u0000",
        -:  517:other characters are output bytewise.
        -:  518:
        -:  519:*Note*: This implementation does not use standard C `printf` to print its
        -:  520:output. This allows more flexibility but also extends the core JerryScript
        -:  521:engine port API. Applications that want to use `jerryx_handler_print` must
        -:  522:ensure that their port implementation also provides
        -:  523:`jerry_port_print_char`.
        -:  524:
        -:  525:**Prototype**
        -:  526:
        -:  527:```c
        -:  528:jerry_value_t
        -:  529:jerryx_handler_print (const jerry_value_t func_obj_val, const jerry_value_t this_p,
        -:  530:                      const jerry_value_t args_p[], const jerry_length_t args_cnt);
        -:  531:```
        -:  532:
        -:  533:- `func_obj_val` - the function object that was called (unused).
        -:  534:- `this_p` - the `this` value of the call (unused).
        -:  535:- `args_p` - the array of function arguments.
        -:  536:- `args_cnt` - the number of function arguments.
        -:  537:- return value - `jerry_value_t` representing `undefined` if all arguments could
        -:  538:  be converted to strings, an `Error` otherwise.
        -:  539:
        -:  540:**See also**
        -:  541:
        -:  542:- [jerryx_handler_register_global](#jerryx_handler_register_global)
        -:  543:- [jerry_port_print_char](05.PORT-API.md#jerry_port_print_char)
        -:  544:
        -:  545:
        -:  546:# Handler registration helper
        -:  547:
        -:  548:## jerryx_handler_register_global
        -:  549:
        -:  550:**Summary**
        -:  551:
        -:  552:Register a JavaScript function in the global object.
        -:  553:
        -:  554:*Note*: Returned value must be freed with `jerry_value_free`, when it is no
        -:  555:longer needed.
        -:  556:
        -:  557:**Prototype**
        -:  558:
        -:  559:```c
        -:  560:jerry_value_t
        -:  561:jerryx_handler_register_global (const char *name_p,
        -:  562:                                jerry_external_handler_t handler_p);
        -:  563:```
        -:  564:
        -:  565:- `name_p` - the name of the function to be registered.
        -:  566:- `handler_p` - the address of the external function handler.
        -:  567:- return value - `jerry_value_t` representing boolean true, if the operation was
        -:  568:  successful, an `Error` otherwise.
        -:  569:
        -:  570:**Example**
        -:  571:
        -:  572:[doctest]: # (test="compile")
        -:  573:
        -:  574:```c
        -:  575:#include "jerryscript.h"
        -:  576:#include "jerryscript-ext/handler.h"
        -:  577:
        -:  578:static const struct {
        -:  579:  const char *name_p;
        -:  580:  jerry_external_handler_t handler_p;
        -:  581:} common_functions[] =
        -:  582:{
        -:  583:  { "assert", jerryx_handler_assert },
        -:  584:  { "gc", jerryx_handler_gc },
        -:  585:  { "print", jerryx_handler_print },
        -:  586:  { NULL, NULL }
        -:  587:};
        -:  588:
        -:  589:static void
        -:  590:register_common_functions (void)
        -:  591:{
        -:  592:  jerry_value_t ret = jerry_undefined ();
        -:  593:
        -:  594:  for (int i = 0; common_functions[i].name_p != NULL && !jerry_value_is_exception (ret); i++)
        -:  595:  {
        -:  596:    ret = jerryx_handler_register_global (common_functions[i].name_p,
        -:  597:                                          common_functions[i].handler_p);
        -:  598:  }
        -:  599:
        -:  600:  jerry_value_free (ret);
        -:  601:}
        -:  602:```
