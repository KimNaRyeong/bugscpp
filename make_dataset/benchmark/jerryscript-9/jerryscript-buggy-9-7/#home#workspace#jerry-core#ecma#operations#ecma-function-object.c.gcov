        -:    0:Source:/home/workspace/jerry-core/ecma/operations/ecma-function-object.c
        -:    0:Programs:297
        -:    1:/* Copyright JS Foundation and other contributors, http://js.foundation
        -:    2: *
        -:    3: * Licensed under the Apache License, Version 2.0 (the "License");
        -:    4: * you may not use this file except in compliance with the License.
        -:    5: * You may obtain a copy of the License at
        -:    6: *
        -:    7: *     http://www.apache.org/licenses/LICENSE-2.0
        -:    8: *
        -:    9: * Unless required by applicable law or agreed to in writing, software
        -:   10: * distributed under the License is distributed on an "AS IS" BASIS
        -:   11: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        -:   12: * See the License for the specific language governing permissions and
        -:   13: * limitations under the License.
        -:   14: */
        -:   15:
        -:   16:#include "ecma-function-object.h"
        -:   17:
        -:   18:#include "ecma-alloc.h"
        -:   19:#include "ecma-builtin-handlers.h"
        -:   20:#include "ecma-builtin-helpers.h"
        -:   21:#include "ecma-errors.h"
        -:   22:#include "ecma-exceptions.h"
        -:   23:#include "ecma-extended-info.h"
        -:   24:#include "ecma-gc.h"
        -:   25:#include "ecma-helpers.h"
        -:   26:#include "ecma-lex-env.h"
        -:   27:#include "ecma-objects-general.h"
        -:   28:#include "ecma-objects.h"
        -:   29:#include "ecma-promise-object.h"
        -:   30:#include "ecma-proxy-object.h"
        -:   31:#include "ecma-symbol-object.h"
        -:   32:
        -:   33:#include "jcontext.h"
        -:   34:#include "lit-char-helpers.h"
        -:   35:#include "opcodes.h"
        -:   36:
        -:   37:/** \addtogroup ecma ECMA
        -:   38: * @{
        -:   39: *
        -:   40: * \addtogroup ecmafunctionobject ECMA Function object related routines
        -:   41: * @{
        -:   42: */
        -:   43:
        -:   44:#if JERRY_ESNEXT
        -:   45:/**
        -:   46: * SetFunctionName operation
        -:   47: *
        -:   48: * See also: ECMAScript v6, 9.2.1.1
        -:   49: *
        -:   50: * @return source name as ecma-string
        -:   51: */
        -:   52:ecma_value_t
    #####:   53:ecma_op_function_form_name (ecma_string_t *prop_name_p, /**< property name */
        -:   54:                            char *prefix_p, /**< prefix */
        -:   55:                            lit_utf8_size_t prefix_size) /**< prefix length */
        -:   56:{
        -:   57:  /* 4. */
    #####:   58:  if (ecma_prop_name_is_symbol (prop_name_p))
        -:   59:  {
        -:   60:    /* .a */
    #####:   61:    ecma_value_t string_desc = ecma_get_symbol_description (prop_name_p);
        -:   62:
        -:   63:    /* .b */
    #####:   64:    if (ecma_is_value_undefined (string_desc))
        -:   65:    {
    #####:   66:      prop_name_p = ecma_get_magic_string (LIT_MAGIC_STRING__EMPTY);
        -:   67:    }
        -:   68:    /* .c */
        -:   69:    else
        -:   70:    {
    #####:   71:      ecma_string_t *string_desc_p = ecma_get_string_from_value (string_desc);
    #####:   72:      ecma_stringbuilder_t builder = ecma_stringbuilder_create_raw ((lit_utf8_byte_t *) "[", 1);
    #####:   73:      ecma_stringbuilder_append (&builder, string_desc_p);
    #####:   74:      ecma_stringbuilder_append_byte (&builder, (lit_utf8_byte_t) LIT_CHAR_RIGHT_SQUARE);
    #####:   75:      prop_name_p = ecma_stringbuilder_finalize (&builder);
        -:   76:    }
        -:   77:  }
        -:   78:  else
        -:   79:  {
    #####:   80:    ecma_ref_ecma_string (prop_name_p);
        -:   81:  }
        -:   82:
        -:   83:  /* 5. */
    #####:   84:  if (JERRY_UNLIKELY (prefix_p != NULL))
        -:   85:  {
    #####:   86:    ecma_stringbuilder_t builder = ecma_stringbuilder_create_raw ((lit_utf8_byte_t *) prefix_p, prefix_size);
    #####:   87:    ecma_stringbuilder_append (&builder, prop_name_p);
    #####:   88:    ecma_deref_ecma_string (prop_name_p);
    #####:   89:    prop_name_p = ecma_stringbuilder_finalize (&builder);
        -:   90:  }
        -:   91:
    #####:   92:  return ecma_make_string_value (prop_name_p);
        -:   93:} /* ecma_op_function_form_name */
        -:   94:#endif /* JERRY_ESNEXT */
        -:   95:
        -:   96:#if JERRY_BUILTIN_PROXY
        -:   97:/**
        -:   98: * IsCallable operation for proxy object.
        -:   99: *
        -:  100: * @return true - if the given proxy object is callable;
        -:  101: *         false - otherwise
        -:  102: */
        -:  103:extern inline bool JERRY_ATTR_ALWAYS_INLINE
    #####:  104:ecma_op_proxy_object_is_callable (ecma_object_t *obj_p) /**< ecma object */
        -:  105:{
    #####:  106:  JERRY_ASSERT (!ecma_is_lexical_environment (obj_p));
    #####:  107:  JERRY_ASSERT (ECMA_OBJECT_IS_PROXY (obj_p));
        -:  108:
    #####:  109:  return (obj_p->u2.prototype_cp & ECMA_PROXY_IS_CALLABLE) != 0;
        -:  110:} /* ecma_op_proxy_object_is_callable */
        -:  111:#endif /* JERRY_BUILTIN_PROXY */
        -:  112:
        -:  113:/**
        -:  114: * IsCallable operation.
        -:  115: *
        -:  116: * See also: ECMA-262 v5, 9.11
        -:  117: *
        -:  118: * @return true - if the given object is callable;
        -:  119: *         false - otherwise
        -:  120: */
        -:  121:extern inline bool JERRY_ATTR_ALWAYS_INLINE
    #####:  122:ecma_op_object_is_callable (ecma_object_t *obj_p) /**< ecma object */
        -:  123:{
<<<<<<< HEAD
    11907:  124:  JERRY_ASSERT (!ecma_is_lexical_environment (obj_p));
        -:  125:
    11907:  126:  const ecma_object_type_t type = ecma_get_object_type (obj_p);
        -:  127:
        -:  128:#if JERRY_BUILTIN_PROXY
    11907:  129:  if (ECMA_OBJECT_TYPE_IS_PROXY (type))
=======
    11909:  124:  JERRY_ASSERT (!ecma_is_lexical_environment (obj_p));
        -:  125:
    11909:  126:  const ecma_object_type_t type = ecma_get_object_type (obj_p);
        -:  127:
        -:  128:#if JERRY_BUILTIN_PROXY
    11909:  129:  if (ECMA_OBJECT_TYPE_IS_PROXY (type))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  130:  {
    #####:  131:    return ecma_op_proxy_object_is_callable (obj_p);
        -:  132:  }
        -:  133:#endif /* JERRY_BUILTIN_PROXY */
        -:  134:
<<<<<<< HEAD
    11907:  135:  return type >= ECMA_OBJECT_TYPE_FUNCTION;
=======
    11909:  135:  return type >= ECMA_OBJECT_TYPE_FUNCTION;
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  136:} /* ecma_op_object_is_callable */
        -:  137:
        -:  138:/**
        -:  139: * IsCallable operation.
        -:  140: *
        -:  141: * See also: ECMA-262 v5, 9.11
        -:  142: *
        -:  143: * @return true - if value is callable object;
        -:  144: *         false - otherwise
        -:  145: */
        -:  146:bool
    #####:  147:ecma_op_is_callable (ecma_value_t value) /**< ecma value */
        -:  148:{
    #####:  149:  return (ecma_is_value_object (value) && ecma_op_object_is_callable (ecma_get_object_from_value (value)));
        -:  150:} /* ecma_op_is_callable */
        -:  151:
        -:  152:/**
        -:  153: * Implement IsConstructor abstract operation.
        -:  154: *
        -:  155: *
        -:  156: * @return ECMA_IS_VALID_CONSTRUCTOR - if object is a valid for constructor call
        -:  157: *         ecma_error_msg_t id of error - otherwise
        -:  158: */
        -:  159:ecma_error_msg_t
<<<<<<< HEAD
    11907:  160:ecma_object_check_constructor (ecma_object_t *obj_p) /**< ecma object */
        -:  161:{
    11907:  162:  JERRY_ASSERT (!ecma_is_lexical_environment (obj_p));
        -:  163:
    11907:  164:  ecma_object_type_t type = ecma_get_object_type (obj_p);
        -:  165:
    11907:  166:  if (JERRY_UNLIKELY (type < ECMA_OBJECT_TYPE_PROXY))
=======
    11909:  160:ecma_object_check_constructor (ecma_object_t *obj_p) /**< ecma object */
        -:  161:{
    11909:  162:  JERRY_ASSERT (!ecma_is_lexical_environment (obj_p));
        -:  163:
    11909:  164:  ecma_object_type_t type = ecma_get_object_type (obj_p);
        -:  165:
    11909:  166:  if (JERRY_UNLIKELY (type < ECMA_OBJECT_TYPE_PROXY))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  167:  {
    #####:  168:    return ECMA_ERR_INVALID_TYPE_FOR_CONSTRUCTOR_CALL;
        -:  169:  }
        -:  170:
<<<<<<< HEAD
    23814:  171:  while (JERRY_UNLIKELY (type == ECMA_OBJECT_TYPE_BOUND_FUNCTION))
=======
    23818:  171:  while (JERRY_UNLIKELY (type == ECMA_OBJECT_TYPE_BOUND_FUNCTION))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  172:  {
    #####:  173:    ecma_bound_function_t *bound_func_p = (ecma_bound_function_t *) obj_p;
        -:  174:
    #####:  175:    obj_p =
    #####:  176:      ECMA_GET_NON_NULL_POINTER_FROM_POINTER_TAG (ecma_object_t, bound_func_p->header.u.bound_function.target_function);
        -:  177:
    #####:  178:    type = ecma_get_object_type (obj_p);
        -:  179:  }
        -:  180:
<<<<<<< HEAD
    11907:  181:  if (JERRY_LIKELY (type == ECMA_OBJECT_TYPE_FUNCTION))
        -:  182:  {
        -:  183:#if JERRY_ESNEXT
    11907:  184:    const ecma_compiled_code_t *byte_code_p = ecma_op_function_get_compiled_code ((ecma_extended_object_t *) obj_p);
        -:  185:
    11907:  186:    if (!CBC_FUNCTION_IS_CONSTRUCTABLE (byte_code_p->status_flags))
=======
    11909:  181:  if (JERRY_LIKELY (type == ECMA_OBJECT_TYPE_FUNCTION))
        -:  182:  {
        -:  183:#if JERRY_ESNEXT
    11909:  184:    const ecma_compiled_code_t *byte_code_p = ecma_op_function_get_compiled_code ((ecma_extended_object_t *) obj_p);
        -:  185:
    11909:  186:    if (!CBC_FUNCTION_IS_CONSTRUCTABLE (byte_code_p->status_flags))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  187:    {
        -:  188:#if JERRY_ERROR_MESSAGES
    #####:  189:      switch (CBC_FUNCTION_GET_TYPE (byte_code_p->status_flags))
        -:  190:      {
    #####:  191:        case CBC_FUNCTION_SCRIPT:
        -:  192:        {
    #####:  193:          return ECMA_ERR_SCRIPT_GLOBAL_FUNCTIONS_INVOKE_WITH_NEW;
        -:  194:        }
    #####:  195:        case CBC_FUNCTION_GENERATOR:
        -:  196:        {
    #####:  197:          return ECMA_ERR_GENERATOR_FUNCTIONS_INVOKE_WITH_NEW;
        -:  198:        }
    #####:  199:        case CBC_FUNCTION_ASYNC:
        -:  200:        {
    #####:  201:          return ECMA_ERR_ASYNC_FUNCTIONS_INVOKE_WITH_NEW;
        -:  202:        }
    #####:  203:        case CBC_FUNCTION_ASYNC_GENERATOR:
        -:  204:        {
    #####:  205:          return ECMA_ERR_ASYNC_GENERATOR_FUNCTIONS_INVOKE_WITH_NEW;
        -:  206:        }
    #####:  207:        case CBC_FUNCTION_ACCESSOR:
        -:  208:        {
    #####:  209:          return ECMA_ERR_ACCESSOR_FUNCTIONS_INVOKE_WITH_NEW;
        -:  210:        }
    #####:  211:        case CBC_FUNCTION_METHOD:
        -:  212:        {
    #####:  213:          return ECMA_ERR_METHODS_INVOKE_WITH_NEW;
        -:  214:        }
    #####:  215:        case CBC_FUNCTION_ARROW:
        -:  216:        {
    #####:  217:          return ECMA_ERR_ARROW_FUNCTIONS_INVOKE_WITH_NEW;
        -:  218:        }
    #####:  219:        default:
        -:  220:        {
    #####:  221:          JERRY_ASSERT (CBC_FUNCTION_GET_TYPE (byte_code_p->status_flags) == CBC_FUNCTION_ASYNC_ARROW);
    #####:  222:          return ECMA_ERR_ASYNC_ARROW_FUNCTIONS_INVOKE_WITH_NEW;
        -:  223:        }
        -:  224:      }
        -:  225:#else /* !JERRY_ERROR_MESSAGES */
        -:  226:      return ECMA_ERR_EMPTY;
        -:  227:#endif /* JERRY_ERROR_MESSAGES */
        -:  228:    }
        -:  229:#endif /* JERRY_NEXT */
        -:  230:
<<<<<<< HEAD
    11907:  231:    return ECMA_IS_VALID_CONSTRUCTOR;
=======
    11909:  231:    return ECMA_IS_VALID_CONSTRUCTOR;
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  232:  }
        -:  233:
        -:  234:#if JERRY_BUILTIN_PROXY
    #####:  235:  if (ECMA_OBJECT_TYPE_IS_PROXY (type))
        -:  236:  {
    #####:  237:    if (!(obj_p->u2.prototype_cp & ECMA_PROXY_IS_CONSTRUCTABLE))
        -:  238:    {
    #####:  239:      return ECMA_ERR_PROXY_TARGET_IS_NOT_A_CONSTRUCTOR;
        -:  240:    }
        -:  241:
    #####:  242:    return ECMA_IS_VALID_CONSTRUCTOR;
        -:  243:  }
        -:  244:#endif /* JERRY_BUILTIN_PROXY */
        -:  245:
    #####:  246:  JERRY_ASSERT (type == ECMA_OBJECT_TYPE_NATIVE_FUNCTION || type == ECMA_OBJECT_TYPE_BUILT_IN_FUNCTION
        -:  247:                || type == ECMA_OBJECT_TYPE_CONSTRUCTOR_FUNCTION);
        -:  248:
    #####:  249:  if (type == ECMA_OBJECT_TYPE_BUILT_IN_FUNCTION)
        -:  250:  {
    #####:  251:    if (ecma_builtin_function_is_routine (obj_p))
        -:  252:    {
    #####:  253:      return ECMA_ERR_BULTIN_ROUTINES_HAVE_NO_CONSTRUCTOR;
        -:  254:    }
        -:  255:
        -:  256:#if JERRY_ESNEXT
    #####:  257:    JERRY_ASSERT (((ecma_extended_object_t *) obj_p)->u.built_in.id != ECMA_BUILTIN_ID_HANDLER);
        -:  258:#endif /* !JERRY_ESNEXT */
        -:  259:  }
        -:  260:
    #####:  261:  return ECMA_IS_VALID_CONSTRUCTOR;
        -:  262:} /* ecma_object_check_constructor */
        -:  263:
        -:  264:/**
        -:  265: * Implement IsConstructor abstract operation.
        -:  266: *
        -:  267: * @return ECMA_IS_VALID_CONSTRUCTOR - if the input value is a constructor.
        -:  268: *         ecma_error_msg_t id of error - otherwise
        -:  269: */
        -:  270:extern inline ecma_error_msg_t JERRY_ATTR_ALWAYS_INLINE
<<<<<<< HEAD
    11907:  271:ecma_check_constructor (ecma_value_t value) /**< ecma object */
        -:  272:{
    11907:  273:  if (!ecma_is_value_object (value))
=======
    11909:  271:ecma_check_constructor (ecma_value_t value) /**< ecma object */
        -:  272:{
    11909:  273:  if (!ecma_is_value_object (value))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  274:  {
    #####:  275:    return ECMA_ERR_INVALID_TYPE_FOR_CONSTRUCTOR_CALL;
        -:  276:  }
        -:  277:
<<<<<<< HEAD
    11907:  278:  return ecma_object_check_constructor (ecma_get_object_from_value (value));
=======
    11909:  278:  return ecma_object_check_constructor (ecma_get_object_from_value (value));
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  279:} /* ecma_check_constructor */
        -:  280:
        -:  281:/**
        -:  282: * Checks whether the given object implements [[Construct]].
        -:  283: *
        -:  284: * @return true - if the given object is constructor;
        -:  285: *         false - otherwise
        -:  286: */
        -:  287:extern inline bool JERRY_ATTR_ALWAYS_INLINE
    #####:  288:ecma_object_is_constructor (ecma_object_t *obj_p) /**< ecma object */
        -:  289:{
    #####:  290:  return ecma_object_check_constructor (obj_p) == ECMA_IS_VALID_CONSTRUCTOR;
        -:  291:} /* ecma_object_is_constructor */
        -:  292:
        -:  293:/**
        -:  294: * Checks whether the value is Object that implements [[Construct]].
        -:  295: *
        -:  296: * @return true - if value is constructor object;
        -:  297: *         false - otherwise
        -:  298: */
        -:  299:bool
    #####:  300:ecma_is_constructor (ecma_value_t value) /**< ecma value */
        -:  301:{
    #####:  302:  return (ecma_is_value_object (value) && ecma_object_is_constructor (ecma_get_object_from_value (value)));
        -:  303:} /* ecma_is_constructor */
        -:  304:
        -:  305:/**
        -:  306: * Helper method to count and convert the arguments for the Function/GeneratorFunction constructor call.
        -:  307: *
        -:  308: * See also:
        -:  309: *          ECMA 262 v5.1 15.3.2.1 steps 5.a-d
        -:  310: *          ECMA 262 v6 19.2.1.1.1 steps 8
        -:  311: *
        -:  312: * @return ecma value - concatenated arguments as a string.
        -:  313: *         Returned value must be freed with ecma_free_value.
        -:  314: */
        -:  315:static ecma_string_t *
    #####:  316:ecma_op_create_dynamic_function_arguments_helper (const ecma_value_t *arguments_list_p, /**< arguments list */
        -:  317:                                                  uint32_t arguments_list_len) /**< number of arguments */
        -:  318:{
    #####:  319:  JERRY_ASSERT (arguments_list_len == 0 || arguments_list_p != NULL);
        -:  320:
    #####:  321:  if (arguments_list_len <= 1)
        -:  322:  {
    #####:  323:    return ecma_get_magic_string (LIT_MAGIC_STRING__EMPTY);
        -:  324:  }
        -:  325:
    #####:  326:  ecma_string_t *str_p = ecma_op_to_string (arguments_list_p[0]);
        -:  327:
    #####:  328:  if (JERRY_UNLIKELY (str_p == NULL))
        -:  329:  {
    #####:  330:    return str_p;
        -:  331:  }
        -:  332:
    #####:  333:  if (arguments_list_len == 2)
        -:  334:  {
    #####:  335:    return str_p;
        -:  336:  }
        -:  337:
    #####:  338:  ecma_stringbuilder_t builder = ecma_stringbuilder_create_from (str_p);
    #####:  339:  ecma_deref_ecma_string (str_p);
        -:  340:
    #####:  341:  for (uint32_t idx = 1; idx < arguments_list_len - 1; idx++)
        -:  342:  {
    #####:  343:    str_p = ecma_op_to_string (arguments_list_p[idx]);
        -:  344:
    #####:  345:    if (JERRY_UNLIKELY (str_p == NULL))
        -:  346:    {
    #####:  347:      ecma_stringbuilder_destroy (&builder);
    #####:  348:      return str_p;
        -:  349:    }
        -:  350:
    #####:  351:    ecma_stringbuilder_append_char (&builder, LIT_CHAR_COMMA);
    #####:  352:    ecma_stringbuilder_append (&builder, str_p);
    #####:  353:    ecma_deref_ecma_string (str_p);
        -:  354:  }
        -:  355:
    #####:  356:  return ecma_stringbuilder_finalize (&builder);
        -:  357:} /* ecma_op_create_dynamic_function_arguments_helper */
        -:  358:
        -:  359:/**
        -:  360: * Function object creation operation.
        -:  361: *
        -:  362: * See also: ECMA-262 v5, 13.2
        -:  363: *
        -:  364: * @return pointer to newly created Function object
        -:  365: */
        -:  366:static ecma_object_t *
        1:  367:ecma_op_create_function_object (ecma_object_t *scope_p, /**< function's scope */
        -:  368:                                const ecma_compiled_code_t *bytecode_data_p, /**< byte-code array */
        -:  369:                                ecma_builtin_id_t proto_id) /**< builtin id of the prototype object */
        -:  370:{
        1:  371:  JERRY_ASSERT (ecma_is_lexical_environment (scope_p));
        -:  372:
        -:  373:  /* 1., 4., 13. */
        1:  374:  ecma_object_t *prototype_obj_p = ecma_builtin_get (proto_id);
        -:  375:
        1:  376:  size_t function_object_size = sizeof (ecma_extended_object_t);
        -:  377:
        -:  378:#if JERRY_SNAPSHOT_EXEC
    #####:  379:  if (bytecode_data_p->status_flags & CBC_CODE_FLAGS_STATIC_FUNCTION)
        -:  380:  {
    #####:  381:    function_object_size = sizeof (ecma_static_function_t);
        -:  382:  }
        -:  383:#endif /* JERRY_SNAPSHOT_EXEC */
        -:  384:
        1:  385:  ecma_object_t *func_p = ecma_create_object (prototype_obj_p, function_object_size, ECMA_OBJECT_TYPE_FUNCTION);
        -:  386:
        -:  387:  /* 2., 6., 7., 8. */
        -:  388:  /*
        -:  389:   * We don't setup [[Get]], [[Call]], [[Construct]], [[HasInstance]] for each function object.
        -:  390:   * Instead we set the object's type to ECMA_OBJECT_TYPE_FUNCTION
        -:  391:   * that defines which version of the routine should be used on demand.
        -:  392:   */
        -:  393:
        -:  394:  /* 3. */
        -:  395:  /*
        -:  396:   * [[Class]] property is not stored explicitly for objects of ECMA_OBJECT_TYPE_FUNCTION type.
        -:  397:   *
        -:  398:   * See also: ecma_object_get_class_name
        -:  399:   */
        -:  400:
        1:  401:  ecma_extended_object_t *ext_func_p = (ecma_extended_object_t *) func_p;
        -:  402:
        -:  403:  /* 9. */
        1:  404:  ECMA_SET_NON_NULL_POINTER_TAG (ext_func_p->u.function.scope_cp, scope_p, 0);
        -:  405:
        -:  406:  /* 10., 11., 12. */
        -:  407:
        -:  408:#if JERRY_SNAPSHOT_EXEC
    #####:  409:  if (bytecode_data_p->status_flags & CBC_CODE_FLAGS_STATIC_FUNCTION)
        -:  410:  {
    #####:  411:    ext_func_p->u.function.bytecode_cp = JMEM_CP_NULL;
    #####:  412:    ((ecma_static_function_t *) func_p)->bytecode_p = bytecode_data_p;
        -:  413:  }
        -:  414:  else
        -:  415:#endif /* JERRY_SNAPSHOT_EXEC */
        -:  416:  {
        1:  417:    ECMA_SET_INTERNAL_VALUE_POINTER (ext_func_p->u.function.bytecode_cp, bytecode_data_p);
        1:  418:    ecma_bytecode_ref ((ecma_compiled_code_t *) bytecode_data_p);
        -:  419:  }
        -:  420:
        -:  421:  /* 14., 15., 16., 17., 18. */
        -:  422:  /*
        -:  423:   * 'length' and 'prototype' properties are instantiated lazily
        -:  424:   *
        -:  425:   * See also: ecma_op_function_try_to_lazy_instantiate_property
        -:  426:   */
        -:  427:
        1:  428:  return func_p;
        -:  429:} /* ecma_op_create_function_object */
        -:  430:
        -:  431:/**
        -:  432: * CreateDynamicFunction operation
        -:  433: *
        -:  434: * See also:
        -:  435: *          ECMA-262 v5, 15.3.
        -:  436: *          ECMA-262 v6, 19.2.1.1
        -:  437: *
        -:  438: * @return ECMA_VALUE_ERROR - if the operation fails
        -:  439: *         constructed function object - otherwise
        -:  440: */
        -:  441:ecma_value_t
    #####:  442:ecma_op_create_dynamic_function (const ecma_value_t *arguments_list_p, /**< arguments list */
        -:  443:                                 uint32_t arguments_list_len, /**< number of arguments */
        -:  444:                                 ecma_parse_opts_t parse_opts) /**< parse options */
        -:  445:{
    #####:  446:  JERRY_ASSERT (arguments_list_len == 0 || arguments_list_p != NULL);
        -:  447:
    #####:  448:  ecma_string_t *arguments_str_p =
        -:  449:    ecma_op_create_dynamic_function_arguments_helper (arguments_list_p, arguments_list_len);
        -:  450:
    #####:  451:  if (JERRY_UNLIKELY (arguments_str_p == NULL))
        -:  452:  {
    #####:  453:    return ECMA_VALUE_ERROR;
        -:  454:  }
        -:  455:
        -:  456:  ecma_string_t *function_body_str_p;
        -:  457:
    #####:  458:  if (arguments_list_len > 0)
        -:  459:  {
    #####:  460:    function_body_str_p = ecma_op_to_string (arguments_list_p[arguments_list_len - 1]);
        -:  461:
    #####:  462:    if (JERRY_UNLIKELY (function_body_str_p == NULL))
        -:  463:    {
    #####:  464:      ecma_deref_ecma_string (arguments_str_p);
    #####:  465:      return ECMA_VALUE_ERROR;
        -:  466:    }
        -:  467:  }
        -:  468:  else
        -:  469:  {
        -:  470:    /* Very unlikely code path, not optimized. */
    #####:  471:    function_body_str_p = ecma_get_magic_string (LIT_MAGIC_STRING__EMPTY);
        -:  472:  }
        -:  473:
    #####:  474:  ecma_value_t source[2];
    #####:  475:  source[0] = ecma_make_string_value (function_body_str_p);
    #####:  476:  source[1] = ecma_make_string_value (arguments_str_p);
        -:  477:
    #####:  478:  parse_opts |= ECMA_PARSE_HAS_SOURCE_VALUE | ECMA_PARSE_HAS_ARGUMENT_LIST_VALUE;
        -:  479:
    #####:  480:  ecma_compiled_code_t *bytecode_p = parser_parse_script ((void *) source, parse_opts, NULL);
        -:  481:
    #####:  482:  ecma_deref_ecma_string (arguments_str_p);
    #####:  483:  ecma_deref_ecma_string (function_body_str_p);
        -:  484:
    #####:  485:  if (JERRY_UNLIKELY (bytecode_p == NULL))
        -:  486:  {
    #####:  487:    return ECMA_VALUE_ERROR;
        -:  488:  }
        -:  489:
        -:  490:#if JERRY_ESNEXT
        -:  491:  ecma_value_t *func_name_p;
    #####:  492:  func_name_p = ecma_compiled_code_resolve_function_name ((const ecma_compiled_code_t *) bytecode_p);
    #####:  493:  *func_name_p = ecma_make_magic_string_value (LIT_MAGIC_STRING_ANONYMOUS);
        -:  494:#endif /* JERRY_ESNEXT */
        -:  495:
    #####:  496:  ecma_object_t *global_object_p = ecma_builtin_get_global ();
        -:  497:
        -:  498:#if JERRY_BUILTIN_REALMS
    #####:  499:  JERRY_ASSERT (global_object_p == (ecma_object_t *) ecma_op_function_get_realm (bytecode_p));
        -:  500:#endif /* JERRY_BUILTIN_REALMS */
        -:  501:
    #####:  502:  ecma_object_t *global_env_p = ecma_get_global_environment (global_object_p);
    #####:  503:  ecma_builtin_id_t fallback_proto = ECMA_BUILTIN_ID_FUNCTION_PROTOTYPE;
        -:  504:
        -:  505:#if JERRY_ESNEXT
    #####:  506:  ecma_object_t *new_target_p = JERRY_CONTEXT (current_new_target_p);
    #####:  507:  ecma_builtin_id_t fallback_ctor = ECMA_BUILTIN_ID_FUNCTION;
        -:  508:
    #####:  509:  if (JERRY_UNLIKELY (parse_opts & (ECMA_PARSE_GENERATOR_FUNCTION | ECMA_PARSE_ASYNC_FUNCTION)))
        -:  510:  {
    #####:  511:    fallback_proto = ECMA_BUILTIN_ID_ASYNC_GENERATOR;
    #####:  512:    fallback_ctor = ECMA_BUILTIN_ID_ASYNC_GENERATOR_FUNCTION;
        -:  513:
    #####:  514:    if (!(parse_opts & ECMA_PARSE_GENERATOR_FUNCTION))
        -:  515:    {
    #####:  516:      fallback_proto = ECMA_BUILTIN_ID_ASYNC_FUNCTION_PROTOTYPE;
    #####:  517:      fallback_ctor = ECMA_BUILTIN_ID_ASYNC_FUNCTION;
        -:  518:    }
    #####:  519:    else if (!(parse_opts & ECMA_PARSE_ASYNC_FUNCTION))
        -:  520:    {
    #####:  521:      fallback_proto = ECMA_BUILTIN_ID_GENERATOR;
    #####:  522:      fallback_ctor = ECMA_BUILTIN_ID_GENERATOR_FUNCTION;
        -:  523:    }
        -:  524:  }
        -:  525:
    #####:  526:  if (new_target_p == NULL)
        -:  527:  {
    #####:  528:    new_target_p = ecma_builtin_get (fallback_ctor);
        -:  529:  }
        -:  530:
    #####:  531:  ecma_object_t *proto = ecma_op_get_prototype_from_constructor (new_target_p, fallback_proto);
        -:  532:
    #####:  533:  if (JERRY_UNLIKELY (proto == NULL))
        -:  534:  {
    #####:  535:    ecma_bytecode_deref (bytecode_p);
    #####:  536:    return ECMA_VALUE_ERROR;
        -:  537:  }
        -:  538:#endif /* JERRY_ESNEXT */
        -:  539:
    #####:  540:  ecma_object_t *func_obj_p = ecma_op_create_function_object (global_env_p, bytecode_p, fallback_proto);
        -:  541:
        -:  542:#if JERRY_ESNEXT
    #####:  543:  ECMA_SET_NON_NULL_POINTER (func_obj_p->u2.prototype_cp, proto);
    #####:  544:  ecma_deref_object (proto);
        -:  545:#endif /* JERRY_ESNEXT */
        -:  546:
    #####:  547:  ecma_bytecode_deref (bytecode_p);
    #####:  548:  return ecma_make_object_value (func_obj_p);
        -:  549:} /* ecma_op_create_dynamic_function */
        -:  550:
        -:  551:/**
        -:  552: * Function object creation operation.
        -:  553: *
        -:  554: * See also: ECMA-262 v5, 13.2
        -:  555: *
        -:  556: * @return pointer to newly created Function object
        -:  557: */
        -:  558:ecma_object_t *
    #####:  559:ecma_op_create_simple_function_object (ecma_object_t *scope_p, /**< function's scope */
        -:  560:                                       const ecma_compiled_code_t *bytecode_data_p) /**< byte-code array */
        -:  561:{
    #####:  562:  return ecma_op_create_function_object (scope_p, bytecode_data_p, ECMA_BUILTIN_ID_FUNCTION_PROTOTYPE);
        -:  563:} /* ecma_op_create_simple_function_object */
        -:  564:
        -:  565:#if JERRY_ESNEXT
        -:  566:
        -:  567:/**
        -:  568: * Create a function object with the appropriate prototype.
        -:  569: *
        -:  570: * @return pointer to newly created Function object
        -:  571: */
        -:  572:ecma_object_t *
        1:  573:ecma_op_create_any_function_object (ecma_object_t *scope_p, /**< function's scope */
        -:  574:                                    const ecma_compiled_code_t *bytecode_data_p) /**< byte-code array */
        -:  575:{
        -:  576:  ecma_builtin_id_t proto_id;
        -:  577:
        1:  578:  switch (CBC_FUNCTION_GET_TYPE (bytecode_data_p->status_flags))
        -:  579:  {
    #####:  580:    case CBC_FUNCTION_GENERATOR:
        -:  581:    {
    #####:  582:      proto_id = ECMA_BUILTIN_ID_GENERATOR;
    #####:  583:      break;
        -:  584:    }
    #####:  585:    case CBC_FUNCTION_ASYNC:
        -:  586:    {
    #####:  587:      proto_id = ECMA_BUILTIN_ID_ASYNC_FUNCTION_PROTOTYPE;
    #####:  588:      break;
        -:  589:    }
    #####:  590:    case CBC_FUNCTION_ASYNC_GENERATOR:
        -:  591:    {
    #####:  592:      proto_id = ECMA_BUILTIN_ID_ASYNC_GENERATOR;
    #####:  593:      break;
        -:  594:    }
        1:  595:    default:
        -:  596:    {
        1:  597:      proto_id = ECMA_BUILTIN_ID_FUNCTION_PROTOTYPE;
        1:  598:      break;
        -:  599:    }
        -:  600:  }
        -:  601:
        1:  602:  return ecma_op_create_function_object (scope_p, bytecode_data_p, proto_id);
        -:  603:} /* ecma_op_create_any_function_object */
        -:  604:
        -:  605:/**
        -:  606: * Arrow function object creation operation.
        -:  607: *
        -:  608: * See also: ES2015, 9.2.12
        -:  609: *
        -:  610: * @return pointer to newly created Function object
        -:  611: */
        -:  612:ecma_object_t *
    #####:  613:ecma_op_create_arrow_function_object (ecma_object_t *scope_p, /**< function's scope */
        -:  614:                                      const ecma_compiled_code_t *bytecode_data_p, /**< byte-code array */
        -:  615:                                      ecma_value_t this_binding) /**< value of 'this' binding */
        -:  616:{
        -:  617:  ecma_object_t *prototype_obj_p;
        -:  618:
    #####:  619:  if (CBC_FUNCTION_GET_TYPE (bytecode_data_p->status_flags) == CBC_FUNCTION_ARROW)
        -:  620:  {
    #####:  621:    prototype_obj_p = ecma_builtin_get (ECMA_BUILTIN_ID_FUNCTION_PROTOTYPE);
        -:  622:  }
        -:  623:  else
        -:  624:  {
    #####:  625:    JERRY_ASSERT (CBC_FUNCTION_GET_TYPE (bytecode_data_p->status_flags) == CBC_FUNCTION_ASYNC_ARROW);
    #####:  626:    prototype_obj_p = ecma_builtin_get (ECMA_BUILTIN_ID_ASYNC_FUNCTION_PROTOTYPE);
        -:  627:  }
        -:  628:
    #####:  629:  size_t arrow_function_object_size = sizeof (ecma_arrow_function_t);
        -:  630:
        -:  631:#if JERRY_SNAPSHOT_EXEC
    #####:  632:  if (bytecode_data_p->status_flags & CBC_CODE_FLAGS_STATIC_FUNCTION)
        -:  633:  {
    #####:  634:    arrow_function_object_size = sizeof (ecma_static_arrow_function_t);
        -:  635:  }
        -:  636:#endif /* JERRY_SNAPSHOT_EXEC */
        -:  637:
    #####:  638:  ecma_object_t *func_p = ecma_create_object (prototype_obj_p, arrow_function_object_size, ECMA_OBJECT_TYPE_FUNCTION);
        -:  639:
    #####:  640:  ecma_arrow_function_t *arrow_func_p = (ecma_arrow_function_t *) func_p;
        -:  641:
    #####:  642:  ECMA_SET_NON_NULL_POINTER_TAG (arrow_func_p->header.u.function.scope_cp, scope_p, 0);
        -:  643:
        -:  644:#if JERRY_SNAPSHOT_EXEC
    #####:  645:  if ((bytecode_data_p->status_flags & CBC_CODE_FLAGS_STATIC_FUNCTION))
        -:  646:  {
    #####:  647:    arrow_func_p->header.u.function.bytecode_cp = ECMA_NULL_POINTER;
    #####:  648:    ((ecma_static_arrow_function_t *) func_p)->bytecode_p = bytecode_data_p;
        -:  649:  }
        -:  650:  else
        -:  651:  {
        -:  652:#endif /* JERRY_SNAPSHOT_EXEC */
    #####:  653:    ECMA_SET_INTERNAL_VALUE_POINTER (arrow_func_p->header.u.function.bytecode_cp, bytecode_data_p);
    #####:  654:    ecma_bytecode_ref ((ecma_compiled_code_t *) bytecode_data_p);
        -:  655:#if JERRY_SNAPSHOT_EXEC
        -:  656:  }
        -:  657:#endif /* JERRY_SNAPSHOT_EXEC */
        -:  658:
    #####:  659:  arrow_func_p->this_binding = ecma_copy_value_if_not_object (this_binding);
    #####:  660:  arrow_func_p->new_target = ECMA_VALUE_UNDEFINED;
        -:  661:
    #####:  662:  if (JERRY_CONTEXT (current_new_target_p) != NULL)
        -:  663:  {
    #####:  664:    arrow_func_p->new_target = ecma_make_object_value (JERRY_CONTEXT (current_new_target_p));
        -:  665:  }
    #####:  666:  return func_p;
        -:  667:} /* ecma_op_create_arrow_function_object */
        -:  668:
        -:  669:#endif /* JERRY_ESNEXT */
        -:  670:
        -:  671:/**
        -:  672: * External function object creation operation.
        -:  673: *
        -:  674: * Note:
        -:  675: *      external function object is implementation-defined object type
        -:  676: *      that represent functions implemented in native code, using Embedding API
        -:  677: *
        -:  678: * @return pointer to newly created external function object
        -:  679: */
        -:  680:ecma_object_t *
        5:  681:ecma_op_create_external_function_object (ecma_native_handler_t handler_cb) /**< pointer to external native handler */
        -:  682:{
        5:  683:  ecma_object_t *prototype_obj_p = ecma_builtin_get (ECMA_BUILTIN_ID_FUNCTION_PROTOTYPE);
        -:  684:
        5:  685:  ecma_object_t *function_obj_p =
        -:  686:    ecma_create_object (prototype_obj_p, sizeof (ecma_native_function_t), ECMA_OBJECT_TYPE_NATIVE_FUNCTION);
        -:  687:
        -:  688:  /*
        -:  689:   * [[Class]] property is not stored explicitly for objects of ECMA_OBJECT_TYPE_NATIVE_FUNCTION type.
        -:  690:   *
        -:  691:   * See also: ecma_object_get_class_name
        -:  692:   */
        -:  693:
        5:  694:  ecma_native_function_t *native_function_p = (ecma_native_function_t *) function_obj_p;
        -:  695:#if JERRY_BUILTIN_REALMS
        5:  696:  ECMA_SET_INTERNAL_VALUE_POINTER (native_function_p->realm_value, ecma_builtin_get_global ());
        -:  697:#endif /* JERRY_BUILTIN_REALMS */
        5:  698:  native_function_p->native_handler_cb = handler_cb;
        -:  699:
        5:  700:  return function_obj_p;
        -:  701:} /* ecma_op_create_external_function_object */
        -:  702:
        -:  703:#if JERRY_ESNEXT
        -:  704:
        -:  705:/**
        -:  706: * Create built-in native handler object.
        -:  707: *
        -:  708: * @return pointer to newly created native handler object
        -:  709: */
        -:  710:ecma_object_t *
    #####:  711:ecma_op_create_native_handler (ecma_native_handler_id_t id, /**< handler id */
        -:  712:                               size_t object_size) /**< created object size */
        -:  713:{
    #####:  714:  ecma_object_t *prototype_obj_p = ecma_builtin_get (ECMA_BUILTIN_ID_FUNCTION_PROTOTYPE);
        -:  715:
    #####:  716:  ecma_object_t *function_obj_p = ecma_create_object (prototype_obj_p, object_size, ECMA_OBJECT_TYPE_BUILT_IN_FUNCTION);
        -:  717:
    #####:  718:  ecma_extended_object_t *ext_func_obj_p = (ecma_extended_object_t *) function_obj_p;
    #####:  719:  ext_func_obj_p->u.built_in.id = ECMA_BUILTIN_ID_HANDLER;
    #####:  720:  ext_func_obj_p->u.built_in.routine_id = (uint8_t) id;
    #####:  721:  ext_func_obj_p->u.built_in.u2.routine_flags = ECMA_NATIVE_HANDLER_FLAGS_NONE;
        -:  722:
        -:  723:#if JERRY_BUILTIN_REALMS
    #####:  724:  ECMA_SET_INTERNAL_VALUE_POINTER (ext_func_obj_p->u.built_in.realm_value, ecma_builtin_get_global ());
        -:  725:#endif /* JERRY_BUILTIN_REALMS */
        -:  726:
    #####:  727:  return function_obj_p;
        -:  728:} /* ecma_op_create_native_handler */
        -:  729:
        -:  730:#endif /* JERRY_ESNEXT */
        -:  731:
        -:  732:/**
        -:  733: * Get compiled code of a function object.
        -:  734: *
        -:  735: * @return compiled code
        -:  736: */
        -:  737:extern inline const ecma_compiled_code_t *JERRY_ATTR_ALWAYS_INLINE
       19:  738:ecma_op_function_get_compiled_code (ecma_extended_object_t *function_p) /**< function pointer */
        -:  739:{
        -:  740:#if JERRY_SNAPSHOT_EXEC
    #####:  741:  if (JERRY_LIKELY (function_p->u.function.bytecode_cp != ECMA_NULL_POINTER))
        -:  742:  {
    #####:  743:    return ECMA_GET_INTERNAL_VALUE_POINTER (const ecma_compiled_code_t, function_p->u.function.bytecode_cp);
        -:  744:  }
        -:  745:
    #####:  746:  return ((ecma_static_function_t *) function_p)->bytecode_p;
        -:  747:#else /* !JERRY_SNAPSHOT_EXEC */
<<<<<<< HEAD
    23836:  748:  return ECMA_GET_INTERNAL_VALUE_POINTER (const ecma_compiled_code_t, function_p->u.function.bytecode_cp);
=======
    23840:  748:  return ECMA_GET_INTERNAL_VALUE_POINTER (const ecma_compiled_code_t, function_p->u.function.bytecode_cp);
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  749:#endif /* JERRY_SNAPSHOT_EXEC */
        -:  750:} /* ecma_op_function_get_compiled_code */
        -:  751:
        -:  752:#if JERRY_BUILTIN_REALMS
        -:  753:
        -:  754:/**
        -:  755: * Get realm from a byte code.
        -:  756: *
        -:  757: * Note:
        -:  758: *   Does not increase the reference counter.
        -:  759: *
        -:  760: * @return pointer to realm (global) object
        -:  761: */
        -:  762:extern inline ecma_global_object_t *JERRY_ATTR_ALWAYS_INLINE
        1:  763:ecma_op_function_get_realm (const ecma_compiled_code_t *bytecode_header_p) /**< byte code header */
        -:  764:{
        -:  765:#if JERRY_SNAPSHOT_EXEC
    #####:  766:  if (JERRY_UNLIKELY (bytecode_header_p->status_flags & CBC_CODE_FLAGS_STATIC_FUNCTION))
        -:  767:  {
    #####:  768:    return (ecma_global_object_t *) ecma_builtin_get_global ();
        -:  769:  }
        -:  770:#endif /* JERRY_SNAPSHOT_EXEC */
        -:  771:
<<<<<<< HEAD
    11910:  772:  ecma_value_t script_value = ((cbc_uint8_arguments_t *) bytecode_header_p)->script_value;
    11910:  773:  cbc_script_t *script_p = ECMA_GET_INTERNAL_VALUE_POINTER (cbc_script_t, script_value);
        -:  774:
    11910:  775:  return (ecma_global_object_t *) script_p->realm_p;
=======
    11912:  772:  ecma_value_t script_value = ((cbc_uint8_arguments_t *) bytecode_header_p)->script_value;
    11912:  773:  cbc_script_t *script_p = ECMA_GET_INTERNAL_VALUE_POINTER (cbc_script_t, script_value);
        -:  774:
    11912:  775:  return (ecma_global_object_t *) script_p->realm_p;
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  776:} /* ecma_op_function_get_realm */
        -:  777:
        -:  778:/**
        -:  779: * Get realm from a function
        -:  780: *
        -:  781: * Note:
        -:  782: *   Does not increase the reference counter.
        -:  783: *
        -:  784: * @return realm (global) object
        -:  785: */
        -:  786:ecma_global_object_t *
    #####:  787:ecma_op_function_get_function_realm (ecma_object_t *func_obj_p) /**< function object */
        -:  788:{
        -:  789:  while (true)
    #####:  790:  {
    #####:  791:    ecma_object_type_t type = ecma_get_object_type (func_obj_p);
        -:  792:
    #####:  793:    if (type == ECMA_OBJECT_TYPE_FUNCTION)
        -:  794:    {
    #####:  795:      ecma_extended_object_t *ext_function_obj_p = (ecma_extended_object_t *) func_obj_p;
    #####:  796:      const ecma_compiled_code_t *bytecode_data_p = ecma_op_function_get_compiled_code (ext_function_obj_p);
    #####:  797:      return ecma_op_function_get_realm (bytecode_data_p);
        -:  798:    }
        -:  799:
    #####:  800:    if (type == ECMA_OBJECT_TYPE_BUILT_IN_FUNCTION)
        -:  801:    {
    #####:  802:      ecma_extended_object_t *ext_function_obj_p = (ecma_extended_object_t *) func_obj_p;
    #####:  803:      return ECMA_GET_INTERNAL_VALUE_POINTER (ecma_global_object_t, ext_function_obj_p->u.built_in.realm_value);
        -:  804:    }
        -:  805:
    #####:  806:    if (type == ECMA_OBJECT_TYPE_NATIVE_FUNCTION)
        -:  807:    {
    #####:  808:      ecma_native_function_t *native_function_p = (ecma_native_function_t *) func_obj_p;
    #####:  809:      return ECMA_GET_INTERNAL_VALUE_POINTER (ecma_global_object_t, native_function_p->realm_value);
        -:  810:    }
        -:  811:
        -:  812:#if JERRY_ESNEXT
    #####:  813:    if (type == ECMA_OBJECT_TYPE_CONSTRUCTOR_FUNCTION)
        -:  814:    {
    #####:  815:      ecma_value_t script_value = ((ecma_extended_object_t *) func_obj_p)->u.constructor_function.script_value;
    #####:  816:      cbc_script_t *script_p = ECMA_GET_INTERNAL_VALUE_POINTER (cbc_script_t, script_value);
        -:  817:
    #####:  818:      return (ecma_global_object_t *) script_p->realm_p;
        -:  819:    }
        -:  820:#endif /* JERRY_ESNEXT */
        -:  821:
        -:  822:#if JERRY_BUILTIN_PROXY
    #####:  823:    if (ECMA_OBJECT_IS_PROXY (func_obj_p))
        -:  824:    {
    #####:  825:      ecma_proxy_object_t *proxy_obj_p = (ecma_proxy_object_t *) func_obj_p;
    #####:  826:      if (ecma_is_value_null (proxy_obj_p->handler))
        -:  827:      {
    #####:  828:        ecma_raise_type_error (ECMA_ERR_PROTOTYPE_FROM_REVOKED_PROXY_IS_INVALID);
    #####:  829:        return NULL;
        -:  830:      }
    #####:  831:      func_obj_p = ecma_get_object_from_value (proxy_obj_p->target);
    #####:  832:      continue;
        -:  833:    }
        -:  834:#endif /* JERRY_BUILTIN_PROXY */
        -:  835:
    #####:  836:    JERRY_ASSERT (type == ECMA_OBJECT_TYPE_BOUND_FUNCTION);
    #####:  837:    ecma_bound_function_t *bound_func_p = (ecma_bound_function_t *) func_obj_p;
    #####:  838:    func_obj_p =
    #####:  839:      ECMA_GET_NON_NULL_POINTER_FROM_POINTER_TAG (ecma_object_t, bound_func_p->header.u.bound_function.target_function);
        -:  840:  }
        -:  841:} /* ecma_op_function_get_function_realm */
        -:  842:
        -:  843:#endif /* JERRY_BUILTIN_REALMS */
        -:  844:
        -:  845:/**
        -:  846: * 15.3.5.3 implementation of [[HasInstance]] for Function objects
        -:  847: *
        -:  848: * @return true/false - if arguments are valid
        -:  849: *         error - otherwise
        -:  850: *         Returned value must be freed with ecma_free_value
        -:  851: */
        -:  852:ecma_value_t
    #####:  853:ecma_op_function_has_instance (ecma_object_t *func_obj_p, /**< Function object */
        -:  854:                               ecma_value_t value) /**< argument 'V' */
        -:  855:{
    #####:  856:  JERRY_ASSERT (func_obj_p != NULL && !ecma_is_lexical_environment (func_obj_p));
        -:  857:
    #####:  858:  if (!ecma_is_value_object (value))
        -:  859:  {
    #####:  860:    return ECMA_VALUE_FALSE;
        -:  861:  }
        -:  862:
    #####:  863:  while (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_BOUND_FUNCTION)
        -:  864:  {
    #####:  865:    JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_BOUND_FUNCTION);
        -:  866:
        -:  867:    /* 1. 3. */
    #####:  868:    ecma_bound_function_t *bound_func_p = (ecma_bound_function_t *) func_obj_p;
        -:  869:
    #####:  870:    func_obj_p =
    #####:  871:      ECMA_GET_NON_NULL_POINTER_FROM_POINTER_TAG (ecma_object_t, bound_func_p->header.u.bound_function.target_function);
        -:  872:  }
        -:  873:
    #####:  874:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_FUNCTION
        -:  875:                || ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_BUILT_IN_FUNCTION
        -:  876:                || ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_CONSTRUCTOR_FUNCTION
        -:  877:                || ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_NATIVE_FUNCTION
        -:  878:                || ECMA_OBJECT_IS_PROXY (func_obj_p));
        -:  879:
    #####:  880:  ecma_object_t *v_obj_p = ecma_get_object_from_value (value);
        -:  881:
    #####:  882:  ecma_value_t prototype_obj_value = ecma_op_object_get_by_magic_id (func_obj_p, LIT_MAGIC_STRING_PROTOTYPE);
        -:  883:
    #####:  884:  if (ECMA_IS_VALUE_ERROR (prototype_obj_value))
        -:  885:  {
    #####:  886:    return prototype_obj_value;
        -:  887:  }
        -:  888:
    #####:  889:  if (!ecma_is_value_object (prototype_obj_value))
        -:  890:  {
    #####:  891:    ecma_free_value (prototype_obj_value);
    #####:  892:    return ecma_raise_type_error (ECMA_ERR_OBJECT_EXPECTED);
        -:  893:  }
        -:  894:
    #####:  895:  ecma_object_t *prototype_obj_p = ecma_get_object_from_value (prototype_obj_value);
    #####:  896:  JERRY_ASSERT (prototype_obj_p != NULL);
        -:  897:
        -:  898:#if JERRY_BUILTIN_PROXY
    #####:  899:  ecma_value_t result = ECMA_VALUE_ERROR;
        -:  900:#else /* !JERRY_BUILTIN_PROXY */
    #####:  901:  ecma_value_t result = ECMA_VALUE_FALSE;
        -:  902:#endif /* JERRY_BUILTIN_PROXY */
        -:  903:
    #####:  904:  ecma_ref_object (v_obj_p);
        -:  905:
        -:  906:  while (true)
    #####:  907:  {
    #####:  908:    ecma_object_t *current_proto_p = ecma_op_object_get_prototype_of (v_obj_p);
    #####:  909:    ecma_deref_object (v_obj_p);
        -:  910:
    #####:  911:    if (current_proto_p == NULL)
        -:  912:    {
        -:  913:#if JERRY_BUILTIN_PROXY
    #####:  914:      result = ECMA_VALUE_FALSE;
        -:  915:#endif /* JERRY_BUILTIN_PROXY */
    #####:  916:      break;
        -:  917:    }
    #####:  918:    else if (current_proto_p == ECMA_OBJECT_POINTER_ERROR)
        -:  919:    {
    #####:  920:      break;
        -:  921:    }
        -:  922:
    #####:  923:    if (current_proto_p == prototype_obj_p)
        -:  924:    {
    #####:  925:      ecma_deref_object (current_proto_p);
    #####:  926:      result = ECMA_VALUE_TRUE;
    #####:  927:      break;
        -:  928:    }
        -:  929:
        -:  930:    /* Advance up on prototype chain. */
    #####:  931:    v_obj_p = current_proto_p;
        -:  932:  }
        -:  933:
    #####:  934:  ecma_deref_object (prototype_obj_p);
    #####:  935:  return result;
        -:  936:} /* ecma_op_function_has_instance */
        -:  937:
        -:  938:#if JERRY_ESNEXT
        -:  939:
        -:  940:/**
        -:  941: * GetSuperConstructor operation for class methods
        -:  942: *
        -:  943: * See also: ECMAScript v6, 12.3.5.2
        -:  944: *
        -:  945: * @return ECMA_VALUE_ERROR - if the operation fails
        -:  946: *         super constructor - otherwise
        -:  947: */
        -:  948:ecma_value_t
    #####:  949:ecma_op_function_get_super_constructor (ecma_object_t *func_obj_p) /**< function object */
        -:  950:{
    #####:  951:  ecma_object_t *super_ctor_p = ecma_op_object_get_prototype_of (func_obj_p);
        -:  952:
    #####:  953:  if (JERRY_UNLIKELY (super_ctor_p == ECMA_OBJECT_POINTER_ERROR))
        -:  954:  {
    #####:  955:    return ECMA_VALUE_ERROR;
        -:  956:  }
    #####:  957:  else if (super_ctor_p == NULL || !ecma_object_is_constructor (super_ctor_p))
        -:  958:  {
    #####:  959:    if (super_ctor_p != NULL)
        -:  960:    {
    #####:  961:      ecma_deref_object (super_ctor_p);
        -:  962:    }
    #####:  963:    return ecma_raise_type_error (ECMA_ERR_SUPER_BINDING_MUST_BE_A_CONSTRUCTOR);
        -:  964:  }
        -:  965:
    #####:  966:  return ecma_make_object_value (super_ctor_p);
        -:  967:} /* ecma_op_function_get_super_constructor */
        -:  968:#endif /* JERRY_ESNEXT */
        -:  969:
        -:  970:/**
        -:  971: * Ordinary internal method: GetPrototypeFromConstructor (constructor, intrinsicDefaultProto)
        -:  972: *
        -:  973: * See also:
        -:  974: *   - ECMAScript v6, 9.1.15
        -:  975: *   - ECMAScript v10, 9.1.14
        -:  976: *
        -:  977: * @return NULL - if the operation fail (exception on the global context is raised)
        -:  978: *         pointer to the prototype object - otherwise
        -:  979: */
        -:  980:ecma_object_t *
<<<<<<< HEAD
    11907:  981:ecma_op_get_prototype_from_constructor (ecma_object_t *ctor_obj_p, /**< constructor to get prototype from  */
        -:  982:                                        ecma_builtin_id_t default_proto_id) /**< intrinsicDefaultProto */
        -:  983:{
    11907:  984:  JERRY_ASSERT (ecma_op_object_is_callable (ctor_obj_p));
    11907:  985:  JERRY_ASSERT (default_proto_id < ECMA_BUILTIN_ID__COUNT);
        -:  986:
    11907:  987:  ecma_value_t proto = ecma_op_object_get_by_magic_id (ctor_obj_p, LIT_MAGIC_STRING_PROTOTYPE);
        -:  988:
    11907:  989:  if (ECMA_IS_VALUE_ERROR (proto))
=======
    11909:  981:ecma_op_get_prototype_from_constructor (ecma_object_t *ctor_obj_p, /**< constructor to get prototype from  */
        -:  982:                                        ecma_builtin_id_t default_proto_id) /**< intrinsicDefaultProto */
        -:  983:{
    11909:  984:  JERRY_ASSERT (ecma_op_object_is_callable (ctor_obj_p));
    11909:  985:  JERRY_ASSERT (default_proto_id < ECMA_BUILTIN_ID__COUNT);
        -:  986:
    11909:  987:  ecma_value_t proto = ecma_op_object_get_by_magic_id (ctor_obj_p, LIT_MAGIC_STRING_PROTOTYPE);
        -:  988:
    11909:  989:  if (ECMA_IS_VALUE_ERROR (proto))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  990:  {
    #####:  991:    return NULL;
        -:  992:  }
        -:  993:
        -:  994:  ecma_object_t *proto_obj_p;
        -:  995:
<<<<<<< HEAD
    11907:  996:  if (!ecma_is_value_object (proto))
=======
    11909:  996:  if (!ecma_is_value_object (proto))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -:  997:  {
    #####:  998:    ecma_free_value (proto);
        -:  999:
        -: 1000:#if JERRY_BUILTIN_PROXY
    #####: 1001:    if (ECMA_OBJECT_IS_PROXY (ctor_obj_p))
        -: 1002:    {
    #####: 1003:      ecma_proxy_object_t *proxy_obj_p = (ecma_proxy_object_t *) ctor_obj_p;
    #####: 1004:      if (ecma_is_value_null (proxy_obj_p->handler))
        -: 1005:      {
    #####: 1006:        ecma_raise_type_error (ECMA_ERR_PROTOTYPE_FROM_REVOKED_PROXY_IS_INVALID);
    #####: 1007:        return NULL;
        -: 1008:      }
        -: 1009:    }
        -: 1010:#endif /* JERRY_BUILTIN_PROXY */
        -: 1011:
        -: 1012:#if JERRY_BUILTIN_REALMS
    #####: 1013:    proto_obj_p = ecma_builtin_get_from_realm (ecma_op_function_get_function_realm (ctor_obj_p), default_proto_id);
        -: 1014:#else /* !JERRY_BUILTIN_REALMS */
    #####: 1015:    proto_obj_p = ecma_builtin_get (default_proto_id);
        -: 1016:#endif /* JERRY_BUILTIN_REALMS */
    #####: 1017:    ecma_ref_object (proto_obj_p);
        -: 1018:  }
        -: 1019:  else
        -: 1020:  {
<<<<<<< HEAD
    11907: 1021:    proto_obj_p = ecma_get_object_from_value (proto);
        -: 1022:  }
        -: 1023:
    11907: 1024:  return proto_obj_p;
=======
    11909: 1021:    proto_obj_p = ecma_get_object_from_value (proto);
        -: 1022:  }
        -: 1023:
    11909: 1024:  return proto_obj_p;
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1025:} /* ecma_op_get_prototype_from_constructor */
        -: 1026:
        -: 1027:#if JERRY_ESNEXT
        -: 1028:/**
        -: 1029: * Perform a JavaScript class function object method call.
        -: 1030: *
        -: 1031: * The input function object should be a JavaScript class constructor
        -: 1032: *
        -: 1033: * @return the result of the function call.
        -: 1034: */
        -: 1035:static ecma_value_t JERRY_ATTR_NOINLINE
    #####: 1036:ecma_op_function_call_constructor (vm_frame_ctx_shared_args_t *shared_args_p, /**< shared data */
        -: 1037:                                   ecma_object_t *scope_p, /**< lexical environment to use */
        -: 1038:                                   ecma_value_t this_binding) /**< value of 'ThisBinding' */
        -: 1039:{
    #####: 1040:  shared_args_p->header.status_flags |= VM_FRAME_CTX_SHARED_NON_ARROW_FUNC;
        -: 1041:
        -: 1042:  ecma_value_t ret_value;
        -: 1043:
    #####: 1044:  if (JERRY_CONTEXT (current_new_target_p) == NULL)
        -: 1045:  {
    #####: 1046:    ret_value = ecma_raise_type_error (ECMA_ERR_CLASS_CONSTRUCTOR_REQUIRES_NEW);
    #####: 1047:    goto exit;
        -: 1048:  }
        -: 1049:
    #####: 1050:  ecma_extended_object_t *ext_func_p = (ecma_extended_object_t *) shared_args_p->header.function_object_p;
    #####: 1051:  if (ECMA_GET_THIRD_BIT_FROM_POINTER_TAG (ext_func_p->u.function.scope_cp))
        -: 1052:  {
    #####: 1053:    this_binding = ECMA_VALUE_UNINITIALIZED;
        -: 1054:  }
        -: 1055:
    #####: 1056:  ecma_op_create_environment_record (scope_p, this_binding, shared_args_p->header.function_object_p);
        -: 1057:
        -: 1058:#if JERRY_BUILTIN_REALMS
    #####: 1059:  ecma_global_object_t *saved_global_object_p = JERRY_CONTEXT (global_object_p);
    #####: 1060:  JERRY_CONTEXT (global_object_p) = ecma_op_function_get_realm (shared_args_p->header.bytecode_header_p);
        -: 1061:#endif /* JERRY_BUILTIN_REALMS */
        -: 1062:
    #####: 1063:  ret_value = vm_run (&shared_args_p->header, this_binding, scope_p);
        -: 1064:
        -: 1065:#if JERRY_BUILTIN_REALMS
    #####: 1066:  JERRY_CONTEXT (global_object_p) = saved_global_object_p;
        -: 1067:#endif /* JERRY_BUILTIN_REALMS */
        -: 1068:
        -: 1069:  /* ECMAScript v6, 9.2.2.13 */
    #####: 1070:  if (JERRY_UNLIKELY (this_binding == ECMA_VALUE_UNINITIALIZED))
        -: 1071:  {
    #####: 1072:    if (!ECMA_IS_VALUE_ERROR (ret_value) && !ecma_is_value_object (ret_value))
        -: 1073:    {
    #####: 1074:      if (!ecma_is_value_undefined (ret_value))
        -: 1075:      {
    #####: 1076:        ecma_free_value (ret_value);
    #####: 1077:        ret_value = ecma_raise_type_error (ECMA_ERR_DERIVED_CTOR_RETURN_NOR_OBJECT_OR_UNDEFINED);
        -: 1078:      }
        -: 1079:      else
        -: 1080:      {
    #####: 1081:        ret_value = ecma_op_get_this_binding (scope_p);
        -: 1082:      }
        -: 1083:    }
        -: 1084:  }
        -: 1085:
    #####: 1086:exit:
    #####: 1087:  if (JERRY_UNLIKELY (shared_args_p->header.status_flags & VM_FRAME_CTX_SHARED_FREE_LOCAL_ENV))
        -: 1088:  {
    #####: 1089:    ecma_deref_object (scope_p);
        -: 1090:  }
        -: 1091:
    #####: 1092:  return ret_value;
        -: 1093:} /* ecma_op_function_call_constructor */
        -: 1094:
        -: 1095:#endif /* JERRY_ESNEXT */
        -: 1096:
        -: 1097:/**
        -: 1098: * Perform a JavaScript function object method call.
        -: 1099: *
        -: 1100: * The input function object should be a pure JavaScript method
        -: 1101: *
        -: 1102: * @return the result of the function call.
        -: 1103: */
        -: 1104:static ecma_value_t
<<<<<<< HEAD
    11908: 1105:ecma_op_function_call_simple (ecma_object_t *func_obj_p, /**< Function object */
=======
    11910: 1105:ecma_op_function_call_simple (ecma_object_t *func_obj_p, /**< Function object */
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1106:                              ecma_value_t this_binding, /**< 'this' argument's value */
        -: 1107:                              const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1108:                              uint32_t arguments_list_len) /**< length of arguments list */
        -: 1109:{
<<<<<<< HEAD
    11908: 1110:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_FUNCTION);
        -: 1111:
    11908: 1112:  vm_frame_ctx_shared_args_t shared_args;
    11908: 1113:  shared_args.header.status_flags = VM_FRAME_CTX_SHARED_HAS_ARG_LIST;
    11908: 1114:  shared_args.header.function_object_p = func_obj_p;
    11908: 1115:  shared_args.arg_list_p = arguments_list_p;
    11908: 1116:  shared_args.arg_list_len = arguments_list_len;
        -: 1117:
        -: 1118:  /* Entering Function Code (ECMA-262 v5, 10.4.3) */
    11908: 1119:  ecma_extended_object_t *ext_func_p = (ecma_extended_object_t *) func_obj_p;
        -: 1120:
    11908: 1121:  ecma_object_t *scope_p = ECMA_GET_NON_NULL_POINTER_FROM_POINTER_TAG (ecma_object_t, ext_func_p->u.function.scope_cp);
        -: 1122:
        -: 1123:  /* 8. */
    11908: 1124:  const ecma_compiled_code_t *bytecode_data_p = ecma_op_function_get_compiled_code (ext_func_p);
    11908: 1125:  uint16_t status_flags = bytecode_data_p->status_flags;
        -: 1126:
    11908: 1127:  shared_args.header.bytecode_header_p = bytecode_data_p;
        -: 1128:
        -: 1129:#if JERRY_BUILTIN_REALMS
    11908: 1130:  ecma_global_object_t *realm_p = ecma_op_function_get_realm (bytecode_data_p);
        -: 1131:#endif /* JERRY_BUILTIN_REALMS */
        -: 1132:
        -: 1133:  /* 5. */
    11908: 1134:  if (!(status_flags & CBC_CODE_FLAGS_LEXICAL_ENV_NOT_NEEDED))
=======
    11910: 1110:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_FUNCTION);
        -: 1111:
    11910: 1112:  vm_frame_ctx_shared_args_t shared_args;
    11910: 1113:  shared_args.header.status_flags = VM_FRAME_CTX_SHARED_HAS_ARG_LIST;
    11910: 1114:  shared_args.header.function_object_p = func_obj_p;
    11910: 1115:  shared_args.arg_list_p = arguments_list_p;
    11910: 1116:  shared_args.arg_list_len = arguments_list_len;
        -: 1117:
        -: 1118:  /* Entering Function Code (ECMA-262 v5, 10.4.3) */
    11910: 1119:  ecma_extended_object_t *ext_func_p = (ecma_extended_object_t *) func_obj_p;
        -: 1120:
    11910: 1121:  ecma_object_t *scope_p = ECMA_GET_NON_NULL_POINTER_FROM_POINTER_TAG (ecma_object_t, ext_func_p->u.function.scope_cp);
        -: 1122:
        -: 1123:  /* 8. */
    11910: 1124:  const ecma_compiled_code_t *bytecode_data_p = ecma_op_function_get_compiled_code (ext_func_p);
    11910: 1125:  uint16_t status_flags = bytecode_data_p->status_flags;
        -: 1126:
    11910: 1127:  shared_args.header.bytecode_header_p = bytecode_data_p;
        -: 1128:
        -: 1129:#if JERRY_BUILTIN_REALMS
    11910: 1130:  ecma_global_object_t *realm_p = ecma_op_function_get_realm (bytecode_data_p);
        -: 1131:#endif /* JERRY_BUILTIN_REALMS */
        -: 1132:
        -: 1133:  /* 5. */
    11910: 1134:  if (!(status_flags & CBC_CODE_FLAGS_LEXICAL_ENV_NOT_NEEDED))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1135:  {
    #####: 1136:    shared_args.header.status_flags |= VM_FRAME_CTX_SHARED_FREE_LOCAL_ENV;
    #####: 1137:    scope_p = ecma_create_decl_lex_env (scope_p);
        -: 1138:  }
        -: 1139:
        -: 1140:  /* 1. */
<<<<<<< HEAD
    11908: 1141:  switch (CBC_FUNCTION_GET_TYPE (status_flags))
=======
    11910: 1141:  switch (CBC_FUNCTION_GET_TYPE (status_flags))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1142:  {
        -: 1143:#if JERRY_ESNEXT
    #####: 1144:    case CBC_FUNCTION_CONSTRUCTOR:
        -: 1145:    {
    #####: 1146:      return ecma_op_function_call_constructor (&shared_args, scope_p, this_binding);
        -: 1147:    }
    #####: 1148:    case CBC_FUNCTION_ARROW:
        -: 1149:    {
    #####: 1150:      ecma_arrow_function_t *arrow_func_p = (ecma_arrow_function_t *) func_obj_p;
        -: 1151:
    #####: 1152:      if (ecma_is_value_undefined (arrow_func_p->new_target))
        -: 1153:      {
    #####: 1154:        JERRY_CONTEXT (current_new_target_p) = NULL;
        -: 1155:      }
        -: 1156:      else
        -: 1157:      {
    #####: 1158:        JERRY_CONTEXT (current_new_target_p) = ecma_get_object_from_value (arrow_func_p->new_target);
        -: 1159:      }
        -: 1160:
    #####: 1161:      this_binding = arrow_func_p->this_binding;
        -: 1162:
    #####: 1163:      if (JERRY_UNLIKELY (this_binding == ECMA_VALUE_UNINITIALIZED))
        -: 1164:      {
    #####: 1165:        ecma_environment_record_t *env_record_p = ecma_op_get_environment_record (scope_p);
    #####: 1166:        JERRY_ASSERT (env_record_p);
    #####: 1167:        this_binding = env_record_p->this_binding;
        -: 1168:      }
    #####: 1169:      break;
        -: 1170:    }
        -: 1171:
        -: 1172:#endif /* JERRY_ESNEXT */
<<<<<<< HEAD
    11908: 1173:    default:
        -: 1174:    {
        -: 1175:#if JERRY_ESNEXT
    11908: 1176:      shared_args.header.status_flags |= VM_FRAME_CTX_SHARED_NON_ARROW_FUNC;
        -: 1177:#endif /* JERRY_ESNEXT */
        -: 1178:
    11908: 1179:      if (status_flags & CBC_CODE_FLAGS_STRICT_MODE)
=======
    11910: 1173:    default:
        -: 1174:    {
        -: 1175:#if JERRY_ESNEXT
    11910: 1176:      shared_args.header.status_flags |= VM_FRAME_CTX_SHARED_NON_ARROW_FUNC;
        -: 1177:#endif /* JERRY_ESNEXT */
        -: 1178:
    11910: 1179:      if (status_flags & CBC_CODE_FLAGS_STRICT_MODE)
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1180:      {
    #####: 1181:        break;
        -: 1182:      }
        -: 1183:
<<<<<<< HEAD
    11908: 1184:      if (ecma_is_value_undefined (this_binding) || ecma_is_value_null (this_binding))
=======
    11910: 1184:      if (ecma_is_value_undefined (this_binding) || ecma_is_value_null (this_binding))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1185:      {
        -: 1186:        /* 2. */
        -: 1187:#if JERRY_BUILTIN_REALMS
        1: 1188:        this_binding = realm_p->this_binding;
        -: 1189:#else /* !JERRY_BUILTIN_REALMS */
    #####: 1190:        this_binding = ecma_make_object_value (ecma_builtin_get_global ());
        -: 1191:#endif /* JERRY_BUILTIN_REALMS */
        -: 1192:      }
<<<<<<< HEAD
    11907: 1193:      else if (!ecma_is_value_object (this_binding))
=======
    11909: 1193:      else if (!ecma_is_value_object (this_binding))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1194:      {
        -: 1195:        /* 3., 4. */
    #####: 1196:        this_binding = ecma_op_to_object (this_binding);
    #####: 1197:        shared_args.header.status_flags |= VM_FRAME_CTX_SHARED_FREE_THIS;
        -: 1198:
    #####: 1199:        JERRY_ASSERT (!ECMA_IS_VALUE_ERROR (this_binding));
        -: 1200:      }
<<<<<<< HEAD
    11908: 1201:      break;
=======
    11910: 1201:      break;
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1202:    }
        -: 1203:  }
        -: 1204:
        -: 1205:#if JERRY_BUILTIN_REALMS
<<<<<<< HEAD
    11908: 1206:  ecma_global_object_t *saved_global_object_p = JERRY_CONTEXT (global_object_p);
    11908: 1207:  JERRY_CONTEXT (global_object_p) = realm_p;
        -: 1208:#endif /* JERRY_BUILTIN_REALMS */
        -: 1209:
    11908: 1210:  ecma_value_t ret_value = vm_run (&shared_args.header, this_binding, scope_p);
=======
    11910: 1206:  ecma_global_object_t *saved_global_object_p = JERRY_CONTEXT (global_object_p);
    11910: 1207:  JERRY_CONTEXT (global_object_p) = realm_p;
        -: 1208:#endif /* JERRY_BUILTIN_REALMS */
        -: 1209:
    11910: 1210:  ecma_value_t ret_value = vm_run (&shared_args.header, this_binding, scope_p);
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1211:
        -: 1212:#if JERRY_BUILTIN_REALMS
    #####: 1213:  JERRY_CONTEXT (global_object_p) = saved_global_object_p;
        -: 1214:#endif /* JERRY_BUILTIN_REALMS */
        -: 1215:
    #####: 1216:  if (JERRY_UNLIKELY (shared_args.header.status_flags & VM_FRAME_CTX_SHARED_FREE_LOCAL_ENV))
        -: 1217:  {
    #####: 1218:    ecma_deref_object (scope_p);
        -: 1219:  }
        -: 1220:
    #####: 1221:  if (JERRY_UNLIKELY (shared_args.header.status_flags & VM_FRAME_CTX_SHARED_FREE_THIS))
        -: 1222:  {
    #####: 1223:    ecma_free_value (this_binding);
        -: 1224:  }
        -: 1225:
    #####: 1226:  return ret_value;
        -: 1227:} /* ecma_op_function_call_simple */
        -: 1228:
        -: 1229:/**
        -: 1230: * Perform a built-in method call.
        -: 1231: *
        -: 1232: * @return the result of the function call.
        -: 1233: */
        -: 1234:static ecma_value_t JERRY_ATTR_NOINLINE
    #####: 1235:ecma_op_function_call_native_built_in (ecma_object_t *func_obj_p, /**< Function object */
        -: 1236:                                       ecma_value_t this_arg_value, /**< 'this' argument's value */
        -: 1237:                                       const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1238:                                       uint32_t arguments_list_len) /**< length of arguments list */
        -: 1239:{
    #####: 1240:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_BUILT_IN_FUNCTION);
        -: 1241:
        -: 1242:#if JERRY_BUILTIN_REALMS
    #####: 1243:  ecma_global_object_t *saved_global_object_p = JERRY_CONTEXT (global_object_p);
        -: 1244:
    #####: 1245:  ecma_extended_object_t *ext_func_obj_p = (ecma_extended_object_t *) func_obj_p;
    #####: 1246:  JERRY_CONTEXT (global_object_p) =
    #####: 1247:    ECMA_GET_INTERNAL_VALUE_POINTER (ecma_global_object_t, ext_func_obj_p->u.built_in.realm_value);
        -: 1248:#endif /* JERRY_BUILTIN_REALMS */
        -: 1249:
    #####: 1250:  ecma_value_t ret_value =
        -: 1251:    ecma_builtin_dispatch_call (func_obj_p, this_arg_value, arguments_list_p, arguments_list_len);
        -: 1252:
        -: 1253:#if JERRY_BUILTIN_REALMS
    #####: 1254:  JERRY_CONTEXT (global_object_p) = saved_global_object_p;
        -: 1255:#endif /* JERRY_BUILTIN_REALMS */
    #####: 1256:  return ret_value;
        -: 1257:} /* ecma_op_function_call_native_built_in */
        -: 1258:
        -: 1259:/**
        -: 1260: * Perform a native C method call which was registered via the API.
        -: 1261: *
        -: 1262: * @return the result of the function call.
        -: 1263: */
        -: 1264:static ecma_value_t JERRY_ATTR_NOINLINE
    #####: 1265:ecma_op_function_call_native (ecma_object_t *func_obj_p, /**< Function object */
        -: 1266:                              ecma_value_t this_arg_value, /**< 'this' argument's value */
        -: 1267:                              const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1268:                              uint32_t arguments_list_len) /**< length of arguments list */
        -: 1269:{
    #####: 1270:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_NATIVE_FUNCTION);
        -: 1271:
    #####: 1272:  ecma_native_function_t *native_function_p = (ecma_native_function_t *) func_obj_p;
        -: 1273:
        -: 1274:#if JERRY_BUILTIN_REALMS
    #####: 1275:  ecma_global_object_t *saved_global_object_p = JERRY_CONTEXT (global_object_p);
    #####: 1276:  JERRY_CONTEXT (global_object_p) =
    #####: 1277:    ECMA_GET_INTERNAL_VALUE_POINTER (ecma_global_object_t, native_function_p->realm_value);
        -: 1278:#endif /* JERRY_BUILTIN_REALMS */
        -: 1279:
    #####: 1280:  jerry_call_info_t call_info;
    #####: 1281:  call_info.function = ecma_make_object_value (func_obj_p);
    #####: 1282:  call_info.this_value = this_arg_value;
        -: 1283:
        -: 1284:#if JERRY_ESNEXT
    #####: 1285:  ecma_object_t *new_target_p = JERRY_CONTEXT (current_new_target_p);
    #####: 1286:  call_info.new_target = (new_target_p == NULL) ? ECMA_VALUE_UNDEFINED : ecma_make_object_value (new_target_p);
        -: 1287:#else /* JERRY_ESNEXT */
    #####: 1288:  call_info.new_target = ECMA_VALUE_UNDEFINED;
        -: 1289:#endif /* JERRY_ESNEXT */
        -: 1290:
    #####: 1291:  JERRY_ASSERT (native_function_p->native_handler_cb != NULL);
    #####: 1292:  ecma_value_t ret_value = native_function_p->native_handler_cb (&call_info, arguments_list_p, arguments_list_len);
        -: 1293:#if JERRY_BUILTIN_REALMS
    #####: 1294:  JERRY_CONTEXT (global_object_p) = saved_global_object_p;
        -: 1295:#endif /* JERRY_BUILTIN_REALMS */
        -: 1296:
    #####: 1297:  if (JERRY_UNLIKELY (ecma_is_value_exception (ret_value)))
        -: 1298:  {
    #####: 1299:    ecma_throw_exception (ret_value);
    #####: 1300:    return ECMA_VALUE_ERROR;
        -: 1301:  }
        -: 1302:
        -: 1303:#if JERRY_DEBUGGER
        -: 1304:  JERRY_DEBUGGER_CLEAR_FLAGS (JERRY_DEBUGGER_VM_EXCEPTION_THROWN);
        -: 1305:#endif /* JERRY_DEBUGGER */
    #####: 1306:  return ret_value;
        -: 1307:} /* ecma_op_function_call_native */
        -: 1308:
        -: 1309:/**
        -: 1310: * Append the bound arguments into the given collection
        -: 1311: *
        -: 1312: * Note:
        -: 1313: *       - The whole bound chain is resolved
        -: 1314: *       - The first element of the collection contains the bounded this value
        -: 1315: *
        -: 1316: * @return target function of the bound function
        -: 1317: */
        -: 1318:JERRY_ATTR_NOINLINE static ecma_object_t *
    #####: 1319:ecma_op_bound_function_get_argument_list (ecma_object_t *func_obj_p, /**< bound bunction object */
        -: 1320:                                          ecma_collection_t *list_p) /**< list of arguments */
        -: 1321:{
    #####: 1322:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_BOUND_FUNCTION);
        -: 1323:
    #####: 1324:  ecma_bound_function_t *bound_func_p = (ecma_bound_function_t *) func_obj_p;
        -: 1325:
    #####: 1326:  func_obj_p =
    #####: 1327:    ECMA_GET_NON_NULL_POINTER_FROM_POINTER_TAG (ecma_object_t, bound_func_p->header.u.bound_function.target_function);
        -: 1328:
    #####: 1329:  ecma_value_t args_len_or_this = bound_func_p->header.u.bound_function.args_len_or_this;
        -: 1330:
    #####: 1331:  uint32_t args_length = 1;
        -: 1332:
    #####: 1333:  if (ecma_is_value_integer_number (args_len_or_this))
        -: 1334:  {
    #####: 1335:    args_length = (uint32_t) ecma_get_integer_from_value (args_len_or_this);
        -: 1336:  }
        -: 1337:
        -: 1338:  /* 5. */
    #####: 1339:  if (args_length != 1)
        -: 1340:  {
    #####: 1341:    const ecma_value_t *args_p = (const ecma_value_t *) (bound_func_p + 1);
    #####: 1342:    list_p->buffer_p[0] = *args_p;
        -: 1343:
    #####: 1344:    if (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_BOUND_FUNCTION)
        -: 1345:    {
    #####: 1346:      func_obj_p = ecma_op_bound_function_get_argument_list (func_obj_p, list_p);
        -: 1347:    }
    #####: 1348:    ecma_collection_append (list_p, args_p + 1, args_length - 1);
        -: 1349:  }
        -: 1350:  else
        -: 1351:  {
    #####: 1352:    list_p->buffer_p[0] = args_len_or_this;
        -: 1353:  }
        -: 1354:
    #####: 1355:  return func_obj_p;
        -: 1356:} /* ecma_op_bound_function_get_argument_list */
        -: 1357:
        -: 1358:/**
        -: 1359: * [[Call]] internal method for bound function objects
        -: 1360: *
        -: 1361: * @return ecma value
        -: 1362: *         Returned value must be freed with ecma_free_value
        -: 1363: */
        -: 1364:static ecma_value_t JERRY_ATTR_NOINLINE
    #####: 1365:ecma_op_function_call_bound (ecma_object_t *func_obj_p, /**< Function object */
        -: 1366:                             const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1367:                             uint32_t arguments_list_len) /**< length of arguments list */
        -: 1368:{
    #####: 1369:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_BOUND_FUNCTION);
        -: 1370:
    #####: 1371:  JERRY_CONTEXT (status_flags) &= (uint32_t) ~ECMA_STATUS_DIRECT_EVAL;
        -: 1372:
    #####: 1373:  ecma_collection_t *bound_arg_list_p = ecma_new_collection ();
    #####: 1374:  ecma_collection_push_back (bound_arg_list_p, ECMA_VALUE_EMPTY);
        -: 1375:
    #####: 1376:  ecma_object_t *target_obj_p = ecma_op_bound_function_get_argument_list (func_obj_p, bound_arg_list_p);
        -: 1377:
    #####: 1378:  ecma_collection_append (bound_arg_list_p, arguments_list_p, arguments_list_len);
        -: 1379:
    #####: 1380:  JERRY_ASSERT (!ecma_is_value_empty (bound_arg_list_p->buffer_p[0]));
        -: 1381:
    #####: 1382:  ecma_value_t ret_value = ecma_op_function_call (target_obj_p,
    #####: 1383:                                                  bound_arg_list_p->buffer_p[0],
    #####: 1384:                                                  bound_arg_list_p->buffer_p + 1,
    #####: 1385:                                                  (uint32_t) (bound_arg_list_p->item_count - 1));
        -: 1386:
    #####: 1387:  ecma_collection_destroy (bound_arg_list_p);
        -: 1388:
    #####: 1389:  return ret_value;
        -: 1390:} /* ecma_op_function_call_bound */
        -: 1391:
        -: 1392:/**
        -: 1393: * General [[Call]] implementation
        -: 1394: *
        -: 1395: * @return ecma value
        -: 1396: *         Returned value must be freed with ecma_free_value
        -: 1397: */
        -: 1398:extern inline ecma_value_t JERRY_ATTR_ALWAYS_INLINE
        1: 1399:ecma_op_function_validated_call (ecma_value_t callee, /**< callee */
        -: 1400:                                 ecma_value_t this_arg_value, /**< 'this' argument's value */
        -: 1401:                                 const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1402:                                 uint32_t arguments_list_len) /**< length of arguments list */
        -: 1403:{
        1: 1404:  if (!ecma_is_value_object (callee))
        -: 1405:  {
    #####: 1406:    return ecma_raise_type_error (ECMA_ERR_EXPECTED_A_FUNCTION);
        -: 1407:  }
        -: 1408:
        1: 1409:  return ecma_op_function_call (ecma_get_object_from_value (callee),
        -: 1410:                                this_arg_value,
        -: 1411:                                arguments_list_p,
        -: 1412:                                arguments_list_len);
        -: 1413:} /* ecma_op_function_validated_call */
        -: 1414:
        -: 1415:/**
        -: 1416: * General [[Call]] implementation
        -: 1417: *
        -: 1418: * @return ecma value
        -: 1419: *         Returned value must be freed with ecma_free_value
        -: 1420: */
        -: 1421:ecma_value_t
        1: 1422:ecma_op_function_call (ecma_object_t *func_obj_p, /**< Function object */
        -: 1423:                       ecma_value_t this_arg_value, /**< 'this' argument's value */
        -: 1424:                       const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1425:                       uint32_t arguments_list_len) /**< length of arguments list */
        -: 1426:{
        1: 1427:  JERRY_ASSERT (func_obj_p != NULL && !ecma_is_lexical_environment (func_obj_p));
        -: 1428:
        1: 1429:  ECMA_CHECK_STACK_USAGE ();
        -: 1430:
        -: 1431:#if JERRY_ESNEXT
        1: 1432:  ecma_object_t *old_new_target_p = JERRY_CONTEXT (current_new_target_p);
        -: 1433:
        1: 1434:  if (JERRY_UNLIKELY (!(JERRY_CONTEXT (status_flags) & ECMA_STATUS_DIRECT_EVAL)))
        -: 1435:  {
        1: 1436:    JERRY_CONTEXT (current_new_target_p) = NULL;
        -: 1437:  }
        -: 1438:#endif /* JERRY_ESNEXT */
        -: 1439:
        -: 1440:  ecma_value_t result;
        -: 1441:
        1: 1442:  switch (ecma_get_object_type (func_obj_p))
        -: 1443:  {
        1: 1444:    case ECMA_OBJECT_TYPE_FUNCTION:
        -: 1445:    {
        1: 1446:      result = ecma_op_function_call_simple (func_obj_p, this_arg_value, arguments_list_p, arguments_list_len);
    #####: 1447:      break;
        -: 1448:    }
    #####: 1449:    case ECMA_OBJECT_TYPE_BUILT_IN_FUNCTION:
        -: 1450:    {
    #####: 1451:      result = ecma_op_function_call_native_built_in (func_obj_p, this_arg_value, arguments_list_p, arguments_list_len);
    #####: 1452:      break;
        -: 1453:    }
        -: 1454:#if JERRY_BUILTIN_PROXY
    #####: 1455:    case ECMA_OBJECT_TYPE_PROXY:
        -: 1456:    {
    #####: 1457:      result = ecma_proxy_object_call (func_obj_p, this_arg_value, arguments_list_p, arguments_list_len);
    #####: 1458:      break;
        -: 1459:    }
        -: 1460:#endif /* JERRY_BUILTIN_PROXY */
        -: 1461:#if JERRY_ESNEXT
    #####: 1462:    case ECMA_OBJECT_TYPE_CONSTRUCTOR_FUNCTION:
        -: 1463:    {
    #####: 1464:      result = ecma_raise_type_error (ECMA_ERR_CLASS_CONSTRUCTOR_NEW);
    #####: 1465:      break;
        -: 1466:    }
        -: 1467:#endif /* JERRY_ESNEXT */
    #####: 1468:    case ECMA_OBJECT_TYPE_NATIVE_FUNCTION:
        -: 1469:    {
    #####: 1470:      result = ecma_op_function_call_native (func_obj_p, this_arg_value, arguments_list_p, arguments_list_len);
    #####: 1471:      break;
        -: 1472:    }
    #####: 1473:    case ECMA_OBJECT_TYPE_BOUND_FUNCTION:
        -: 1474:    {
    #####: 1475:      result = ecma_op_function_call_bound (func_obj_p, arguments_list_p, arguments_list_len);
    #####: 1476:      break;
        -: 1477:    }
    #####: 1478:    default:
        -: 1479:    {
    #####: 1480:      result = ecma_raise_type_error (ECMA_ERR_EXPECTED_A_FUNCTION);
    #####: 1481:      break;
        -: 1482:    }
        -: 1483:  }
        -: 1484:
        -: 1485:#if JERRY_ESNEXT
    #####: 1486:  JERRY_CONTEXT (current_new_target_p) = old_new_target_p;
        -: 1487:#endif /* JERRY_ESNEXT */
        -: 1488:
    #####: 1489:  return result;
        -: 1490:} /* ecma_op_function_call */
        -: 1491:
        -: 1492:/**
        -: 1493: * [[Construct]] internal method for ECMAScript function objects
        -: 1494: *
        -: 1495: * @return ecma value
        -: 1496: *         Returned value must be freed with ecma_free_value
        -: 1497: */
        -: 1498:static ecma_value_t
<<<<<<< HEAD
    11907: 1499:ecma_op_function_construct_simple (ecma_object_t *func_obj_p, /**< Function object */
=======
    11909: 1499:ecma_op_function_construct_simple (ecma_object_t *func_obj_p, /**< Function object */
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1500:                                   ecma_object_t *new_target_p, /**< new target */
        -: 1501:                                   const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1502:                                   uint32_t arguments_list_len) /**< length of arguments list */
        -: 1503:{
<<<<<<< HEAD
    11907: 1504:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_FUNCTION);
        -: 1505:
    11907: 1506:  ecma_object_t *new_this_obj_p = NULL;
        -: 1507:  ecma_value_t this_arg;
        -: 1508:
        -: 1509:#if JERRY_ESNEXT
    11907: 1510:  ecma_extended_object_t *ext_func_obj_p = (ecma_extended_object_t *) func_obj_p;
        -: 1511:
        -: 1512:  /* 5. */
    11907: 1513:  if (!ECMA_GET_THIRD_BIT_FROM_POINTER_TAG (ext_func_obj_p->u.function.scope_cp))
        -: 1514:  {
        -: 1515:#endif /* JERRY_ESNEXT */
        -: 1516:    /* 5.a */
    11907: 1517:    ecma_object_t *proto_p = ecma_op_get_prototype_from_constructor (new_target_p, ECMA_BUILTIN_ID_OBJECT_PROTOTYPE);
        -: 1518:
        -: 1519:    /* 5.b */
    11907: 1520:    if (JERRY_UNLIKELY (proto_p == NULL))
=======
    11909: 1504:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_FUNCTION);
        -: 1505:
    11909: 1506:  ecma_object_t *new_this_obj_p = NULL;
        -: 1507:  ecma_value_t this_arg;
        -: 1508:
        -: 1509:#if JERRY_ESNEXT
    11909: 1510:  ecma_extended_object_t *ext_func_obj_p = (ecma_extended_object_t *) func_obj_p;
        -: 1511:
        -: 1512:  /* 5. */
    11909: 1513:  if (!ECMA_GET_THIRD_BIT_FROM_POINTER_TAG (ext_func_obj_p->u.function.scope_cp))
        -: 1514:  {
        -: 1515:#endif /* JERRY_ESNEXT */
        -: 1516:    /* 5.a */
    11909: 1517:    ecma_object_t *proto_p = ecma_op_get_prototype_from_constructor (new_target_p, ECMA_BUILTIN_ID_OBJECT_PROTOTYPE);
        -: 1518:
        -: 1519:    /* 5.b */
    11909: 1520:    if (JERRY_UNLIKELY (proto_p == NULL))
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1521:    {
    #####: 1522:      return ECMA_VALUE_ERROR;
        -: 1523:    }
        -: 1524:
<<<<<<< HEAD
    11907: 1525:    new_this_obj_p = ecma_create_object (proto_p, 0, ECMA_OBJECT_TYPE_GENERAL);
    11907: 1526:    ecma_deref_object (proto_p);
    11907: 1527:    this_arg = ecma_make_object_value (new_this_obj_p);
=======
    11909: 1525:    new_this_obj_p = ecma_create_object (proto_p, 0, ECMA_OBJECT_TYPE_GENERAL);
    11909: 1526:    ecma_deref_object (proto_p);
    11909: 1527:    this_arg = ecma_make_object_value (new_this_obj_p);
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1528:#if JERRY_ESNEXT
        -: 1529:  }
        -: 1530:  else
        -: 1531:  {
    #####: 1532:    this_arg = ECMA_VALUE_UNDEFINED;
        -: 1533:  }
        -: 1534:
        -: 1535:  /* 6. */
<<<<<<< HEAD
    11907: 1536:  ecma_object_t *old_new_target_p = JERRY_CONTEXT (current_new_target_p);
    11907: 1537:  JERRY_CONTEXT (current_new_target_p) = new_target_p;
        -: 1538:#endif /* JERRY_ESNEXT */
        -: 1539:
    11907: 1540:  ecma_value_t ret_value = ecma_op_function_call_simple (func_obj_p, this_arg, arguments_list_p, arguments_list_len);
=======
    11909: 1536:  ecma_object_t *old_new_target_p = JERRY_CONTEXT (current_new_target_p);
    11909: 1537:  JERRY_CONTEXT (current_new_target_p) = new_target_p;
        -: 1538:#endif /* JERRY_ESNEXT */
        -: 1539:
    11909: 1540:  ecma_value_t ret_value = ecma_op_function_call_simple (func_obj_p, this_arg, arguments_list_p, arguments_list_len);
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1541:
        -: 1542:#if JERRY_ESNEXT
    #####: 1543:  JERRY_CONTEXT (current_new_target_p) = old_new_target_p;
        -: 1544:#endif /* JERRY_ESNEXT */
        -: 1545:
        -: 1546:  /* 13.a */
    #####: 1547:  if (ECMA_IS_VALUE_ERROR (ret_value) || ecma_is_value_object (ret_value))
        -: 1548:  {
        -: 1549:#if JERRY_ESNEXT
    #####: 1550:    if (new_this_obj_p != NULL)
        -: 1551:    {
    #####: 1552:      ecma_deref_object (new_this_obj_p);
        -: 1553:    }
        -: 1554:#else /* !JERRY_ESNEXT */
    #####: 1555:    ecma_deref_object (new_this_obj_p);
        -: 1556:#endif /* JERRY_ESNEXT */
    #####: 1557:    return ret_value;
        -: 1558:  }
        -: 1559:
        -: 1560:  /* 13.b */
    #####: 1561:  ecma_free_value (ret_value);
    #####: 1562:  return this_arg;
        -: 1563:} /* ecma_op_function_construct_simple */
        -: 1564:
        -: 1565:/**
        -: 1566: * [[Construct]] internal method for built-in function objects
        -: 1567: *
        -: 1568: * @return ecma value
        -: 1569: *         Returned value must be freed with ecma_free_value
        -: 1570: */
        -: 1571:static ecma_value_t
    #####: 1572:ecma_op_function_construct_built_in (ecma_object_t *func_obj_p, /**< Function object */
        -: 1573:                                     ecma_object_t *new_target_p, /**< new target */
        -: 1574:                                     const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1575:                                     uint32_t arguments_list_len) /**< length of arguments list */
        -: 1576:{
        -: 1577:  JERRY_UNUSED (new_target_p);
        -: 1578:
    #####: 1579:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_BUILT_IN_FUNCTION);
        -: 1580:
        -: 1581:#if JERRY_BUILTIN_REALMS
    #####: 1582:  ecma_global_object_t *saved_global_object_p = JERRY_CONTEXT (global_object_p);
    #####: 1583:  ecma_value_t realm_value = ((ecma_extended_object_t *) func_obj_p)->u.built_in.realm_value;
    #####: 1584:  JERRY_CONTEXT (global_object_p) = ECMA_GET_INTERNAL_VALUE_POINTER (ecma_global_object_t, realm_value);
        -: 1585:#endif /* JERRY_BUILTIN_REALMS */
        -: 1586:
        -: 1587:#if JERRY_ESNEXT
    #####: 1588:  ecma_object_t *old_new_target = JERRY_CONTEXT (current_new_target_p);
    #####: 1589:  JERRY_CONTEXT (current_new_target_p) = new_target_p;
        -: 1590:#endif /* JERRY_ESNEXT */
        -: 1591:
    #####: 1592:  ecma_value_t ret_value = ecma_builtin_dispatch_construct (func_obj_p, arguments_list_p, arguments_list_len);
        -: 1593:
        -: 1594:#if JERRY_ESNEXT
    #####: 1595:  JERRY_CONTEXT (current_new_target_p) = old_new_target;
        -: 1596:#endif /* JERRY_ESNEXT */
        -: 1597:
        -: 1598:#if JERRY_BUILTIN_REALMS
    #####: 1599:  JERRY_CONTEXT (global_object_p) = saved_global_object_p;
        -: 1600:#endif /* JERRY_BUILTIN_REALMS */
    #####: 1601:  return ret_value;
        -: 1602:} /* ecma_op_function_construct_built_in */
        -: 1603:
        -: 1604:/**
        -: 1605: * [[Construct]] internal method for bound function objects
        -: 1606: *
        -: 1607: * @return ecma value
        -: 1608: *         Returned value must be freed with ecma_free_value
        -: 1609: */
        -: 1610:static ecma_value_t JERRY_ATTR_NOINLINE
    #####: 1611:ecma_op_function_construct_bound (ecma_object_t *func_obj_p, /**< Function object */
        -: 1612:                                  ecma_object_t *new_target_p, /**< new target */
        -: 1613:                                  const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1614:                                  uint32_t arguments_list_len) /**< length of arguments list */
        -: 1615:{
    #####: 1616:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_BOUND_FUNCTION);
        -: 1617:
    #####: 1618:  ecma_collection_t *bound_arg_list_p = ecma_new_collection ();
    #####: 1619:  ecma_collection_push_back (bound_arg_list_p, ECMA_VALUE_EMPTY);
        -: 1620:
    #####: 1621:  ecma_object_t *target_obj_p = ecma_op_bound_function_get_argument_list (func_obj_p, bound_arg_list_p);
        -: 1622:
    #####: 1623:  ecma_collection_append (bound_arg_list_p, arguments_list_p, arguments_list_len);
        -: 1624:
    #####: 1625:  if (func_obj_p == new_target_p)
        -: 1626:  {
    #####: 1627:    new_target_p = target_obj_p;
        -: 1628:  }
        -: 1629:
    #####: 1630:  ecma_value_t ret_value = ecma_op_function_construct (target_obj_p,
        -: 1631:                                                       new_target_p,
    #####: 1632:                                                       bound_arg_list_p->buffer_p + 1,
    #####: 1633:                                                       (uint32_t) (bound_arg_list_p->item_count - 1));
        -: 1634:
    #####: 1635:  ecma_collection_destroy (bound_arg_list_p);
        -: 1636:
    #####: 1637:  return ret_value;
        -: 1638:} /* ecma_op_function_construct_bound */
        -: 1639:
        -: 1640:#if JERRY_ESNEXT
        -: 1641:
        -: 1642:/**
        -: 1643: * [[Construct]] internal method for class implicit constructor objects
        -: 1644: *
        -: 1645: * @return ecma value
        -: 1646: *         Returned value must be freed with ecma_free_value
        -: 1647: */
        -: 1648:static ecma_value_t
    #####: 1649:ecma_op_function_construct_constructor (ecma_object_t *func_obj_p, /**< Function object */
        -: 1650:                                        ecma_object_t *new_target_p, /**< new target */
        -: 1651:                                        const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1652:                                        uint32_t arguments_list_len) /**< length of arguments list */
        -: 1653:{
    #####: 1654:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_CONSTRUCTOR_FUNCTION);
        -: 1655:
    #####: 1656:  ecma_extended_object_t *constructor_object_p = (ecma_extended_object_t *) func_obj_p;
        -: 1657:
    #####: 1658:  if (!(constructor_object_p->u.constructor_function.flags & ECMA_CONSTRUCTOR_FUNCTION_HAS_HERITAGE))
        -: 1659:  {
    #####: 1660:    ecma_object_t *proto_p = ecma_op_get_prototype_from_constructor (new_target_p, ECMA_BUILTIN_ID_OBJECT_PROTOTYPE);
        -: 1661:
    #####: 1662:    if (JERRY_UNLIKELY (proto_p == NULL))
        -: 1663:    {
    #####: 1664:      return ECMA_VALUE_ERROR;
        -: 1665:    }
        -: 1666:
    #####: 1667:    ecma_object_t *new_this_object_p = ecma_create_object (proto_p, 0, ECMA_OBJECT_TYPE_GENERAL);
    #####: 1668:    ecma_deref_object (proto_p);
        -: 1669:
    #####: 1670:    jerry_value_t new_this_value = ecma_make_object_value (new_this_object_p);
    #####: 1671:    jerry_value_t ret_value = opfunc_init_class_fields (func_obj_p, new_this_value);
        -: 1672:
    #####: 1673:    if (ECMA_IS_VALUE_ERROR (ret_value))
        -: 1674:    {
    #####: 1675:      ecma_deref_object (new_this_object_p);
    #####: 1676:      return ret_value;
        -: 1677:    }
        -: 1678:
    #####: 1679:    return new_this_value;
        -: 1680:  }
        -: 1681:
    #####: 1682:  ecma_value_t super_ctor = ecma_op_function_get_super_constructor (func_obj_p);
        -: 1683:
    #####: 1684:  if (ECMA_IS_VALUE_ERROR (super_ctor))
        -: 1685:  {
    #####: 1686:    return super_ctor;
        -: 1687:  }
        -: 1688:
    #####: 1689:  ecma_object_t *super_ctor_p = ecma_get_object_from_value (super_ctor);
    #####: 1690:  ecma_value_t result = ecma_op_function_construct (super_ctor_p, new_target_p, arguments_list_p, arguments_list_len);
    #####: 1691:  ecma_deref_object (super_ctor_p);
        -: 1692:
    #####: 1693:  if (ecma_is_value_object (result))
        -: 1694:  {
    #####: 1695:    ecma_value_t fields_value = opfunc_init_class_fields (func_obj_p, result);
        -: 1696:
    #####: 1697:    if (ECMA_IS_VALUE_ERROR (fields_value))
        -: 1698:    {
    #####: 1699:      ecma_free_value (result);
    #####: 1700:      return fields_value;
        -: 1701:    }
        -: 1702:  }
        -: 1703:
    #####: 1704:  return result;
        -: 1705:} /* ecma_op_function_construct_constructor */
        -: 1706:
        -: 1707:#endif /* JERRY_ESNEXT */
        -: 1708:
        -: 1709:/**
        -: 1710: * [[Construct]] internal method for external function objects
        -: 1711: *
        -: 1712: * @return ecma value
        -: 1713: *         Returned value must be freed with ecma_free_value
        -: 1714: */
        -: 1715:static ecma_value_t
    #####: 1716:ecma_op_function_construct_native (ecma_object_t *func_obj_p, /**< Function object */
        -: 1717:                                   ecma_object_t *new_target_p, /**< new target */
        -: 1718:                                   const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1719:                                   uint32_t arguments_list_len) /**< length of arguments list */
        -: 1720:{
    #####: 1721:  JERRY_ASSERT (ecma_get_object_type (func_obj_p) == ECMA_OBJECT_TYPE_NATIVE_FUNCTION);
        -: 1722:
    #####: 1723:  ecma_object_t *proto_p = ecma_op_get_prototype_from_constructor (new_target_p, ECMA_BUILTIN_ID_OBJECT_PROTOTYPE);
        -: 1724:
    #####: 1725:  if (JERRY_UNLIKELY (proto_p == NULL))
        -: 1726:  {
    #####: 1727:    return ECMA_VALUE_ERROR;
        -: 1728:  }
        -: 1729:
    #####: 1730:  ecma_object_t *new_this_obj_p = ecma_create_object (proto_p, 0, ECMA_OBJECT_TYPE_GENERAL);
    #####: 1731:  ecma_value_t this_arg = ecma_make_object_value (new_this_obj_p);
    #####: 1732:  ecma_deref_object (proto_p);
        -: 1733:
        -: 1734:#if JERRY_ESNEXT
    #####: 1735:  ecma_object_t *old_new_target_p = JERRY_CONTEXT (current_new_target_p);
    #####: 1736:  JERRY_CONTEXT (current_new_target_p) = new_target_p;
        -: 1737:#endif /* JERRY_ESNEXT */
        -: 1738:
    #####: 1739:  ecma_value_t ret_value = ecma_op_function_call_native (func_obj_p, this_arg, arguments_list_p, arguments_list_len);
        -: 1740:
        -: 1741:#if JERRY_ESNEXT
    #####: 1742:  JERRY_CONTEXT (current_new_target_p) = old_new_target_p;
        -: 1743:#endif /* JERRY_ESNEXT */
        -: 1744:
    #####: 1745:  if (ECMA_IS_VALUE_ERROR (ret_value) || ecma_is_value_object (ret_value))
        -: 1746:  {
    #####: 1747:    ecma_deref_object (new_this_obj_p);
    #####: 1748:    return ret_value;
        -: 1749:  }
        -: 1750:
    #####: 1751:  ecma_free_value (ret_value);
        -: 1752:
    #####: 1753:  return this_arg;
        -: 1754:} /* ecma_op_function_construct_native */
        -: 1755:
        -: 1756:/**
        -: 1757: * General [[Construct]] implementation function objects
        -: 1758: *
        -: 1759: * See also: ECMAScript v6, 9.2.2
        -: 1760: *
        -: 1761: * @return ecma value
        -: 1762: *         Returned value must be freed with ecma_free_value
        -: 1763: */
        -: 1764:ecma_value_t
<<<<<<< HEAD
    11907: 1765:ecma_op_function_construct (ecma_object_t *func_obj_p, /**< Function object */
=======
    11909: 1765:ecma_op_function_construct (ecma_object_t *func_obj_p, /**< Function object */
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1766:                            ecma_object_t *new_target_p, /**< new target */
        -: 1767:                            const ecma_value_t *arguments_list_p, /**< arguments list */
        -: 1768:                            uint32_t arguments_list_len) /**< length of arguments list */
        -: 1769:{
<<<<<<< HEAD
    11907: 1770:  JERRY_ASSERT (func_obj_p != NULL && !ecma_is_lexical_environment (func_obj_p));
        -: 1771:
        -: 1772:
    11907: 1773:  switch (ecma_get_object_type (func_obj_p))
        -: 1774:  {
    11907: 1775:    case ECMA_OBJECT_TYPE_FUNCTION:
        -: 1776:    {
    11907: 1777:      return ecma_op_function_construct_simple (func_obj_p, new_target_p, arguments_list_p, arguments_list_len);
=======
    11909: 1770:  JERRY_ASSERT (func_obj_p != NULL && !ecma_is_lexical_environment (func_obj_p));
        -: 1771:
        -: 1772:
    11909: 1773:  switch (ecma_get_object_type (func_obj_p))
        -: 1774:  {
    11909: 1775:    case ECMA_OBJECT_TYPE_FUNCTION:
        -: 1776:    {
    11909: 1777:      return ecma_op_function_construct_simple (func_obj_p, new_target_p, arguments_list_p, arguments_list_len);
>>>>>>> a21cade7a7dbd62c58f835b59aec4a2edcb34875
        -: 1778:    }
    #####: 1779:    case ECMA_OBJECT_TYPE_BUILT_IN_FUNCTION:
        -: 1780:    {
    #####: 1781:      return ecma_op_function_construct_built_in (func_obj_p, new_target_p, arguments_list_p, arguments_list_len);
        -: 1782:    }
        -: 1783:#if JERRY_BUILTIN_PROXY
    #####: 1784:    case ECMA_OBJECT_TYPE_PROXY:
        -: 1785:    {
    #####: 1786:      return ecma_proxy_object_construct (func_obj_p, new_target_p, arguments_list_p, arguments_list_len);
        -: 1787:    }
        -: 1788:#endif /* JERRY_BUILTIN_PROXY */
        -: 1789:#if JERRY_ESNEXT
    #####: 1790:    case ECMA_OBJECT_TYPE_CONSTRUCTOR_FUNCTION:
        -: 1791:    {
    #####: 1792:      return ecma_op_function_construct_constructor (func_obj_p, new_target_p, arguments_list_p, arguments_list_len);
        -: 1793:    }
        -: 1794:#endif /* JERRY_ESNEXT */
    #####: 1795:    case ECMA_OBJECT_TYPE_BOUND_FUNCTION:
        -: 1796:    {
    #####: 1797:      return ecma_op_function_construct_bound (func_obj_p, new_target_p, arguments_list_p, arguments_list_len);
        -: 1798:    }
    #####: 1799:    case ECMA_OBJECT_TYPE_NATIVE_FUNCTION:
        -: 1800:    {
    #####: 1801:      return ecma_op_function_construct_native (func_obj_p, new_target_p, arguments_list_p, arguments_list_len);
        -: 1802:    }
    #####: 1803:    default:
        -: 1804:    {
    #####: 1805:      JERRY_UNREACHABLE ();
        -: 1806:    }
        -: 1807:  }
        -: 1808:
        -: 1809:  return ECMA_VALUE_UNDEFINED;
        -: 1810:} /* ecma_op_function_construct */
        -: 1811:
        -: 1812:/**
        -: 1813: * Lazy instantiation of 'prototype' property for non-builtin and external functions
        -: 1814: *
        -: 1815: * @return pointer to newly instantiated property
        -: 1816: */
        -: 1817:static ecma_property_t *
        1: 1818:ecma_op_lazy_instantiate_prototype_object (ecma_object_t *object_p) /**< the function object */
        -: 1819:{
        1: 1820:  JERRY_ASSERT (ecma_get_object_type (object_p) == ECMA_OBJECT_TYPE_FUNCTION
        -: 1821:                || ecma_get_object_type (object_p) == ECMA_OBJECT_TYPE_NATIVE_FUNCTION);
        -: 1822:
        -: 1823:#if JERRY_BUILTIN_REALMS
        -: 1824:  ecma_global_object_t *global_object_p;
        -: 1825:
        1: 1826:  if (ecma_get_object_type (object_p) == ECMA_OBJECT_TYPE_FUNCTION)
        -: 1827:  {
        -: 1828:    const ecma_compiled_code_t *bytecode_data_p;
        1: 1829:    bytecode_data_p = ecma_op_function_get_compiled_code ((ecma_extended_object_t *) object_p);
        -: 1830:
        1: 1831:    global_object_p = ecma_op_function_get_realm (bytecode_data_p);
        -: 1832:  }
        -: 1833:  else
        -: 1834:  {
    #####: 1835:    ecma_native_function_t *native_function_p = (ecma_native_function_t *) object_p;
        -: 1836:
    #####: 1837:    global_object_p = ECMA_GET_INTERNAL_VALUE_POINTER (ecma_global_object_t, native_function_p->realm_value);
        -: 1838:  }
        -: 1839:#endif /* JERRY_BUILTIN_REALMS */
        -: 1840:
        -: 1841:  /* ECMA-262 v5, 13.2, 16-18 */
        -: 1842:
        1: 1843:  ecma_object_t *proto_object_p = NULL;
        1: 1844:  bool init_constructor = true;
        -: 1845:
        -: 1846:#if JERRY_ESNEXT
        1: 1847:  if (ecma_get_object_type (object_p) == ECMA_OBJECT_TYPE_FUNCTION)
        -: 1848:  {
        1: 1849:    const ecma_compiled_code_t *byte_code_p = ecma_op_function_get_compiled_code ((ecma_extended_object_t *) object_p);
        -: 1850:
        1: 1851:    if (!CBC_FUNCTION_HAS_PROTOTYPE (byte_code_p->status_flags))
        -: 1852:    {
    #####: 1853:      return NULL;
        -: 1854:    }
        -: 1855:
        1: 1856:    if (CBC_FUNCTION_GET_TYPE (byte_code_p->status_flags) == CBC_FUNCTION_GENERATOR)
        -: 1857:    {
        -: 1858:      ecma_object_t *prototype_p;
        -: 1859:
        -: 1860:#if JERRY_BUILTIN_REALMS
    #####: 1861:      prototype_p = ecma_builtin_get_from_realm (global_object_p, ECMA_BUILTIN_ID_GENERATOR_PROTOTYPE);
        -: 1862:#else /* !JERRY_BUILTIN_REALMS */
        -: 1863:      prototype_p = ecma_builtin_get (ECMA_BUILTIN_ID_GENERATOR_PROTOTYPE);
        -: 1864:#endif /* JERRY_BUILTIN_REALMS */
        -: 1865:
    #####: 1866:      proto_object_p = ecma_create_object (prototype_p, 0, ECMA_OBJECT_TYPE_GENERAL);
    #####: 1867:      init_constructor = false;
        -: 1868:    }
        -: 1869:
        1: 1870:    if (CBC_FUNCTION_GET_TYPE (byte_code_p->status_flags) == CBC_FUNCTION_ASYNC_GENERATOR)
        -: 1871:    {
        -: 1872:      ecma_object_t *prototype_p;
        -: 1873:
        -: 1874:#if JERRY_BUILTIN_REALMS
    #####: 1875:      prototype_p = ecma_builtin_get_from_realm (global_object_p, ECMA_BUILTIN_ID_ASYNC_GENERATOR_PROTOTYPE);
        -: 1876:#else /* !JERRY_BUILTIN_REALMS */
        -: 1877:      prototype_p = ecma_builtin_get (ECMA_BUILTIN_ID_ASYNC_GENERATOR_PROTOTYPE);
        -: 1878:#endif /* JERRY_BUILTIN_REALMS */
        -: 1879:
    #####: 1880:      proto_object_p = ecma_create_object (prototype_p, 0, ECMA_OBJECT_TYPE_GENERAL);
    #####: 1881:      init_constructor = false;
        -: 1882:    }
        -: 1883:  }
        -: 1884:#endif /* JERRY_ESNEXT */
        -: 1885:
        -: 1886:#if JERRY_ESNEXT
        1: 1887:  if (proto_object_p == NULL)
        -: 1888:#endif /* JERRY_ESNEXT */
        -: 1889:  {
        -: 1890:    ecma_object_t *prototype_p;
        -: 1891:
        -: 1892:#if JERRY_BUILTIN_REALMS
        1: 1893:    prototype_p = ecma_builtin_get_from_realm (global_object_p, ECMA_BUILTIN_ID_OBJECT_PROTOTYPE);
        -: 1894:#else /* !JERRY_BUILTIN_REALMS */
    #####: 1895:    prototype_p = ecma_builtin_get (ECMA_BUILTIN_ID_OBJECT_PROTOTYPE);
        -: 1896:#endif /* JERRY_BUILTIN_REALMS */
        -: 1897:
        1: 1898:    proto_object_p = ecma_op_create_object_object_noarg_and_set_prototype (prototype_p);
        -: 1899:  }
        -: 1900:
        -: 1901:  /* 17. */
        1: 1902:  if (init_constructor)
        -: 1903:  {
        -: 1904:    ecma_property_value_t *constructor_prop_value_p;
        1: 1905:    constructor_prop_value_p = ecma_create_named_data_property (proto_object_p,
        -: 1906:                                                                ecma_get_magic_string (LIT_MAGIC_STRING_CONSTRUCTOR),
        -: 1907:                                                                ECMA_PROPERTY_CONFIGURABLE_WRITABLE,
        -: 1908:                                                                NULL);
        -: 1909:
        1: 1910:    constructor_prop_value_p->value = ecma_make_object_value (object_p);
        -: 1911:  }
        -: 1912:
        -: 1913:  /* 18. */
        1: 1914:  ecma_property_t *prototype_prop_p;
        -: 1915:  ecma_property_value_t *prototype_prop_value_p;
        1: 1916:  prototype_prop_value_p = ecma_create_named_data_property (object_p,
        -: 1917:                                                            ecma_get_magic_string (LIT_MAGIC_STRING_PROTOTYPE),
        -: 1918:                                                            ECMA_PROPERTY_BUILT_IN_WRITABLE,
        -: 1919:                                                            &prototype_prop_p);
        -: 1920:
        1: 1921:  prototype_prop_value_p->value = ecma_make_object_value (proto_object_p);
        -: 1922:
        1: 1923:  ecma_deref_object (proto_object_p);
        -: 1924:
        1: 1925:  return prototype_prop_p;
        -: 1926:} /* ecma_op_lazy_instantiate_prototype_object */
        -: 1927:
        -: 1928:/**
        -: 1929: * Lazy instantiation of non-builtin ecma function object's properties
        -: 1930: *
        -: 1931: * Warning:
        -: 1932: *         Only non-configurable properties could be instantiated lazily in this function,
        -: 1933: *         as configurable properties could be deleted and it would be incorrect
        -: 1934: *         to reinstantiate them in the function in second time.
        -: 1935: *
        -: 1936: * @return pointer to newly instantiated property, if a property was instantiated,
        -: 1937: *         NULL - otherwise
        -: 1938: */
        -: 1939:ecma_property_t *
        1: 1940:ecma_op_function_try_to_lazy_instantiate_property (ecma_object_t *object_p, /**< the function object */
        -: 1941:                                                   ecma_string_t *property_name_p) /**< property name */
        -: 1942:{
        1: 1943:  JERRY_ASSERT (ecma_get_object_type (object_p) == ECMA_OBJECT_TYPE_FUNCTION);
        -: 1944:
        -: 1945:#if JERRY_ESNEXT
        1: 1946:  if (ecma_compare_ecma_string_to_magic_id (property_name_p, LIT_MAGIC_STRING_LENGTH))
        -: 1947:  {
    #####: 1948:    ecma_extended_object_t *ext_func_p = (ecma_extended_object_t *) object_p;
        -: 1949:
    #####: 1950:    if (ECMA_GET_FIRST_BIT_FROM_POINTER_TAG (ext_func_p->u.function.scope_cp))
        -: 1951:    {
    #####: 1952:      return NULL;
        -: 1953:    }
        -: 1954:
        -: 1955:    /* Initialize 'length' property */
    #####: 1956:    const ecma_compiled_code_t *bytecode_data_p = ecma_op_function_get_compiled_code (ext_func_p);
        -: 1957:    uint32_t len;
        -: 1958:
    #####: 1959:    if (bytecode_data_p->status_flags & CBC_CODE_FLAGS_UINT16_ARGUMENTS)
        -: 1960:    {
    #####: 1961:      cbc_uint16_arguments_t *args_p = (cbc_uint16_arguments_t *) bytecode_data_p;
    #####: 1962:      len = args_p->argument_end;
        -: 1963:    }
        -: 1964:    else
        -: 1965:    {
    #####: 1966:      cbc_uint8_arguments_t *args_p = (cbc_uint8_arguments_t *) bytecode_data_p;
    #####: 1967:      len = args_p->argument_end;
        -: 1968:    }
        -: 1969:
    #####: 1970:    if (bytecode_data_p->status_flags & CBC_CODE_FLAGS_HAS_EXTENDED_INFO)
        -: 1971:    {
    #####: 1972:      uint8_t *extended_info_p = ecma_compiled_code_resolve_extended_info (bytecode_data_p);
        -: 1973:
    #####: 1974:      if (*extended_info_p & CBC_EXTENDED_CODE_FLAGS_HAS_ARGUMENT_LENGTH)
        -: 1975:      {
    #####: 1976:        len = ecma_extended_info_decode_vlq (&extended_info_p);
        -: 1977:      }
        -: 1978:    }
        -: 1979:
    #####: 1980:    ecma_property_t *value_prop_p;
    #####: 1981:    ecma_property_value_t *value_p =
        -: 1982:      ecma_create_named_data_property (object_p, property_name_p, ECMA_PROPERTY_BUILT_IN_CONFIGURABLE, &value_prop_p);
    #####: 1983:    value_p->value = ecma_make_uint32_value (len);
    #####: 1984:    return value_prop_p;
        -: 1985:  }
        -: 1986:
        1: 1987:  if (ecma_compare_ecma_string_to_magic_id (property_name_p, LIT_MAGIC_STRING_NAME))
        -: 1988:  {
    #####: 1989:    ecma_extended_object_t *ext_func_p = (ecma_extended_object_t *) object_p;
        -: 1990:
    #####: 1991:    if (ECMA_GET_SECOND_BIT_FROM_POINTER_TAG (ext_func_p->u.function.scope_cp))
        -: 1992:    {
    #####: 1993:      return NULL;
        -: 1994:    }
        -: 1995:
    #####: 1996:    const ecma_compiled_code_t *bytecode_data_p = ecma_op_function_get_compiled_code (ext_func_p);
        -: 1997:
    #####: 1998:    if (CBC_FUNCTION_GET_TYPE (bytecode_data_p->status_flags) == CBC_FUNCTION_CONSTRUCTOR)
        -: 1999:    {
    #####: 2000:      return NULL;
        -: 2001:    }
        -: 2002:
    #####: 2003:    ecma_value_t value = *ecma_compiled_code_resolve_function_name (bytecode_data_p);
    #####: 2004:    JERRY_ASSERT (ecma_is_value_string (value));
        -: 2005:
        -: 2006:    /* Initialize 'name' property */
    #####: 2007:    ecma_property_t *value_prop_p;
    #####: 2008:    ecma_property_value_t *value_p =
        -: 2009:      ecma_create_named_data_property (object_p, property_name_p, ECMA_PROPERTY_BUILT_IN_CONFIGURABLE, &value_prop_p);
    #####: 2010:    value_p->value = ecma_copy_value (value);
    #####: 2011:    return value_prop_p;
        -: 2012:  }
        -: 2013:#endif /* JERRY_ESNEXT */
        -: 2014:
        1: 2015:  if (ecma_compare_ecma_string_to_magic_id (property_name_p, LIT_MAGIC_STRING_PROTOTYPE)
        1: 2016:      && ecma_get_object_type (object_p) == ECMA_OBJECT_TYPE_FUNCTION)
        -: 2017:  {
        1: 2018:    return ecma_op_lazy_instantiate_prototype_object (object_p);
        -: 2019:  }
        -: 2020:
    #####: 2021:  const bool is_arguments = ecma_compare_ecma_string_to_magic_id (property_name_p, LIT_MAGIC_STRING_ARGUMENTS);
        -: 2022:
    #####: 2023:  if (is_arguments || ecma_compare_ecma_string_to_magic_id (property_name_p, LIT_MAGIC_STRING_CALLER))
        -: 2024:  {
        -: 2025:    const ecma_compiled_code_t *bytecode_data_p;
    #####: 2026:    bytecode_data_p = ecma_op_function_get_compiled_code ((ecma_extended_object_t *) object_p);
        -: 2027:
        -: 2028:#if JERRY_ESNEXT
    #####: 2029:    if (!(bytecode_data_p->status_flags & CBC_CODE_FLAGS_STRICT_MODE)
    #####: 2030:        && CBC_FUNCTION_GET_TYPE (bytecode_data_p->status_flags) == CBC_FUNCTION_NORMAL)
        -: 2031:    {
    #####: 2032:      ecma_property_t *value_prop_p;
        -: 2033:      /* The property_name_p argument contains the name. */
    #####: 2034:      ecma_property_value_t *value_p =
        -: 2035:        ecma_create_named_data_property (object_p, property_name_p, ECMA_PROPERTY_BUILT_IN_FIXED, &value_prop_p);
    #####: 2036:      value_p->value = is_arguments ? ECMA_VALUE_NULL : ECMA_VALUE_UNDEFINED;
    #####: 2037:      return value_prop_p;
        -: 2038:    }
        -: 2039:#else /* !JERRY_ESNEXT */
    #####: 2040:    if (bytecode_data_p->status_flags & CBC_CODE_FLAGS_STRICT_MODE)
        -: 2041:    {
    #####: 2042:      ecma_object_t *thrower_p = ecma_builtin_get (ECMA_BUILTIN_ID_TYPE_ERROR_THROWER);
        -: 2043:
        -: 2044:      ecma_property_t *caller_prop_p;
        -: 2045:      /* The property_name_p argument contains the name. */
    #####: 2046:      ecma_create_named_accessor_property (object_p,
        -: 2047:                                           property_name_p,
        -: 2048:                                           thrower_p,
        -: 2049:                                           thrower_p,
        -: 2050:                                           ECMA_PROPERTY_BUILT_IN_FIXED,
        -: 2051:                                           &caller_prop_p);
    #####: 2052:      return caller_prop_p;
        -: 2053:    }
        -: 2054:#endif /* JERRY_ESNEXT */
        -: 2055:  }
        -: 2056:
    #####: 2057:  return NULL;
        -: 2058:} /* ecma_op_function_try_to_lazy_instantiate_property */
        -: 2059:
        -: 2060:/**
        -: 2061: * Create specification defined non-configurable properties for external functions.
        -: 2062: *
        -: 2063: * See also:
        -: 2064: *          ECMA-262 v5, 15.3.4.5
        -: 2065: *
        -: 2066: * @return pointer property, if one was instantiated,
        -: 2067: *         NULL - otherwise.
        -: 2068: */
        -: 2069:ecma_property_t *
    #####: 2070:ecma_op_external_function_try_to_lazy_instantiate_property (ecma_object_t *object_p, /**< object */
        -: 2071:                                                            ecma_string_t *property_name_p) /**< property's name */
        -: 2072:{
    #####: 2073:  JERRY_ASSERT (ecma_get_object_type (object_p) == ECMA_OBJECT_TYPE_NATIVE_FUNCTION);
        -: 2074:
    #####: 2075:  if (ecma_compare_ecma_string_to_magic_id (property_name_p, LIT_MAGIC_STRING_PROTOTYPE))
        -: 2076:  {
    #####: 2077:    return ecma_op_lazy_instantiate_prototype_object (object_p);
        -: 2078:  }
        -: 2079:
    #####: 2080:  return NULL;
        -: 2081:} /* ecma_op_external_function_try_to_lazy_instantiate_property */
        -: 2082:
        -: 2083:/**
        -: 2084: * Create specification defined non-configurable properties for bound functions.
        -: 2085: *
        -: 2086: * See also:
        -: 2087: *          ECMA-262 v5, 15.3.4.5
        -: 2088: *
        -: 2089: * @return pointer property, if one was instantiated,
        -: 2090: *         NULL - otherwise.
        -: 2091: */
        -: 2092:ecma_property_t *
    #####: 2093:ecma_op_bound_function_try_to_lazy_instantiate_property (ecma_object_t *object_p, /**< object */
        -: 2094:                                                         ecma_string_t *property_name_p) /**< property's name */
        -: 2095:{
    #####: 2096:  JERRY_ASSERT (ecma_get_object_type (object_p) == ECMA_OBJECT_TYPE_BOUND_FUNCTION);
        -: 2097:
    #####: 2098:  if (ecma_string_is_length (property_name_p))
        -: 2099:  {
    #####: 2100:    ecma_bound_function_t *bound_func_p = (ecma_bound_function_t *) object_p;
    #####: 2101:    ecma_value_t args_len_or_this = bound_func_p->header.u.bound_function.args_len_or_this;
    #####: 2102:    ecma_number_t length = 0;
    #####: 2103:    ecma_integer_value_t args_length = 1;
        -: 2104:    uint8_t length_attributes;
        -: 2105:
    #####: 2106:    if (ecma_is_value_integer_number (args_len_or_this))
        -: 2107:    {
    #####: 2108:      args_length = ecma_get_integer_from_value (args_len_or_this);
        -: 2109:    }
        -: 2110:
        -: 2111:#if JERRY_ESNEXT
    #####: 2112:    if (ECMA_GET_FIRST_BIT_FROM_POINTER_TAG (bound_func_p->header.u.bound_function.target_function))
        -: 2113:    {
    #####: 2114:      return NULL;
        -: 2115:    }
        -: 2116:
    #####: 2117:    length_attributes = ECMA_PROPERTY_BUILT_IN_CONFIGURABLE;
    #####: 2118:    length = ecma_get_number_from_value (bound_func_p->target_length) - (args_length - 1);
        -: 2119:#else /* !JERRY_ESNEXT */
    #####: 2120:    length_attributes = ECMA_PROPERTY_BUILT_IN_FIXED;
        -: 2121:
        -: 2122:    ecma_object_t *target_func_p;
    #####: 2123:    target_func_p =
    #####: 2124:      ECMA_GET_NON_NULL_POINTER_FROM_POINTER_TAG (ecma_object_t, bound_func_p->header.u.bound_function.target_function);
        -: 2125:
    #####: 2126:    if (ecma_object_get_class_name (target_func_p) == LIT_MAGIC_STRING_FUNCTION_UL)
        -: 2127:    {
        -: 2128:      /* The property_name_p argument contains the 'length' string. */
    #####: 2129:      ecma_value_t get_len_value = ecma_op_object_get (target_func_p, property_name_p);
        -: 2130:
        -: 2131:      JERRY_ASSERT (!ECMA_IS_VALUE_ERROR (get_len_value));
        -: 2132:      JERRY_ASSERT (ecma_is_value_integer_number (get_len_value));
        -: 2133:
    #####: 2134:      length = (ecma_number_t) (ecma_get_integer_from_value (get_len_value) - (args_length - 1));
        -: 2135:    }
        -: 2136:#endif /* JERRY_ESNEXT */
        -: 2137:
    #####: 2138:    if (length < 0)
        -: 2139:    {
    #####: 2140:      length = 0;
        -: 2141:    }
        -: 2142:
    #####: 2143:    ecma_property_t *len_prop_p;
    #####: 2144:    ecma_property_value_t *len_prop_value_p =
    #####: 2145:      ecma_create_named_data_property (object_p, property_name_p, length_attributes, &len_prop_p);
        -: 2146:
    #####: 2147:    len_prop_value_p->value = ecma_make_number_value (length);
    #####: 2148:    return len_prop_p;
        -: 2149:  }
        -: 2150:
        -: 2151:#if !JERRY_ESNEXT
    #####: 2152:  if (ecma_compare_ecma_string_to_magic_id (property_name_p, LIT_MAGIC_STRING_CALLER)
    #####: 2153:      || ecma_compare_ecma_string_to_magic_id (property_name_p, LIT_MAGIC_STRING_ARGUMENTS))
        -: 2154:  {
    #####: 2155:    ecma_object_t *thrower_p = ecma_builtin_get (ECMA_BUILTIN_ID_TYPE_ERROR_THROWER);
        -: 2156:
        -: 2157:    ecma_property_t *caller_prop_p;
        -: 2158:    /* The string_p argument contans the name. */
    #####: 2159:    ecma_create_named_accessor_property (object_p,
        -: 2160:                                         property_name_p,
        -: 2161:                                         thrower_p,
        -: 2162:                                         thrower_p,
        -: 2163:                                         ECMA_PROPERTY_BUILT_IN_FIXED,
        -: 2164:                                         &caller_prop_p);
    #####: 2165:    return caller_prop_p;
        -: 2166:  }
        -: 2167:#endif /* !JERRY_ESNEXT */
        -: 2168:
    #####: 2169:  return NULL;
        -: 2170:} /* ecma_op_bound_function_try_to_lazy_instantiate_property */
        -: 2171:
        -: 2172:#if JERRY_ESNEXT
        -: 2173:
        -: 2174:/**
        -: 2175: * Delete configurable properties of functions.
        -: 2176: */
        -: 2177:void
    #####: 2178:ecma_op_function_delete_built_in_property (ecma_object_t *object_p, /**< object */
        -: 2179:                                           ecma_string_t *property_name_p) /**< property name */
        -: 2180:{
    #####: 2181:  ecma_extended_object_t *ext_func_p = (ecma_extended_object_t *) object_p;
        -: 2182:
    #####: 2183:  if (ecma_compare_ecma_string_to_magic_id (property_name_p, LIT_MAGIC_STRING_LENGTH))
        -: 2184:  {
    #####: 2185:    JERRY_ASSERT (!ECMA_GET_FIRST_BIT_FROM_POINTER_TAG (ext_func_p->u.function.scope_cp));
    #####: 2186:    ECMA_SET_FIRST_BIT_TO_POINTER_TAG (ext_func_p->u.function.scope_cp);
    #####: 2187:    return;
        -: 2188:  }
        -: 2189:
    #####: 2190:  JERRY_ASSERT (ecma_compare_ecma_string_to_magic_id (property_name_p, LIT_MAGIC_STRING_NAME));
    #####: 2191:  JERRY_ASSERT (!ECMA_GET_SECOND_BIT_FROM_POINTER_TAG (ext_func_p->u.function.scope_cp));
        -: 2192:
    #####: 2193:  ECMA_SET_SECOND_BIT_TO_POINTER_TAG (ext_func_p->u.function.scope_cp);
        -: 2194:} /* ecma_op_function_delete_built_in_property */
        -: 2195:
        -: 2196:/**
        -: 2197: * Delete configurable properties of bound functions.
        -: 2198: */
        -: 2199:void
    #####: 2200:ecma_op_bound_function_delete_built_in_property (ecma_object_t *object_p, /**< object */
        -: 2201:                                                 ecma_string_t *property_name_p) /**< property name */
        -: 2202:{
        -: 2203:  JERRY_UNUSED (property_name_p);
        -: 2204:
    #####: 2205:  ecma_bound_function_t *bound_func_p = (ecma_bound_function_t *) object_p;
        -: 2206:
    #####: 2207:  JERRY_ASSERT (ecma_compare_ecma_string_to_magic_id (property_name_p, LIT_MAGIC_STRING_LENGTH));
    #####: 2208:  JERRY_ASSERT (!ECMA_GET_FIRST_BIT_FROM_POINTER_TAG (bound_func_p->header.u.bound_function.target_function));
        -: 2209:
    #####: 2210:  ECMA_SET_FIRST_BIT_TO_POINTER_TAG (bound_func_p->header.u.bound_function.target_function);
    #####: 2211:} /* ecma_op_bound_function_delete_built_in_property */
        -: 2212:
        -: 2213:#endif /* JERRY_ESNEXT */
        -: 2214:
        -: 2215:/**
        -: 2216: * List names of a Function object's lazy instantiated properties,
        -: 2217: * adding them to corresponding string collections
        -: 2218: *
        -: 2219: * See also:
        -: 2220: *          ecma_op_function_try_to_lazy_instantiate_property
        -: 2221: */
        -: 2222:void
    #####: 2223:ecma_op_function_list_lazy_property_names (ecma_object_t *object_p, /**< functionobject */
        -: 2224:                                           ecma_collection_t *prop_names_p, /**< prop name collection */
        -: 2225:                                           ecma_property_counter_t *prop_counter_p, /**< property counters */
        -: 2226:                                           jerry_property_filter_t filter) /**< property name filter options */
        -: 2227:{
    #####: 2228:  if (filter & JERRY_PROPERTY_FILTER_EXCLUDE_STRINGS)
        -: 2229:  {
    #####: 2230:    return;
        -: 2231:  }
        -: 2232:
        -: 2233:  const ecma_compiled_code_t *bytecode_data_p;
    #####: 2234:  bytecode_data_p = ecma_op_function_get_compiled_code ((ecma_extended_object_t *) object_p);
        -: 2235:
        -: 2236:#if JERRY_ESNEXT
    #####: 2237:  ecma_extended_object_t *ext_func_p = (ecma_extended_object_t *) object_p;
        -: 2238:
    #####: 2239:  if (!ECMA_GET_FIRST_BIT_FROM_POINTER_TAG (ext_func_p->u.function.scope_cp))
        -: 2240:  {
        -: 2241:    /* Unintialized 'length' property is non-enumerable (ECMA-262 v6, 19.2.4.1) */
    #####: 2242:    ecma_collection_push_back (prop_names_p, ecma_make_magic_string_value (LIT_MAGIC_STRING_LENGTH));
    #####: 2243:    prop_counter_p->string_named_props++;
        -: 2244:  }
        -: 2245:
    #####: 2246:  if (CBC_FUNCTION_GET_TYPE (bytecode_data_p->status_flags) != CBC_FUNCTION_CONSTRUCTOR
    #####: 2247:      && !ECMA_GET_SECOND_BIT_FROM_POINTER_TAG (ext_func_p->u.function.scope_cp))
        -: 2248:  {
        -: 2249:    /* Unintialized 'name' property is non-enumerable (ECMA-262 v6, 19.2.4.2) */
    #####: 2250:    ecma_collection_push_back (prop_names_p, ecma_make_magic_string_value (LIT_MAGIC_STRING_NAME));
    #####: 2251:    prop_counter_p->string_named_props++;
        -: 2252:  }
        -: 2253:#else /* !JERRY_ESNEXT */
        -: 2254:  /* 'length' property is non-enumerable (ECMA-262 v5, 13.2.5) */
    #####: 2255:  ecma_collection_push_back (prop_names_p, ecma_make_magic_string_value (LIT_MAGIC_STRING_LENGTH));
    #####: 2256:  prop_counter_p->string_named_props++;
        -: 2257:#endif /* JERRY_ESNEXT */
        -: 2258:
        -: 2259:#if JERRY_ESNEXT
    #####: 2260:  if (!CBC_FUNCTION_HAS_PROTOTYPE (bytecode_data_p->status_flags)
    #####: 2261:      || (CBC_FUNCTION_GET_TYPE (bytecode_data_p->status_flags) == CBC_FUNCTION_CONSTRUCTOR))
        -: 2262:  {
    #####: 2263:    return;
        -: 2264:  }
        -: 2265:
    #####: 2266:  bool append_caller_and_arguments = !(bytecode_data_p->status_flags & CBC_CODE_FLAGS_STRICT_MODE);
        -: 2267:#else /* !JERRY_ESNEXT */
    #####: 2268:  bool append_caller_and_arguments = (bytecode_data_p->status_flags & CBC_CODE_FLAGS_STRICT_MODE);
        -: 2269:#endif /* JERRY_ESNEXT */
        -: 2270:
    #####: 2271:  if (append_caller_and_arguments)
        -: 2272:  {
        -: 2273:    /* 'arguments' property is non-enumerable (ECMA-262 v5, 13.2.5) */
    #####: 2274:    ecma_collection_push_back (prop_names_p, ecma_make_magic_string_value (LIT_MAGIC_STRING_ARGUMENTS));
        -: 2275:
        -: 2276:    /* 'caller' property is non-enumerable (ECMA-262 v5, 13.2.5) */
    #####: 2277:    ecma_collection_push_back (prop_names_p, ecma_make_magic_string_value (LIT_MAGIC_STRING_CALLER));
        -: 2278:
    #####: 2279:    prop_counter_p->string_named_props += 2;
        -: 2280:  }
        -: 2281:
        -: 2282:  /* 'prototype' property is non-enumerable (ECMA-262 v5, 13.2.18) */
    #####: 2283:  ecma_collection_push_back (prop_names_p, ecma_make_magic_string_value (LIT_MAGIC_STRING_PROTOTYPE));
    #####: 2284:  prop_counter_p->string_named_props++;
        -: 2285:} /* ecma_op_function_list_lazy_property_names */
        -: 2286:
        -: 2287:/**
        -: 2288: * List names of an External Function object's lazy instantiated properties,
        -: 2289: * adding them to corresponding string collections
        -: 2290: *
        -: 2291: * See also:
        -: 2292: *          ecma_op_external_function_try_to_lazy_instantiate_property
        -: 2293: */
        -: 2294:void
    #####: 2295:ecma_op_external_function_list_lazy_property_names (ecma_object_t *object_p, /**< function object */
        -: 2296:                                                    ecma_collection_t *prop_names_p, /**< prop name collection */
        -: 2297:                                                    ecma_property_counter_t *prop_counter_p, /**< property counters */
        -: 2298:                                                    jerry_property_filter_t filter) /**< property name
        -: 2299:                                                                                     *   filter options */
        -: 2300:{
        -: 2301:  JERRY_UNUSED (object_p);
        -: 2302:
    #####: 2303:  if (filter & JERRY_PROPERTY_FILTER_EXCLUDE_STRINGS)
        -: 2304:  {
    #####: 2305:    return;
        -: 2306:  }
        -: 2307:
        -: 2308:  /* 'prototype' property is non-enumerable (ECMA-262 v5, 13.2.18) */
    #####: 2309:  ecma_collection_push_back (prop_names_p, ecma_make_magic_string_value (LIT_MAGIC_STRING_PROTOTYPE));
    #####: 2310:  prop_counter_p->string_named_props++;
        -: 2311:} /* ecma_op_external_function_list_lazy_property_names */
        -: 2312:
        -: 2313:/**
        -: 2314: * List names of a Bound Function object's lazy instantiated properties,
        -: 2315: * adding them to corresponding string collections
        -: 2316: *
        -: 2317: * See also:
        -: 2318: *          ecma_op_bound_function_try_to_lazy_instantiate_property
        -: 2319: */
        -: 2320:void
    #####: 2321:ecma_op_bound_function_list_lazy_property_names (ecma_object_t *object_p, /**< bound function object*/
        -: 2322:                                                 ecma_collection_t *prop_names_p, /**< prop name collection */
        -: 2323:                                                 ecma_property_counter_t *prop_counter_p, /**< property counters */
        -: 2324:                                                 jerry_property_filter_t filter) /**< property name filter options */
        -: 2325:{
    #####: 2326:  if (filter & JERRY_PROPERTY_FILTER_EXCLUDE_STRINGS)
        -: 2327:  {
    #####: 2328:    return;
        -: 2329:  }
        -: 2330:
        -: 2331:#if JERRY_ESNEXT
        -: 2332:  /* Unintialized 'length' property is non-enumerable (ECMA-262 v6, 19.2.4.1) */
    #####: 2333:  ecma_bound_function_t *bound_func_p = (ecma_bound_function_t *) object_p;
    #####: 2334:  if (!ECMA_GET_FIRST_BIT_FROM_POINTER_TAG (bound_func_p->header.u.bound_function.target_function))
        -: 2335:  {
    #####: 2336:    ecma_collection_push_back (prop_names_p, ecma_make_magic_string_value (LIT_MAGIC_STRING_LENGTH));
    #####: 2337:    prop_counter_p->string_named_props++;
        -: 2338:  }
        -: 2339:#else /* !JERRY_ESNEXT */
        -: 2340:  JERRY_UNUSED (object_p);
        -: 2341:  /* 'length' property is non-enumerable (ECMA-262 v5, 13.2.5) */
    #####: 2342:  ecma_collection_push_back (prop_names_p, ecma_make_magic_string_value (LIT_MAGIC_STRING_LENGTH));
    #####: 2343:  prop_counter_p->string_named_props++;
        -: 2344:#endif /* JERRY_ESNEXT */
        -: 2345:
        -: 2346:  /* 'caller' property is non-enumerable (ECMA-262 v5, 13.2.5) */
    #####: 2347:  ecma_collection_push_back (prop_names_p, ecma_make_magic_string_value (LIT_MAGIC_STRING_CALLER));
        -: 2348:
        -: 2349:  /* 'arguments' property is non-enumerable (ECMA-262 v5, 13.2.5) */
    #####: 2350:  ecma_collection_push_back (prop_names_p, ecma_make_magic_string_value (LIT_MAGIC_STRING_ARGUMENTS));
        -: 2351:
    #####: 2352:  prop_counter_p->string_named_props += 2;
        -: 2353:} /* ecma_op_bound_function_list_lazy_property_names */
        -: 2354:
        -: 2355:/**
        -: 2356: * @}
        -: 2357: * @}
        -: 2358: */
