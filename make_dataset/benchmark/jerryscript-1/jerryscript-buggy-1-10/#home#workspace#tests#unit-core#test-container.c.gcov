        -:    0:Source:/home/workspace/tests/unit-core/test-container.c
        -:    0:Programs:274
        -:    1:/* Copyright JS Foundation and other contributors, http://js.foundation
        -:    2: *
        -:    3: * Licensed under the Apache License, Version 2.0 (the "License");
        -:    4: * you may not use this file except in compliance with the License.
        -:    5: * You may obtain a copy of the License at
        -:    6: *
        -:    7: *     http://www.apache.org/licenses/LICENSE-2.0
        -:    8: *
        -:    9: * Unless required by applicable law or agreed to in writing, software
        -:   10: * distributed under the License is distributed on an "AS IS" BASIS
        -:   11: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        -:   12: * See the License for the specific language governing permissions and
        -:   13: * limitations under the License.
        -:   14: */
        -:   15:
        -:   16:#include "jerryscript.h"
        -:   17:#include "test-common.h"
        -:   18:
        -:   19:int
    #####:   20:main (void)
        -:   21:{
    #####:   22:  jerry_init (JERRY_INIT_EMPTY);
        -:   23:
    #####:   24:  if (!jerry_is_feature_enabled (JERRY_FEATURE_MAP)
    #####:   25:      || !jerry_is_feature_enabled (JERRY_FEATURE_SET)
    #####:   26:      || !jerry_is_feature_enabled (JERRY_FEATURE_WEAKMAP)
    #####:   27:      || !jerry_is_feature_enabled (JERRY_FEATURE_WEAKSET))
        -:   28:  {
    #####:   29:    jerry_port_log (JERRY_LOG_LEVEL_ERROR, "Containers are disabled!\n");
    #####:   30:    jerry_cleanup ();
    #####:   31:    return 0;
        -:   32:  }
        -:   33:
        -:   34:  jerry_value_t instance_check;
    #####:   35:  jerry_value_t global = jerry_get_global_object ();
    #####:   36:  jerry_value_t map_str = jerry_create_string ((jerry_char_t *) "Map");
    #####:   37:  jerry_value_t set_str = jerry_create_string ((jerry_char_t *) "Set");
    #####:   38:  jerry_value_t weakmap_str = jerry_create_string ((jerry_char_t *) "WeakMap");
    #####:   39:  jerry_value_t weakset_str = jerry_create_string ((jerry_char_t *) "WeakSet");
    #####:   40:  jerry_value_t global_map = jerry_get_property (global, map_str);
    #####:   41:  jerry_value_t global_set = jerry_get_property (global, set_str);
    #####:   42:  jerry_value_t global_weakmap = jerry_get_property (global, weakmap_str);
    #####:   43:  jerry_value_t global_weakset = jerry_get_property (global, weakset_str);
        -:   44:
    #####:   45:  jerry_release_value (global);
        -:   46:
    #####:   47:  jerry_release_value (map_str);
    #####:   48:  jerry_release_value (set_str);
    #####:   49:  jerry_release_value (weakmap_str);
    #####:   50:  jerry_release_value (weakset_str);
        -:   51:
    #####:   52:  jerry_value_t empty_map = jerry_create_container (JERRY_CONTAINER_TYPE_MAP, NULL, 0);
    #####:   53:  TEST_ASSERT (jerry_get_container_type (empty_map) == JERRY_CONTAINER_TYPE_MAP);
    #####:   54:  instance_check = jerry_binary_operation (JERRY_BIN_OP_INSTANCEOF, empty_map, global_map);
    #####:   55:  TEST_ASSERT (jerry_get_boolean_value (instance_check));
    #####:   56:  jerry_release_value (instance_check);
    #####:   57:  jerry_release_value (global_map);
    #####:   58:  jerry_release_value (empty_map);
        -:   59:
    #####:   60:  jerry_value_t empty_set = jerry_create_container (JERRY_CONTAINER_TYPE_SET, NULL, 0);
    #####:   61:  TEST_ASSERT (jerry_get_container_type (empty_set) == JERRY_CONTAINER_TYPE_SET);
    #####:   62:  instance_check = jerry_binary_operation (JERRY_BIN_OP_INSTANCEOF, empty_set, global_set);
    #####:   63:  TEST_ASSERT (jerry_get_boolean_value (instance_check));
    #####:   64:  jerry_release_value (instance_check);
    #####:   65:  jerry_release_value (global_set);
    #####:   66:  jerry_release_value (empty_set);
        -:   67:
    #####:   68:  jerry_value_t empty_weakmap = jerry_create_container (JERRY_CONTAINER_TYPE_WEAKMAP, NULL, 0);
    #####:   69:  TEST_ASSERT (jerry_get_container_type (empty_weakmap) == JERRY_CONTAINER_TYPE_WEAKMAP);
    #####:   70:  instance_check = jerry_binary_operation (JERRY_BIN_OP_INSTANCEOF, empty_weakmap, global_weakmap);
    #####:   71:  TEST_ASSERT (jerry_get_boolean_value (instance_check));
    #####:   72:  jerry_release_value (instance_check);
    #####:   73:  jerry_release_value (global_weakmap);
    #####:   74:  jerry_release_value (empty_weakmap);
        -:   75:
    #####:   76:  jerry_value_t empty_weakset = jerry_create_container (JERRY_CONTAINER_TYPE_WEAKSET, NULL, 0);
    #####:   77:  TEST_ASSERT (jerry_get_container_type (empty_weakset) == JERRY_CONTAINER_TYPE_WEAKSET);
    #####:   78:  instance_check = jerry_binary_operation (JERRY_BIN_OP_INSTANCEOF, empty_weakset, global_weakset);
    #####:   79:  TEST_ASSERT (jerry_get_boolean_value (instance_check));
    #####:   80:  jerry_release_value (instance_check);
    #####:   81:  jerry_release_value (global_weakset);
    #####:   82:  jerry_release_value (empty_weakset);
        -:   83:
    #####:   84:  jerry_cleanup ();
    #####:   85:  return 0;
        -:   86:} /* main */
