        -:    0:Source:/home/workspace/tests/unit-core/test-to-property-descriptor.c
        -:    0:Programs:299
        -:    1:/* Copyright JS Foundation and other contributors, http://js.foundation
        -:    2: *
        -:    3: * Licensed under the Apache License, Version 2.0 (the "License");
        -:    4: * you may not use this file except in compliance with the License.
        -:    5: * You may obtain a copy of the License at
        -:    6: *
        -:    7: *     http://www.apache.org/licenses/LICENSE-2.0
        -:    8: *
        -:    9: * Unless required by applicable law or agreed to in writing, software
        -:   10: * distributed under the License is distributed on an "AS IS" BASIS
        -:   11: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        -:   12: * See the License for the specific language governing permissions and
        -:   13: * limitations under the License.
        -:   14: */
        -:   15:
        -:   16:#include "jerryscript.h"
        -:   17:
        -:   18:#include "config.h"
        -:   19:#include "test-common.h"
        -:   20:
        -:   21:static jerry_value_t
    #####:   22:create_property_descriptor (const char *script_p) /**< source code */
        -:   23:{
    #####:   24:  jerry_value_t result = jerry_eval ((const jerry_char_t *) script_p, strlen (script_p), 0);
    #####:   25:  TEST_ASSERT (jerry_value_is_object (result));
    #####:   26:  return result;
        -:   27:} /* create_property_descriptor */
        -:   28:
        -:   29:static void
    #####:   30:check_attribute (jerry_value_t attribute, /**< attribute to be checked */
        -:   31:                 jerry_value_t object, /**< original object */
        -:   32:                 const char *name_p) /**< name of the attribute */
        -:   33:{
    #####:   34:  jerry_value_t prop_name = jerry_string_sz (name_p);
    #####:   35:  jerry_value_t value = jerry_object_get (object, prop_name);
        -:   36:
    #####:   37:  if (jerry_value_is_undefined (value))
        -:   38:  {
    #####:   39:    TEST_ASSERT (jerry_value_is_null (attribute));
        -:   40:  }
        -:   41:  else
        -:   42:  {
    #####:   43:    jerry_value_t result = jerry_binary_op (JERRY_BIN_OP_STRICT_EQUAL, attribute, value);
    #####:   44:    TEST_ASSERT (jerry_value_is_true (result));
    #####:   45:    jerry_value_free (result);
        -:   46:  }
        -:   47:
    #####:   48:  jerry_value_free (value);
    #####:   49:  jerry_value_free (prop_name);
    #####:   50:} /* check_attribute */
        -:   51:
        -:   52:static jerry_property_descriptor_t
    #####:   53:to_property_descriptor (jerry_value_t object /**< object */)
        -:   54:{
    #####:   55:  jerry_property_descriptor_t prop_desc = jerry_property_descriptor ();
        -:   56:
    #####:   57:  jerry_value_t result = jerry_property_descriptor_from_object (object, &prop_desc);
    #####:   58:  TEST_ASSERT (jerry_value_is_boolean (result) && jerry_value_is_true (result));
    #####:   59:  jerry_value_free (result);
        -:   60:
    #####:   61:  return prop_desc;
        -:   62:} /* to_property_descriptor */
        -:   63:
        -:   64:int
    #####:   65:main (void)
        -:   66:{
    #####:   67:  TEST_INIT ();
        -:   68:
    #####:   69:  jerry_init (JERRY_INIT_EMPTY);
        -:   70:
        -:   71:  /* Next test. */
    #####:   72:  const char *source_p = "({ value:'X', writable:true, enumerable:true, configurable:true })";
    #####:   73:  jerry_value_t object = create_property_descriptor (source_p);
        -:   74:
    #####:   75:  jerry_property_descriptor_t prop_desc = to_property_descriptor (object);
        -:   76:
    #####:   77:  check_attribute (prop_desc.value, object, "value");
        -:   78:
    #####:   79:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_VALUE_DEFINED);
    #####:   80:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_GET_DEFINED));
    #####:   81:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_SET_DEFINED));
    #####:   82:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_WRITABLE_DEFINED);
    #####:   83:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_WRITABLE);
    #####:   84:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_ENUMERABLE_DEFINED);
    #####:   85:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_ENUMERABLE);
    #####:   86:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_CONFIGURABLE_DEFINED);
    #####:   87:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_CONFIGURABLE);
        -:   88:
    #####:   89:  jerry_value_free (object);
    #####:   90:  jerry_property_descriptor_free (&prop_desc);
        -:   91:
        -:   92:  /* Next test. */
    #####:   93:  source_p = "({ writable:false, configurable:true })";
    #####:   94:  object = create_property_descriptor (source_p);
        -:   95:
    #####:   96:  prop_desc = to_property_descriptor (object);
        -:   97:
    #####:   98:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_VALUE_DEFINED));
    #####:   99:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_GET_DEFINED));
    #####:  100:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_SET_DEFINED));
    #####:  101:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_WRITABLE_DEFINED);
    #####:  102:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_WRITABLE));
    #####:  103:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_ENUMERABLE_DEFINED));
    #####:  104:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_CONFIGURABLE_DEFINED);
    #####:  105:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_CONFIGURABLE);
        -:  106:
    #####:  107:  jerry_value_free (object);
    #####:  108:  jerry_property_descriptor_free (&prop_desc);
        -:  109:
        -:  110:  /* Next test. */
        -:  111:  /* Note: the 'set' property is defined, and it has a value of undefined.
        -:  112:   *       This is different from not having a 'set' property. */
    #####:  113:  source_p = "({ get: function() {}, set:undefined, configurable:true })";
    #####:  114:  object = create_property_descriptor (source_p);
        -:  115:
    #####:  116:  prop_desc = to_property_descriptor (object);
        -:  117:
    #####:  118:  check_attribute (prop_desc.getter, object, "get");
    #####:  119:  check_attribute (prop_desc.setter, object, "set");
        -:  120:
    #####:  121:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_VALUE_DEFINED));
    #####:  122:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_WRITABLE_DEFINED));
    #####:  123:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_GET_DEFINED);
    #####:  124:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_SET_DEFINED);
    #####:  125:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_ENUMERABLE_DEFINED));
    #####:  126:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_CONFIGURABLE_DEFINED);
    #####:  127:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_CONFIGURABLE);
        -:  128:
    #####:  129:  jerry_value_free (object);
    #####:  130:  jerry_property_descriptor_free (&prop_desc);
        -:  131:
        -:  132:  /* Next test. */
    #####:  133:  source_p = "({ get: undefined, enumerable:false })";
    #####:  134:  object = create_property_descriptor (source_p);
        -:  135:
    #####:  136:  prop_desc = to_property_descriptor (object);
        -:  137:
    #####:  138:  check_attribute (prop_desc.getter, object, "get");
        -:  139:
    #####:  140:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_VALUE_DEFINED));
    #####:  141:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_WRITABLE_DEFINED));
    #####:  142:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_GET_DEFINED);
    #####:  143:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_SET_DEFINED));
    #####:  144:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_ENUMERABLE_DEFINED);
    #####:  145:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_ENUMERABLE));
    #####:  146:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_CONFIGURABLE_DEFINED));
        -:  147:
    #####:  148:  jerry_value_free (object);
    #####:  149:  jerry_property_descriptor_free (&prop_desc);
        -:  150:
        -:  151:  /* Next test. */
    #####:  152:  source_p = "({ set: function(v) {}, enumerable:true, configurable:false })";
    #####:  153:  object = create_property_descriptor (source_p);
        -:  154:
    #####:  155:  prop_desc = to_property_descriptor (object);
        -:  156:
    #####:  157:  check_attribute (prop_desc.setter, object, "set");
        -:  158:
    #####:  159:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_VALUE_DEFINED));
    #####:  160:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_WRITABLE_DEFINED));
    #####:  161:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_GET_DEFINED));
    #####:  162:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_SET_DEFINED);
    #####:  163:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_ENUMERABLE_DEFINED);
    #####:  164:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_ENUMERABLE);
    #####:  165:  TEST_ASSERT (prop_desc.flags & JERRY_PROP_IS_CONFIGURABLE_DEFINED);
    #####:  166:  TEST_ASSERT (!(prop_desc.flags & JERRY_PROP_IS_CONFIGURABLE));
        -:  167:
    #####:  168:  jerry_value_free (object);
    #####:  169:  jerry_property_descriptor_free (&prop_desc);
        -:  170:
        -:  171:  /* Next test. */
    #####:  172:  source_p = "({ get: function(v) {}, writable:true })";
    #####:  173:  object = create_property_descriptor (source_p);
    #####:  174:  jerry_value_t result = jerry_property_descriptor_from_object (object, &prop_desc);
    #####:  175:  TEST_ASSERT (jerry_value_is_exception (result));
    #####:  176:  jerry_value_free (result);
    #####:  177:  jerry_value_free (object);
        -:  178:
        -:  179:  /* Next test. */
    #####:  180:  object = jerry_null ();
    #####:  181:  result = jerry_property_descriptor_from_object (object, &prop_desc);
    #####:  182:  TEST_ASSERT (jerry_value_is_exception (result));
    #####:  183:  jerry_value_free (result);
    #####:  184:  jerry_value_free (object);
        -:  185:
    #####:  186:  jerry_cleanup ();
        -:  187:  return 0;
        -:  188:} /* main */
